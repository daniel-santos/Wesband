[multiplayer]
    id=Wesband2
    name= _ "Wesband"
    description= _ "WAHT."
    label= _ "Wesband"
    next_scenario=Wesband_Dungeon
    allow_new_game=no
    turns=-1
    experience_modifier="100"
    map_data="{~campaigns/Wesband/maps/town_template_40x30.map}"
    victory_when_enemies_defeated=no

    {~campaigns/Wesband/events}

    {DEFAULT_SCHEDULE}
    {WB_OVERWORLD_MUSIC_PLAYLIST}

    [side]
        side=1
        canrecruit=yes
        save_id="Player1"
        team_name="adventurer"
        controller="human"
        team_lock=1
        gold_lock=1
        income_lock=1
        income=-2
        gold=0
        type=Elvish Fighter
        fog=no
    [/side]
    [side]
        side=2
        canrecruit=yes
        save_id="Player2"
        team_name="adventurer"
        controller="human"
        team_lock=1
        gold_lock=1
        income_lock=1
        income=-2
        gold=0
        type=Elvish Fighter
        fog=no
    [/side]
    [side]
        side=3
        canrecruit=yes
        save_id="Player3"
        team_name="adventurer"
        controller="human"
        team_lock=1
        gold_lock=1
        income_lock=1
        income=-2
        gold=0
        type=Elvish Fighter
        fog=no
    [/side]
    [side]
        side=4
        canrecruit=yes
        type="Lich"
        allow_player="no"
        controller="ai"
        team_lock=1
        gold_lock=1
        income_lock=1
        colour_lock=1
        colour="black"
        [status]
            stoned=on
        [/status]
        team_name="monsters"
        team_lock=1
    [/side]

    {WBD_MENU_HELP}
    {ON_PRESTART (
	
	
		{VARIABLE terrain_int_x 0}
		{VARIABLE terrain_int_y 0}
		{VARIABLE town_i 0}
		[while]
			[variable]
				name=terrain_int_x
				less_than=41
			[/variable]
			[do]
				[while]
					[variable]
						name=terrain_int_y
						less_than=31
					[/variable]
					[do]
						[terrain]
							x,y=$terrain_int_x,$terrain_int_y
							terrain=$town_map[$town_i].terrain
						[/terrain]
						{VARIABLE_OP town_i add 1}
						{VARIABLE_OP terrain_int_y add 1}
					[/do]
				[/while]
				{VARIABLE terrain_int_y 0}
				{VARIABLE_OP terrain_int_x add 1}
			[/do]
		[/while]
		
		{PLACE_IMAGE scenery/mine-abandoned.png $dungeon_entrance_x $dungeon_entrance_y}		
		{SET_LABEL_PERSISTENT $dungeon_entrance_x $dungeon_entrance_y "dungeon"}
		{VARIABLE trapdoor_down.x $dungeon_entrance_x}
		{VARIABLE trapdoor_down.y $dungeon_entrance_y}
		{UPDATE_EXIT_LOCS}
		{HIDE_UP_EXIT}
		
        {SET_LABEL_PERSISTENT $weapon_shop_loc_x $weapon_shop_loc_y "weapons"}
        {SET_LABEL_PERSISTENT $armor_shop_loc_x $armor_shop_loc_y "armor"}
        {SET_LABEL_PERSISTENT $magic_shop_loc_x $magic_shop_loc_y "magic"}
		{SET_LABEL_PERSISTENT $tavern_loc_x $tavern_loc_y "tavern"}
		
		{TELEPORT_UNIT side=1 $dungeon_entrance_x $dungeon_entrance_y}
		{TELEPORT_UNIT side=2 $dungeon_entrance_x $dungeon_entrance_y}
		{TELEPORT_UNIT side=3 $dungeon_entrance_x $dungeon_entrance_y}
		
		[store_unit]
            [filter]
                side=4
                canrecruit=yes
            [/filter]
            variable=temp_lich
            kill=yes
        [/store_unit]
        {CLEAR_VARIABLE temp_lich}
        [objectives]
            victory_string="
OBJECTIVES:"
            [objective]
                condition=win
                description=_ "  -Prepare your character."
            [/objective]
            [objective]
                condition=win
                description=_ "  -Enter the Caverns of Wesband."
            [/objective]
            note=_ "
`Wesband by Ken Oh, Exasperation, Dovolente, and TL"
        [/objectives]

        [event]
            name=start
            first_time_only=no
			
			{VARIABLE in_dungeon 0}

            [if]
                [variable]
                    name=just_passed
                    numerical_equals=1
                [/variable]
                [then]
                    {CLEAR_VARIABLE weapon_shop}
					{CLEAR_VARIABLE armor_shop}
					{CLEAR_VARIABLE magic_shop}
					{CLEAR_VARIABLE tavern}

                    {VARIABLE do_create $leader_position.length}
					{RANDOM 8..12}
					{VARIABLE_OP do_create multiply $random}

		            [while]
		                [variable]
		                    name=do_create
		                    greater_than=0
		                [/variable]
		                [do]
		                    {CREATE_WEAPON_INSERT_TO_SHOP}
		                    {VARIABLE_OP do_create add -1}
		                [/do]
		            [/while]
					
					{VARIABLE do_create $leader_position.length}
					{RANDOM 8..12}
					{VARIABLE_OP do_create multiply $random}

		            [while]
		                [variable]
		                    name=do_create
		                    greater_than=0
		                [/variable]
		                [do]
		                    {CREATE_ARMOR_INSERT_TO_SHOP}
		                    {VARIABLE_OP do_create add -1}
		                [/do]
		            [/while]
					
					{VARIABLE do_create $leader_position.length}
					{RANDOM 4..6}
					{VARIABLE_OP do_create multiply $random}
		            [while]
		                [variable]
		                    name=do_create
		                    greater_than=0
		                [/variable]
		                [do]
		                    {CREATE_HENCH_INSERT_TO_TAVERN}
		                    {VARIABLE_OP do_create add -1}
		                [/do]
		            [/while]

		            {VARIABLE do_create $leader_position.length}
					{RANDOM 3..6}
					{VARIABLE_OP do_create multiply $random}
		            [while]
		                [variable]
		                    name=do_create
		                    greater_than=0
		                [/variable]
		                [do]
		                    {CREATE_POTION_INSERT_TO_SHOP}
		                    {VARIABLE_OP do_create add -1}
		                [/do]
		            [/while]
					
					{VARIABLE do_create $leader_position.length}
					{RANDOM 3..6}
					{VARIABLE_OP do_create multiply $random}
		            [while]
		                [variable]
		                    name=do_create
		                    greater_than=0
		                [/variable]
		                [do]
		                    {CREATE_SCROLL_INSERT_TO_SHOP}
		                    {VARIABLE_OP do_create add -1}
		                [/do]
		            [/while]

                    {VARIABLE just_passed 0}
                [/then]
            [/if]

            {WESBAND_WEAPON_SHOP}
			{WESBAND_ARMOR_SHOP}
            {WESBAND_TAVERN}
            {WESBAND_MAGIC_SHOP}
        [/event]
    )}
[/multiplayer]
