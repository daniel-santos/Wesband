#attribute options

#define MENU_UPGRADE_BODY
    [option]
        message ="&"+upgrades/body.png+"="+_ "Body: $current_unit.variables.body|
`Upgrade health, strength and vitality"="$body_cost|"
        {CHECK_PREREQ talentpoints $body_cost}
        [command]
            {VARIABLE current_unit.variables.body $body_plus}
            {VARIABLE_OP current_unit.talentpoints add -$body_cost}
            {VARIABLE_OP current_unit.hitpoints add 1}
            {VARIABLE_OP current_unit.max_hitpoints add 1}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/body.png+"="+_ "Body: $current_unit.variables.body|
`<255,0,0>Upgrade health, strength and vitality"="#$body_cost|"
        [show_if]
            [variable]
                name=current_unit.talentpoints
                less_than=$body_cost
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_UPGRADE_DEFT
    [option]
        message ="&"+upgrades/deft.png+"="+_ "Deft: $current_unit.variables.deft|
`Upgrade skill and quickness"="$deft_cost|"
        {CHECK_PREREQ talentpoints $deft_cost}
        [command]
            {VARIABLE current_unit.variables.deft $deft_plus}
            {VARIABLE_OP current_unit.talentpoints add -$deft_cost}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/deft.png+"="+_ "Deft: $current_unit.variables.deft|
`<255,0,0>Upgrade skill and quickness"="#$deft_cost|"
        [show_if]
            [variable]
                name=current_unit.talentpoints
                less_than=$deft_cost
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_UPGRADE_MIND
    [option]
        message ="&"+upgrades/mind.png+"="+_ "Mind: $current_unit.variables.mind|
`Upgrade mental power"="$mind_cost|"
        {CHECK_PREREQ talentpoints $mind_cost}
        [command]
            {VARIABLE current_unit.variables.mind $mind_plus}
            {VARIABLE_OP current_unit.talentpoints add -$mind_cost}
			[if]
				[variable]
					name=current_unit.variables.abilities.magic_casting.max_mana
					greater_than=0
				[/variable]
				[then]
					{VARIABLE_OP current_unit.variables.abilities.magic_casting.max_mana add 1}
					{VARIABLE_OP current_unit.variables.abilities.magic_casting.mana add 1}
				[/then]
			[/if]
        [/command]
    [/option]

    [option]
        message ="&"+upgrades/mind.png+"="+_ "Mind: $current_unit.variables.mind|
`<255,0,0>Upgrade mental power"="#$mind_cost|"
        [show_if]
            [variable]
                name=current_unit.talentpoints
                less_than=$mind_cost
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#weapon skill options

#define MENU_UPGRADE_WEAPON_GIFT ICON DESCRIPTION CLASS_DESCRIPTION CLASS DAMAGE_REQUIRED_ATT NUMBER_REQUIRED_ATT NUMBER_REQUIRED_ATT2
    [option]
        message ="&"+attacks/{ICON}.png+"="+_ "{CLASS_DESCRIPTION} Power, Current level: $current_unit.variables.weapon_skills.{CLASS}.damage|
`Add 2 damage to {DESCRIPTION}.
`Required: ${CLASS}_damage_cost| {DAMAGE_REQUIRED_ATT}"="${CLASS}_damage_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.inventory.type.{CLASS}
                greater_than_equal_to=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=${CLASS}_damage_cost
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.{DAMAGE_REQUIRED_ATT}
                        greater_than_equal_to=${CLASS}_damage_cost
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.weapon_skills.{CLASS}.damage add 1}
            {VARIABLE_OP current_unit.talentpoints add -${CLASS}_damage_cost}
        [/command]
    [/option]

    [option]
        message ="&"+attacks/{ICON}.png+"="+_ "<255,0,0>{CLASS_DESCRIPTION} Power,  Current level: $current_unit.variables.weapon_skills.{CLASS}.damage|
`<255,0,0>Add 2 damage to {DESCRIPTION}.
`<255,0,0>Required: ${CLASS}_damage_cost| {DAMAGE_REQUIRED_ATT}"="#${CLASS}_damage_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.inventory.type.{CLASS}
                greater_than_equal_to=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=${CLASS}_damage_cost
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.{DAMAGE_REQUIRED_ATT}
                        less_than=${CLASS}_damage_cost
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]

    [option]
        message ="&"+attacks/{ICON}.png+"="+_ "{CLASS_DESCRIPTION} Speed, Current level: $current_unit.variables.weapon_skills.{CLASS}.attack|
`Add 1 attack to {DESCRIPTION}.
`Required: ${CLASS}_attack_cost| {NUMBER_REQUIRED_ATT}, ${CLASS}_attack_cost_half {NUMBER_REQUIRED_ATT2}"="${CLASS}_attack_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.inventory.type.{CLASS}
                greater_than_equal_to=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=${CLASS}_attack_cost
                [/variable]
            [/and]
            [and]
                [variable]
                    name=current_unit.variables.{NUMBER_REQUIRED_ATT}
                    greater_than_equal_to=${CLASS}_attack_cost
                [/variable]
            [/and]
            [and]
                [variable]
                    name=current_unit.variables.{NUMBER_REQUIRED_ATT2}
                    greater_than_equal_to=${CLASS}_attack_cost_half
                [/variable]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.weapon_skills.{CLASS}.attack add 1}
            {VARIABLE_OP current_unit.talentpoints add -${CLASS}_attack_cost}
        [/command]
    [/option]

    [option]
        message ="&"+attacks/{ICON}.png+"="+_ "<255,0,0>{CLASS_DESCRIPTION} Speed, Current level: $current_unit.variables.weapon_skills.{CLASS}.attack|
`<255,0,0>Add 1 attack to {DESCRIPTION}.
`<255,0,0>Required: ${CLASS}_attack_cost| {NUMBER_REQUIRED_ATT}, ${CLASS}_attack_cost_half {NUMBER_REQUIRED_ATT2}"="#${CLASS}_attack_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.inventory.type.{CLASS}
                greater_than_equal_to=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=${CLASS}_attack_cost
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.{NUMBER_REQUIRED_ATT}
                        less_than=${CLASS}_attack_cost
                    [/variable]
                [/or]
                [or]
                    [variable]
                        name=current_unit.variables.{NUMBER_REQUIRED_ATT2}
                        less_than=${CLASS}_attack_cost_half
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#upgrade misc

#define MENU_UPGRADE_HIT_POINTS
    [option]
        message ="&"+upgrades/hitpoints.png+"="+_ "Upgrade Hit Points, Current level: $current_unit.variables.max_hp_level|
`Add 4 to maximum hit points
`Required: $hp_level_cost| Body"="$hp_level_cost|"
        {CHECK_PREREQ_2 variables.body $hp_level_cost talentpoints $hp_level_cost}
        [command]
            {VARIABLE_OP current_unit.variables.max_hp_level add 1}
            {VARIABLE_OP current_unit.talentpoints add -$hp_level_cost}
            {VARIABLE_OP current_unit.hitpoints add 4}
            {VARIABLE_OP current_unit.max_hitpoints add 4}
        [/command]
    [/option]

    [option]
        message ="&"+upgrades/hitpoints.png+"="+_ "<255,0,0>Upgrade Hit Points, Current level: $current_unit.variables.max_hp_level|
`<255,0,0>Add 4 to maximum hit points
`<255,0,0>Required: $hp_level_cost| Body"="#$hp_level_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.body
                less_than=$hp_level_cost
            [/variable]
            [or]
                [variable]
                    name=current_unit.talentpoints
                    less_than=$hp_level_cost
                [/variable]
            [/or]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_UPGRADE_EVADE
    [option]
        message ="&"+upgrades/evade.png+"="+_ "Evade, Current level: $current_unit.variables.evade_level|
`Add 3% bonus to all terrain defense, affected by armor 
`Required: $evade_cost| Deft"="$evade_cost|"
        [show_if]
			[variable]
				name=current_unit.variables.deft
				greater_than_equal_to=$evade_cost
			[/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=$evade_cost
				[/variable]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.evade_level add 1}
            {VARIABLE_OP current_unit.talentpoints add -$evade_cost}
        [/command]
    [/option]

    [option]
        message ="&"+upgrades/evade.png+"="+_ "<255,0,0>Evade, Current level: $current_unit.variables.evade_level|
`<255,0,0>Add 3% bonus to all terrain defense, affected by armor 
`<255,0,0>Required: $evade_cost| Deft"="#$evade_cost|"
        [show_if]
			[variable]
				name=current_unit.variables.deft
				less_than=$evade_cost
			[/variable]
			[or]
				[variable]
					name=current_unit.talentpoints
					less_than=$evade_cost
				[/variable]
			[/or]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_REGEN
    [option]
        message ="&"+upgrades/regen.png+"="+_ "Regenerates, Current level: $current_unit.variables.abilities.regen|
`Regenerate 2 HP per level at the start of the turn
`Required: $regen_cost| Body"="$regen_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.regen
                greater_than_equal_to=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    greater_than_equal_to=$regen_cost
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=$regen_cost
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.regen add 1}
            {VARIABLE_OP current_unit.talentpoints add -$regen_cost}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/regen.png+"="+_ "<255,0,0>Regenerates, Current level: $current_unit.variables.abilities.regen|
`<255,0,0>Regenerate 2 HP per level at the start of the turn
`<255,0,0>Required: $regen_cost| Body"="#$regen_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.regen
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    less_than=$regen_cost
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=$regen_cost
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_UPGRADE_MOVES
    [option]
        message ="&"+upgrades/movement.png+"="+_ "Upgrade Movement, Current level: $current_unit.variables.moves_level|
`Increase maximum movement points by 1 
`Required: $moves_cost| Deft"="$moves_cost|"
        {CHECK_PREREQ_2 variables.deft $moves_cost talentpoints $moves_cost}
        [command]
            {VARIABLE_OP current_unit.variables.moves_level add 1}
            {VARIABLE_OP current_unit.talentpoints add -$moves_cost}
            {VARIABLE_OP current_unit.moves add 1}
            {VARIABLE_OP current_unit.max_moves add 1}
            {VARIABLE_OP current_unit.variables.max_moves add 1}
        [/command]
    [/option]

    [option]
        message ="&"+upgrades/movement.png+"="+_ "<255,0,0>Upgrade Movement, Current level: $current_unit.variables.moves_level|
`<255,0,0>Increase maximum movement points by 1 
`<255,0,0>Required: $moves_cost| Deft"="#$moves_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.deft
                less_than=$moves_cost
            [/variable]
            [or]
                [variable]
                    name=current_unit.talentpoints
                    less_than=$moves_cost
                [/variable]
            [/or]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#ability gifts

#define MENU_ABILITY_DUAL_WIELD
    [option]
        message ="&"+upgrades/wield-dual.png+"="+_ "Ability: Dual Wield
`Wield 2 melee weapons at once
`Required: 4 Deft"="4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wield
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=4
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.deft
                        greater_than_equal_to=4
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.wield 1}
            {VARIABLE_OP current_unit.talentpoints add -4}
            {VARIABLE current_unit.variables.inventory.weapons.equipped[1].id 0}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/wield-dual.png+"="+_ "<255,0,0>Ability: Dual Wield
`<255,0,0>Wield 2 melee weapons at once
`<255,0,0>Required: 4 Deft"="#4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wield
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=4
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.deft
                        less_than=4
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_TRIPLE_WIELD
    [option]
        message ="&"+upgrades/wield-triple.png+"="+_ "Ability: Triple Wield
`Wield 3 melee weapons at once
`Required: 8 Deft"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wield
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=8
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.deft
                        greater_than_equal_to=8
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.wield add 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
            {VARIABLE current_unit.variables.inventory.weapons.equipped[2].id 0}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/wield-triple.png+"="+_ "<255,0,0>Ability: Triple Wield
`<255,0,0>Wield 3 melee weapons at once
`<255,0,0>Required: 8 Deft"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wield
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=8
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.deft
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_SKIRMISHER
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "Ability: Skirmisher
`Unarmored units ignore Zone of Control
`disallows Bloodlust, disallows Firststrike
`Required: 6 Deft, Evade 1"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.skirm
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.evade_level
                    greater_than=0
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=6
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=6
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.skirm 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "<255,0,0>Ability: Skirmisher
`<255,0,0>Unarmored units ignore Zone of Control
`<255,0,0>disallows Bloodlust, disallows Firststrike
`<255,0,0>Required: 6 Deft, Evade 1"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.skirm
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.evade_level
                    less_than=1
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=6
                    [/variable]
                [/or]
                [or]
                    [variable]
                        name=current_unit.variables.deft
                        less_than=6
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_DISTRACT
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "Ability: Distract
`Adjacent allies ignore Zone of Control
`Required: 12 Deft, Evade 2"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.skirm
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.abilities.distract
					numerical_equals=-1
				[/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.evade_level
	                    greater_than=1
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.talentpoints
	                        greater_than_equal_to=12
	                    [/variable]
	                    [and]
	                        [variable]
	                            name=current_unit.variables.deft
	                            greater_than_equal_to=12
	                        [/variable]
	                    [/and]
	                [/and]
	            [/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.distract 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "<255,0,0>Ability: Distract
`<255,0,0>Adjacent allies ignore Zone of Control
`<255,0,0>Required: 12 Deft, Evade 2"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.skirm
                numerical_equals=1
            [/variable]
            [and]
                [variable]
					name=current_unit.variables.abilities.distract
					numerical_equals=-1
				[/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=12
                    [/variable]
					[or]
						[variable]
							name=current_unit.variables.deft
							less_than=12
						[/variable]
					[/or]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_DASH
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "Ability: Dash
`Use remaining movement points after attacking
`Required: 10 Deft, Evade 2"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.dash
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.skirm
                    numerical_equals=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.evade_level
                        greater_than=1
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.talentpoints
                            greater_than_equal_to=10
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.variables.deft
                                greater_than_equal_to=10
                            [/variable]
                        [/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.dash 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "<255,0,0>Ability: Dash
`<255,0,0>Use remaining movement points after attacking
`<255,0,0>Required: 10 Deft, Evade 2"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.dash
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.skirm
                    numerical_equals=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.evade_level
                        less_than=2
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.talentpoints
                            less_than=10
                        [/variable]
                    [/or]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=10
                        [/variable]
                    [/or]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_GRACE
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "Ability: Deadly Grace
`Gain attack if unit defending on melee misses all strikes
`Required: 15 Deft, Evade 3"="15"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.grace
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.dash
                    numerical_equals=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.evade_level
                        greater_than=2
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.talentpoints
                            greater_than_equal_to=15
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.variables.deft
                                greater_than_equal_to=15
                            [/variable]
                        [/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.grace 1}
            {VARIABLE_OP current_unit.talentpoints add -15}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "<255,0,0>Ability: Deadly Grace
`<255,0,0>Gain attack if unit defending on melee misses all strikes
`<255,0,0>Required: 15 Deft, Evade 3"="#15"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.grace
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.dash
                    numerical_equals=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.evade_level
                        less_than=3
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.talentpoints
                            less_than=15
                        [/variable]
                    [/or]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=15
                        [/variable]
                    [/or]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_FIRSTSTRIKE
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "Ability: Firststrike
`Firststrike on long-reach polearms
`Required: 6 Deft, Polearm Power 1"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.firststrike
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=6
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=6
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.firststrike 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "<255,0,0>Ability: Firststrike
`<255,0,0>Firststrike on long-reach polearms
`<255,0,0>Required: 6 Deft, Polearm Power 1"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.firststrike
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=6
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=6
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_ENSNARE_1
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "Ability: Ensnare Level 1
`Pikes/tridents gain 5% chance to hit on each hit
`Required: 10 Deft, Polearm Power 1"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ensnare
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=10
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=10
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.ensnare 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "<255,0,0>Ability: Ensnare Level 1
`<255,0,0>Pikes/tridents gain 5% chance to hit on each hit
`<255,0,0>Required: 10 Deft, Polearm Power 1"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ensnare
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=10
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=10
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_ENSNARE_2
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "Ability: Ensnare Level 2
`Pikes/tridents gain 10% chance to hit on each hit
`Required: 14 Deft, Polearm Power 2"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ensnare
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    greater_than_equal_to=2
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=14
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=14
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.ensnare add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "<255,0,0>Ability: Ensnare Level 2
`<255,0,0>Pikes/tridents gain 10% chance to hit on each hit
`<255,0,0>Required: 14 Deft, Polearm Power 2"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ensnare
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    less_than=2
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=14
                    [/variable]
                [/or]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=14
					[/variable]
				[/or]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_ENSNARE_3
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "Ability: Ensnare Level 3
`Pikes/tridents gain 15% chance to hit on each hit
`Required: 18 Deft"="18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ensnare
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=18
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=18
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.ensnare add 1}
            {VARIABLE_OP current_unit.talentpoints add -18}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "<255,0,0>Ability: Ensnare Level 3
`<255,0,0>Pikes/tridents gain 15% chance to hit on each hit
`<255,0,0>Required: 18 Deft"="#18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ensnare
                numerical_equals=2
            [/variable]
            [and]
				[variable]
					name=current_unit.talentpoints
					less_than=18
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=18
					[/variable]
				[/or]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_POINTPIKE_1
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "Ability: Point&Pike Level 1
`Polearms gain 10% chance to hit on each miss, resets on hit
`Required: 4 Deft, Polearm Power 1"="4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.pointpike
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=4
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=4
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.pointpike 1}
            {VARIABLE_OP current_unit.talentpoints add -4}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "<255,0,0>Ability: Point&Pike Level 1
`<255,0,0>Polearms gain 10% chance to hit on each miss, resets on hit
`<255,0,0>Required: 4 Deft, Polearm Power 1"="#4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.pointpike
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=4
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=4
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_POINTPIKE_2
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "Ability: Point&Pike Level 2
`Polearms gain 20% chance to hit on each miss, resets on hit
`Required: 8 Deft, Polearm Power 2"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.pointpike
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    greater_than_equal_to=2
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=8
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=8
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.pointpike add 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "<255,0,0>Ability: Point&Pike Level 2
`<255,0,0>Polearms gain 20% chance to hit on each miss, resets on hit
`<255,0,0>Required: 8 Deft, Polearm Power 2"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.pointpike
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.polearm.damage
                    less_than=2
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=8
                    [/variable]
                [/or]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=8
					[/variable]
				[/or]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_POINTPIKE_3
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "Ability: Point&Pike Level 3
`Polearms gain 30% chance to hit on each miss, resets on hit
`Required: 12 Deft"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.pointpike
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=12
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=12
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.pointpike add 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/firststrike.png+"="+_ "<255,0,0>Ability: Point&Pike Level 3
`<255,0,0>Polearms gain 30% chance to hit on each miss, resets on hit
`<255,0,0>Required: 12 Deft"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.pointpike
                numerical_equals=2
            [/variable]
            [and]
				[variable]
					name=current_unit.talentpoints
					less_than=12
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=12
					[/variable]
				[/or]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_STORM_1
    [option]
        message ="&"+attacks/hammer-troll.png+"="+_ "Ability: Storm Level 1
`Battle ends 2 strikes after attacker's last strike
`Required: 4 Body, Bludgeon Power 1"="4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.storm
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.bludgeon.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=4
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.body
                            greater_than_equal_to=4
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.storm 1}
            {VARIABLE_OP current_unit.talentpoints add -4}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/hammer-troll.png+"="+_ "<255,0,0>Ability: Storm Level 1
`<255,0,0>Battle ends 2 strikes after attacker's last strike
`<255,0,0>Required: 4 Body, Bludgeon Power 1"="#4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.storm
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.bludgeon.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=4
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.body
                            less_than=4
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_STORM_2
    [option]
        message ="&"+attacks/hammer-troll.png+"="+_ "Ability: Storm Level 2
`Battle ends 1 strikes after attacker's last strike
`Required: 8 Body"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.storm
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=8
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.body
						greater_than_equal_to=8
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.storm add 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/hammer-troll.png+"="+_ "<255,0,0>Ability: Storm Level 2
`<255,0,0>Battle ends 1 strike after attacker's last strike
`<255,0,0>Required: 8 Body, Bludgeon Power 1"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.storm
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					less_than=8
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=8
					[/variable]
				[/or]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_STORM_3
    [option]
        message ="&"+attacks/hammer-troll.png+"="+_ "Ability: Storm Level 3
`Battle ends after attacker's last strike
`Required: 12 Body"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.storm
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=12
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.body
						greater_than_equal_to=12
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.storm add 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/hammer-troll.png+"="+_ "<255,0,0>Ability: Storm Level 3
`<255,0,0>Battle ends after attacker's last strike
`<255,0,0>Required: 12 Body"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.storm
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					less_than=12
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=12
					[/variable]
				[/or]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_CLEAVE_1
    [option]
        message ="&"+attacks/battleaxe.png+"="+_ "Ability: Cleave Level 1
`Enemies adjacent to both units in attack can take 1/8 damage
`Required: 10 Body, Heavy Blade Power 1"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.cleave
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.heavy_blade.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=10
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.body
                            greater_than_equal_to=10
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.cleave 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/battleaxe.png+"="+_ "<255,0,0>Ability: Cleave Level 1
`<255,0,0>Enemies adjacent to both units in attack can take 1/8 damage
`<255,0,0>Required: 10 Body, Heavy Blade Power 1"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.cleave
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.heavy_blade.damage
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=10
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.body
                            less_than=10
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_CLEAVE_2
    [option]
        message ="&"+attacks/battleaxe.png+"="+_ "Ability: Cleave Level 2
`Enemies adjacent to both units in attack can take 1/6 damage
`Required: 14 Body"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.cleave
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.body
						greater_than_equal_to=14
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.cleave add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/battleaxe.png+"="+_ "<255,0,0>Ability: Cleave Level 2
`<255,0,0>Enemies adjacent to both units in attack can take 1/6 damage
`<255,0,0>Required: 14 Body"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.cleave
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=14
					[/variable]
				[/or]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_CLEAVE_3
    [option]
        message ="&"+attacks/battleaxe.png+"="+_ "Ability: Cleave Level 3
`Enemies adjacent to both units in attack can take 1/4 damage
`Required: 18 Body"="18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.cleave
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=18
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.body
						greater_than_equal_to=18
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.cleave add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/battleaxe.png+"="+_ "<255,0,0>Ability: Cleave Level 3
`<255,0,0>Enemies adjacent to both units in attack can take 1/4 damage
`<255,0,0>Required: 18 Body"="#18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.cleave
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					less_than=18
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=18
					[/variable]
				[/or]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_BLOODLUST_1
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "Ability: Bloodlust Level 1
`Can attack again if target killed on the first strike
`Required: 6 Body, Melee weapons only"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.bloodlust
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=6
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.body
						greater_than_equal_to=6
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.bloodlust 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "<255,0,0>Ability: Bloodlust Level 1
`<255,0,0>Can attack again if target killed on the first strike
`<255,0,0>Required: 6 Body, Melee weapons only"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.bloodlust
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					less_than=6
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=6
					[/variable]
				[/or]
				[not]
					[variable]
						name=current_unit.variables.body
						less_than=5
					[/variable]
				[/not]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_BLOODLUST_2
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "Ability: Bloodlust Level 2
`Can attack again if target killed within two strikes, +1 move if on first strike 
`Required: 10 Body, Melee weapons only"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.bloodlust
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=10
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.body
                        greater_than_equal_to=10
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.bloodlust 2}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "<255,0,0>Ability: Bloodlust Level 2
`<255,0,0>Can attack again if target killed within two strikes, +1 move if on first strike 
`<255,0,0>Required: 10 Body, Melee weapons only"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.bloodlust
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=10
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.body
                        less_than=10
                    [/variable]
                [/or]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_BLOODLUST_3
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "Ability: Bloodlust Level 3
`Can attack again if target killed within three strikes, +1 move if within two strikes
`Required: 14 Body, Melee weapons only"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.bloodlust
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=14
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.body
                        greater_than_equal_to=14
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.bloodlust 3}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "<255,0,0>Ability: Bloodlust Level 3
`<255,0,0>Can attack again if target killed within three strikes, +1 move if within two strikes
`<255,0,0>Required: 14 Body, Melee weapons only"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.bloodlust
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=14
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.body
                        less_than=14
                    [/variable]
                [/or]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_RAGE
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "Ability: Rage
`Offensive combat with main melee weapon lasts twice as long 
`Required: 12 Body"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.bloodlust
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.rage
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=12
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.body
                            greater_than_equal_to=12
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.rage 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "<255,0,0>Ability: Rage
`<255,0,0>Offensive combat with main melee weapon lasts twice as long 
`<255,0,0>Required: 12 Body"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.bloodlust
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.rage
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=12
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.body
                            less_than=12
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_BERSERK
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "Ability: Berserk
`Rage lengthened by 1 combat round, defensive combat length doubled
`Required: 16 Body"="16"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.rage
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.berserk
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=16
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.body
                            greater_than_equal_to=16
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.berserk 1}
            {VARIABLE_OP current_unit.talentpoints add -16}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/frenzy.png+"="+_ "<255,0,0>Ability: Berserk
`<255,0,0>Rage lengthened by 1 combat round, defensive combat length doubled
`<255,0,0>Required: 16 Body"="#16"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.rage
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.berserk
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=16
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.body
                            less_than=16
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_BRUTAL_ASSAULT
	[option]
		message ="&"+attacks/hammer-troll.png+"="+_ "Ability: Brutal Assault
`When using Storm, deal 60% more damage per strike
`but only half as many strikes per attack.
`Required: 8 Body, Storm 1, Bloodlust 1"="8"
		[show_if]
			[variable]
				name=current_unit.variables.abilities.brutal
				numerical_equals=-1
			[/variable]
			[and]
				[variable]
					name=current_unit.variables.abilities.storm
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.abilities.bloodlust
						greater_than=0
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.body
							greater_than_equal_to=8
						[/variable]
						[and]
							[variable]
								name=current_unit.talentpoints
								greater_than_equal_to=8
							[/variable]
						[/and]
					[/and]
				[/and]
			[/and]
		[/show_if]
		[command]
			{VARIABLE_OP current_unit.talentpoints add -8}
			{VARIABLE current_unit.variables.abilities.brutal 1}
		[/command]
	[/option]
	[option]
		message ="&"+attacks/hammer-troll.png+"="+_ "<255,0,0>Ability: Brutal Assault
`<255,0,0>When using Storm, deal 60% more damage per strike
`<255,0,0>but only half as many strikes per attack.
`<255,0,0>Required: 8 Body, Storm 1, Bloodlust 1"="#8"
		[show_if]
			[variable]
				name=current_unit.variables.abilities.brutal
				numerical_equals=-1
			[/variable]
			[and]
				[variable]
					name=current_unit.variables.abilities.storm
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.abilities.bloodlust
						greater_than=0
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.body
							less_than=8
						[/variable]
						[or]
							[variable]
								name=current_unit.talentpoints
								less_than=8
							[/variable]
						[/or]
					[/and]
				[/and]
			[/and]
		[/show_if]
		[command]
		[/command]
	[/option]
#enddef

#define MENU_ABILITY_RPG_LEADERSHIP_1
    [option]
        message ="&"+upgrades/leadership-1.png+"="+_ "Ability: Leadership Level 1
`Enhance attacks of surrounding level 0 allies 
`Required: 4 Mind, 5 Body, 5 Deft, level 1"="4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.leadership
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.level
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=4
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.mind
							greater_than_equal_to=4
						[/variable]
						[and]
							[variable]
								name=current_unit.variables.body
								greater_than_equal_to=5
							[/variable]
							[and]
								[variable]
									name=current_unit.variables.deft
									greater_than_equal_to=5
								[/variable]
							[/and]
						[/and]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.leadership 1}
            {VARIABLE_OP current_unit.talentpoints add -4}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/leadership-1.png+"="+_ "<255,0,0>Ability: Leadership Level 1
`<255,0,0>Enhance attacks of surrounding level 0 allies 
`<255,0,0>Required: 4 Mind, 5 Body, 5 Deft, level 1"="#4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.leadership
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.level
					less_than=1
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=4
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.mind
						less_than=4
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=5
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=5
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_LEADERSHIP_2
    [option]
        message ="&"+upgrades/leadership-2.png+"="+_ "Ability: Leadership Level 2
`Enhance attacks of surrounding level 0 and 1 allies
`Required: 6 Mind, 7 Body, 7 Deft, level 2"="6"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.leadership
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					greater_than_equal_to=6
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.mind
						greater_than_equal_to=6
					[/variable]
					[and]
						[variable]
							name=current_unit.level
							greater_than=1
						[/variable]
						[and]
							[variable]
								name=current_unit.variables.body
								greater_than_equal_to=7
							[/variable]
							[and]
								[variable]
									name=current_unit.variables.deft
									greater_than_equal_to=7
								[/variable]
							[/and]
						[/and]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.leadership add 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/leadership-2.png+"="+_ "<255,0,0>Ability: Leadership Level 2
`<255,0,0>Enhance attacks of surrounding level 0 and 1 allies
`<255,0,0>Required: 6 Mind, 7 Body, 7 Deft, level 2"="#6"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.leadership
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=current_unit.talentpoints
					less_than=6
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.mind
						less_than=6
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.level
						less_than=2
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=7
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=7
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_LEADERSHIP_3
    [option]
        message ="&"+upgrades/leadership-3.png+"="+_ "Ability: Leadership Level 3
`Enhance attacks of surrounding level 0-2 allies
`Required: 8 Mind, 9 Body, 9 Deft, level 3"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.leadership
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.mind
					greater_than_equal_to=8
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=8
					[/variable]
					[and]
						[variable]
							name=current_unit.level
							greater_than=2
						[/variable]
						[and]
							[variable]
								name=current_unit.variables.body
								greater_than_equal_to=9
							[/variable]
							[and]
								[variable]
									name=current_unit.variables.deft
									greater_than_equal_to=9
								[/variable]
							[/and]
						[/and]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.leadership add 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/leadership-3.png+"="+_ "<255,0,0>Ability: Leadership Level 3
`<255,0,0>Enchance attacks of surrounding level 0-2 allies
`<255,0,0>Required: 8 Mind, 9 Body, 9 Deft, level 3"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.leadership
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.mind
					less_than=9
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=9
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.level
						less_than=3
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=9
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=9
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_LEADERSHIP_4
    [option]
        message ="&"+upgrades/leadership-4.png+"="+_ "Ability: Leadership Level 4
`Enchance attacks of surrounding level 0-3 allies
`Required: 10 Mind, 11 Body, 11 Deft, level 4"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.leadership
                numerical_equals=3
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.mind
					greater_than_equal_to=10
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=10
					[/variable]
					[and]
						[variable]
							name=current_unit.level
							greater_than=3
						[/variable]
						[and]
							[variable]
								name=current_unit.variables.body
								greater_than_equal_to=11
							[/variable]
							[and]
								[variable]
									name=current_unit.variables.deft
									greater_than_equal_to=11
								[/variable]
							[/and]
						[/and]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.leadership add 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/leadership-4.png+"="+_ "<255,0,0>Ability: Leadership Level 4
`<255,0,0>Enchance attacks of surrounding level 0-3 allies
`<255,0,0>Required: 10 Mind, 11 Body, 11 Deft, level 4"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.leadership
                numerical_equals=3
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.mind
					less_than=10
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=10
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.level
						less_than=4
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.body
						less_than=11
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=11
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_CRUELTY
    [option]
        message ="&"+upgrades/leadership-1.png+"="+_ "Ability: Cruelty
`30% per level of leadership for chaotic units, 20% for non-chaotic
`Required: 8 Body"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.cruelty
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.abilities.leadership
					greater_than_equal_to=1
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=8
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.body
							greater_than_equal_to=8
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.cruelty 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/leadership-1.png+"="+_ "<255,0,0>Ability: Leadership Level 1
`<255,0,0>30% per level of leadership for chaotic units, 20% for non-chaotic
`<255,0,0>Required: 8 Body"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.cruelty
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.abilities.leadership
					greater_than_equal_to=1
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						less_than=8
					[/variable]
					[or]
						[variable]
							name=current_unit.variables.body
							less_than=8
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef


#define MENU_ABILITY_RPG_HEALTHY
    [option]
        message ="&"+upgrades/hitpoints.png+"="+_ "Trait: Healthy
`Can rest while moving, halves poison damage
`Required: 8 Body"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.healthy
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    greater_than_equal_to=8
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=8
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.healthy 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/hitpoints.png+"="+_ "<255,0,0>Trait: Healthy
`<255,0,0>Can rest while moving, halves poison damage
`<255,0,0>Required: 8 Body"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.healthy
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    less_than=8
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_FEARLESS
    [option]
        message ="&"+upgrades/hitpoints.png+"="+_ "Trait: Fearless
`Fight normally during unfavorable times of day/night
`Required: 6 Mind"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.fearless
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=6
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=6
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.fearless 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/hitpoints.png+"="+_ "<255,0,0>Trait: Fearless
`<255,0,0>Fight normally during unfavorable times of day/night
`<255,0,0>Required: 6 Mind"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.fearless
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=6
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=6
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_LONER
    [option]
        message ="&"+upgrades/loner.png+"="+_ "Ability: Loner
`Increase damage by 25% if not next any allied unit
`Required: 4 Mind, 6 Body, 6 Deft"="4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.loner
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.alignment
                    equals="neutral"
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=4
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.talentpoints
                            greater_than_equal_to=4
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.variables.body
                                greater_than=5
                            [/variable]
                            [and]
                                [variable]
                                    name=current_unit.variables.deft
                                    greater_than=5
                                [/variable]
                            [/and]
                        [/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.loner 1}
            {VARIABLE_OP current_unit.talentpoints add -4}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/loner.png+"="+_ "<255,0,0>Ability: Loner
`<255,0,0>Increase damage by 50% if not next any allied unit
`<255,0,0>Required: 4 Mind, 6 Body, 6 Deft"="#4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.loner
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.alignment
                    equals="neutral"
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=4
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.talentpoints
                            less_than=4
                        [/variable]
                    [/or]
                    [or]
                        [variable]
                            name=current_unit.variables.body
                            less_than=6
                        [/variable]
                    [/or]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=6
                        [/variable]
                    [/or]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_RANGER
    [option]
        message ="&"+upgrades/loner.png+"="+_ "Ability: Ranger
`60% forest def, 50% swamp def, 2 swamp move cost
`Required: 7 Mind, 7 Deft"="7"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ranger
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=7
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=7
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than=7
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.ranger 1}
            {VARIABLE current_unit.variables.terrain.forest.defense 40}
            {VARIABLE current_unit.variables.terrain.swamp_water.defense 50}
            {VARIABLE current_unit.variables.terrain.swamp_water.movement 2}
            {VARIABLE_OP current_unit.talentpoints add -7}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/loner.png+"="+_ "<255,0,0>Ability: Ranger
`<255,0,0>60% forest def, 50% swamp def, 2 swamp move cost
`<255,0,0>Required: 7 Mind, 7 Deft"="#7"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ranger
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=7
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=7
                    [/variable]
                [/or]
                [or]
                    [variable]
                        name=current_unit.variables.deft
                        less_than=7
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_TRAILBLAZER
    [option]
        message ="&"+upgrades/loner.png+"="+_ "Ability: Trailblazer
`-1 movement cost: forest, hills, frozen, mountains, shallow water
`60% hills def, 60% swamp def, 40% shallow water def
`Required: 10 Mind, 12 Deft"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.trailblazer
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.ranger
                    numerical_equals=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=10
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.talentpoints
                            greater_than_equal_to=10
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.variables.deft
                                greater_than_equal_to=12
                            [/variable]
                        [/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.trailblazer 1}
            {VARIABLE current_unit.variables.terrain.forest.movement 1}
            {VARIABLE current_unit.variables.terrain.hills.movement 1}
            {VARIABLE current_unit.variables.terrain.frozen.movement 2}
            {VARIABLE current_unit.variables.terrain.mountains.movement 2}
            {VARIABLE current_unit.variables.terrain.shallow_water.movement 2}
            {VARIABLE current_unit.variables.terrain.swamp_water.defense 40}
            {VARIABLE current_unit.variables.terrain.shallow_water.defense 60}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/loner.png+"="+_ "<255,0,0>Ability: Trailblazer
`<255,0,0>-1 movement cost: forest, hills, frozen, mountains, shallow water
`<255,0,0>60% hills def, 60% swamp def, 40% shallow water def
`<255,0,0>Required: 10 Mind, 12 Deft"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ranger
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.trailblazer
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=10
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.talentpoints
                            less_than=10
                        [/variable]
                    [/or]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=12
                        [/variable]
                    [/or]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_SURVIVALIST
    [option]
        message ="&"+upgrades/loner.png+"="+_ "Ability: Survivalist
`Heals +8 and cures when on forest
`Required: 12 Mind"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.survivalist
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.ranger
                    numerical_equals=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.abilities.loner
                        numerical_equals=1
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.mind
                            greater_than_equal_to=12
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.talentpoints
                                greater_than_equal_to=12
                            [/variable]
                        [/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.survivalist 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/loner.png+"="+_ "<255,0,0>Ability: Survivalist
`<255,0,0>Heals +8 and cures when on forest
`<255,0,0>Required: 12 Mind"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ranger
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.survivalist
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.abilities.loner
                        numerical_equals=1
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.mind
                            less_than=12
                        [/variable]
                        [or]
                            [variable]
                                name=current_unit.talentpoints
                                less_than=12
                            [/variable]
                        [/or]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_AMBUSH_FOREST
    [option]
        message ="&"+upgrades/loner.png+"="+_ "Ability: Ambush
`Ambush from forest if lightly armored (evade > 0)
`Required: 6 Mind, 8 Deft"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ambush_forest
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=6
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=6
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=8
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.ambush_forest 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/loner.png+"="+_ "<255,0,0>Ability: Ambush
`<255,0,0>Ambush from forest if lightly armored (evade > 0)
`<255,0,0>Required: 6 Mind, 8 Deft"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ambush_forest
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=6
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=6
                    [/variable]
                [/or]
                [or]
                    [variable]
                        name=current_unit.variables.deft
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_AMBUSH_MOUNTAINS
    [option]
        message ="&"+upgrades/hitpoints.png+"="+_ "Ability: Ambush
`Ambush from mountains if lightly armored (evade > 0)
`Required: 6 Mind, 8 Deft"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ambush_mountains
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=6
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=6
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=8
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.ambush_mountains 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/hitpoints.png+"="+_ "<255,0,0>Ability: Ambush
`<255,0,0>Ambush from mountains if lightly armored (evade > 0)
`<255,0,0>Required: 6 Mind, 8 Deft"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ambush_mountains
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=6
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=6
                    [/variable]
                [/or]
                [or]
                    [variable]
                        name=current_unit.variables.deft
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RPG_TRAILBLAZER_ELF
    [option]
        message ="&"+upgrades/loner.png+"="+_ "Ability: Trailblazer
`-1 movement cost: mountains, shallow water
`40% sand def, 30% shallow water def, 40% swamp def
`Required: 8 Mind, 12 Deft"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.trailblazer_elf
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.ambush_forest
                    numerical_equals=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=8
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.talentpoints
                            greater_than_equal_to=8
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.variables.deft
                                greater_than_equal_to=12
                            [/variable]
                        [/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.trailblazer_elf 1}
            {VARIABLE current_unit.variables.terrain.mountains.movement 2}
            {VARIABLE current_unit.variables.terrain.shallow_water.movement 2}
            {VARIABLE current_unit.variables.terrain.swamp_water.defense 60}
            {VARIABLE current_unit.variables.terrain.shallow_water.defense 70}
            {VARIABLE current_unit.variables.terrain.sand.defense 60}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/loner.png+"="+_ "<255,0,0>Ability: Trailblazer
`<255,0,0>-1 movement cost: mountains, shallow water
`<255,0,0>40% sand def, 30% shallow water def, 40% swamp def
`<255,0,0>Required: 8 Mind, 12 Deft"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.ambush_forest
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.trailblazer_elf
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=8
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.talentpoints
                            less_than=8
                        [/variable]
                    [/or]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=12
                        [/variable]
                    [/or]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_STEADFAST_1
    [option]
        message ="&"+attacks/rectangular-shield.png+"="+_ "Ability: Steadfast Level 1
`Double resistances up to 40% with a large enough shield
`Required: 8 Body"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.steadfast
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    greater_than_equal_to=8
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=8
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.steadfast 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/rectangular-shield.png+"="+_ "<255,0,0>Ability: Steadfast Level 1
`<255,0,0>Double resistances up to 50% with a large enough shield
`<255,0,0>Required: 8 Body"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.steadfast
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    less_than=8
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_STEADFAST_2
    [option]
        message ="&"+attacks/rectangular-shield.png+"="+_ "Ability: Steadfast Level 2
`Double resistances up to 50% with a large enough shield
`Required: 12 Body"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.steadfast
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    greater_than_equal_to=12
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=12
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.steadfast add 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/rectangular-shield.png+"="+_ "<255,0,0>Ability: Steadfast Level 2
`<255,0,0>Double resistances up to 50% with a large enough shield
`<255,0,0>Required: 12 Body"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.steadfast
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    less_than=12
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=12
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_STEADFAST_3
    [option]
        message ="&"+attacks/rectangular-shield.png+"="+_ "Ability: Steadfast Level 3
`Double resistances up to 60% with a large enough shield
`Required: 16 Body"="16"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.steadfast
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    greater_than_equal_to=16
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=16
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.steadfast add 1}
            {VARIABLE_OP current_unit.talentpoints add -16}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/rectangular-shield.png+"="+_ "<255,0,0>Ability: Steadfast Level 3
`<255,0,0>Double resistances up to 60% with a large enough shield
`<255,0,0>Required: 16 Body"="#16"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.steadfast
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.body
                    less_than=16
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=16
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_BACKSTAB_1
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "Ability: Backstab Level 1
`Double damage while backstabbing with daggers
`Required: 4 Deft, Light Blade Power 1"="4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.backstab
                numerical_equals=-1
            [/variable]
			[and]
                [variable]
                    name=current_unit.variables.weapon_skills.light_blade.damage
                    greater_than=0
                [/variable]
				[and]
					[variable]
						name=current_unit.alignment
						equals="chaotic"
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.deft
							greater_than_equal_to=4
						[/variable]
						[and]
							[variable]
								name=current_unit.talentpoints
								greater_than_equal_to=4
							[/variable]
						[/and]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.backstab 1}
            {VARIABLE_OP current_unit.talentpoints add -4}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "<255,0,0>Ability: Backstab Level 1
`<255,0,0>Double damage while backstabbing with daggers
`<255,0,0>Required: 4 Deft, Light Blade Power 1"="#4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.backstab
                numerical_equals=-1
            [/variable]
			[and]
                [variable]
                    name=current_unit.variables.weapon_skills.light_blade.damage
                    greater_than=0
                [/variable]
				[and]
					[variable]
						name=current_unit.alignment
						equals="chaotic"
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.deft
							less_than=4
						[/variable]
						[or]
							[variable]
								name=current_unit.talentpoints
								less_than=4
							[/variable]
						[/or]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_BACKSTAB_2
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "Ability: Backstab Level 2
`250% damage while backstabbing with daggers
`Required: 8 Deft"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.backstab
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.alignment
					equals="chaotic"
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=8
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=8
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.backstab add 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "<255,0,0>Ability: Backstab Level 2
`<255,0,0>250% damage while backstabbing with daggers
`<255,0,0>Required: 8 Deft"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.backstab
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.alignment
					equals="chaotic"
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=8
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=8
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_BACKSTAB_3
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "Ability: Backstab Level 3
`300% damage while backstabbing with daggers
`Required: 12 Deft"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.backstab
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.alignment
					equals="chaotic"
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=12
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=12
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.backstab add 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "<255,0,0>Ability: Backstab Level 3
`<255,0,0>300% damage while backstabbing with daggers
`<255,0,0>Required: 12 Deft"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.backstab
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.alignment
					equals="chaotic"
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=12
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=12
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_TARGET_1
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "Ability: Target Level 1
`Double damage, half strikes with daggers
`Required: 4 Deft, Light Blade Power 1"="4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.target
                numerical_equals=-1
            [/variable]
			[and]
                [variable]
                    name=current_unit.variables.weapon_skills.light_blade.damage
                    greater_than=0
                [/variable]
				[and]
					[variable]
						name=current_unit.alignment
						equals="chaotic"
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.deft
							greater_than_equal_to=4
						[/variable]
						[and]
							[variable]
								name=current_unit.talentpoints
								greater_than_equal_to=4
							[/variable]
						[/and]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.target 1}
            {VARIABLE_OP current_unit.talentpoints add -4}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "<255,0,0>Ability: Target Level 1
`<255,0,0>Double damage, half strikes with daggers
`<255,0,0>Required: 4 Deft, Light Blade Power 1"="#4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.target
                numerical_equals=-1
            [/variable]
			[and]
                [variable]
                    name=current_unit.variables.weapon_skills.light_blade.damage
                    greater_than=0
                [/variable]
				[and]
					[variable]
						name=current_unit.alignment
						equals="chaotic"
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.deft
							less_than=4
						[/variable]
						[or]
							[variable]
								name=current_unit.talentpoints
								less_than=4
							[/variable]
						[/or]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_TARGET_2
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "Ability: Target Level 2
`250% damage, half strikes with daggers
`Required: 8 Deft"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.target
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.alignment
					equals="chaotic"
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=8
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=8
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.target add 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "<255,0,0>Ability: Target Level 2
`<255,0,0>250% damage, half strikes with daggers
`<255,0,0>Required: 8 Deft"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.target
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.alignment
					equals="chaotic"
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=8
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=8
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_TARGET_3
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "Ability: Target Level 3
`300% damage, half strikes with daggers
`Required: 12 Deft"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.target
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.alignment
					equals="chaotic"
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=12
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=12
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.target add 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/backstab.png+"="+_ "<255,0,0>Ability: Target Level 3
`<255,0,0>300% damage, half strikes with daggers
`<255,0,0>Required: 12 Deft"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.target
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.alignment
					equals="chaotic"
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=12
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=12
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_SLASHDASH_1
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "Ability: Slash&Dash Level 1
`Gain 1 movement point for every 2 strikes landed with foils
`Required: 10 Deft"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.dash
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.slashdash
                    numerical_equals=-1
                [/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=10
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=10
						[/variable]
					[/and]
				[/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.slashdash 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "<255,0,0>Ability: Slash&Dash Level 1
`<255,0,0>Gain 1 movement point for every 2 strikes landed with foils
`<255,0,0>Required: 10 Deft"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.dash
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.slashdash
                    numerical_equals=-1
                [/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=10
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=10
						[/variable]
					[/or]
				[/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_SLASHDASH_2
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "Ability: Slash&Dash Level 2
`Gain 1 movement point for every strike landed with foils
`Required: 14 Deft"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.slashdash
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=14
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.slashdash add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "<255,0,0>Ability: Slash&Dash Level 2
`<255,0,0>Gain 1 movement point for every strike landed with foils
`<255,0,0>Required: 14 Deft"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.slashdash
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_SLASHDASH_3
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "Ability: Slash&Dash Level 3
`Gain 2 movement points for every strike landed with foils
`Required: 18 Deft"="18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.slashdash
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=18
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=18
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.slashdash add 1}
            {VARIABLE_OP current_unit.talentpoints add -18}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/skirmisher.png+"="+_ "<255,0,0>Ability: Slash&Dash Level 3
`<255,0,0>Gain 2 movement points for every strike landed with foils
`<255,0,0>Required: 18 Deft"="#18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.slashdash
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=18
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=18
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RIPOSTE_1
    [option]
        message ="&"+attacks/saber-human.png+"="+_ "Ability: Riposte Level 1
`Enemy's miss, 60% chance to hit on your next strike, foils only
`Required: 10 Deft, Light Blade Power 1"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.riposte
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.light_blade.damage
                    greater_than=0
                [/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=10
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=10
						[/variable]
					[/and]
				[/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.riposte 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/saber-human.png+"="+_ "<255,0,0>Ability: Riposte Level 1
`<255,0,0>Enemy's miss, 60% chance to hit on your next strike, foils only
`<255,0,0>Required: 10 Deft, Light Blade Power 1"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.riposte
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.light_blade.damage
                    greater_than=0
                [/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=10
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=10
						[/variable]
					[/or]
				[/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RIPOSTE_2
    [option]
        message ="&"+attacks/saber-human.png+"="+_ "Ability: Riposte Level 2
`Enemy's miss, 80% chance to hit on your next strike, foils only
`Required: 14 Deft, Light Blade Power 3"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.riposte
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.light_blade.damage
                    greater_than=2
                [/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=14
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=14
						[/variable]
					[/and]
				[/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.riposte add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/saber-human.png+"="+_ "<255,0,0>Ability: Riposte Level 2
`<255,0,0>Enemy's miss, 80% chance to hit on your next strike, foils only
`<255,0,0>Required: 14 Deft, Light Blade Power 3"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.riposte
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_RIPOSTE_3
    [option]
        message ="&"+attacks/saber-human.png+"="+_ "Ability: Riposte Level 3
`Enemy's miss, 100% chance to hit on your next strike, foils only
`Required: 18 Deft, Light Blade Power 3"="18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.riposte
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.light_blade.damage
                    greater_than=2
                [/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=18
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=18
						[/variable]
					[/and]
				[/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.riposte add 1}
            {VARIABLE_OP current_unit.talentpoints add -18}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/saber-human.png+"="+_ "<255,0,0>Ability: Riposte Level 3
`<255,0,0>Enemy's miss, 100% chance to hit on your next strike, foils only
`<255,0,0>Required: 18 Deft, Light Blade Power 3"="#18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.riposte
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=18
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=18
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_POISON_THROWN_LIGHT_BLADE
    [option]
        message ="&"+attacks/dagger-thrown-poison-human.png+"="+_ "Ability: Poison Thrown Light Blade
`Add poison to thrown light blades
`Required: 6 Mind, Thrown Light Blades Power: 2"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.backstab
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.poison_thrown_light_blade
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.alignment
                        equals="chaotic"
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.weapon_skills.thrown_light_blade.damage
                            greater_than=1
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.variables.mind
                                greater_than_equal_to=6
                            [/variable]
                            [and]
                                [variable]
                                    name=current_unit.talentpoints
                                    greater_than_equal_to=6
                                [/variable]
                            [/and]
                        [/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.poison_thrown_light_blade 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/dagger-thrown-poison-human.png+"="+_ "<255,0,0>Ability: Poison Thrown Light Blade
`<255,0,0>Add poison to thrown light blades
`<255,0,0>Required: 6 Mind, Thrown Light Blades Power: 2"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.backstab
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.poison_thrown_light_blade
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.alignment
                        equals="chaotic"
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.weapon_skills.thrown_light_blade.damage
                            numerical_equals=1
                        [/variable]
                        [or]
                            [variable]
                                name=current_unit.variables.mind
                                less_than=6
                            [/variable]
                        [/or]
                        [or]
                            [variable]
                                name=current_unit.talentpoints
                                less_than=6
                            [/variable]
                        [/or]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_POISON_THROWN_LIGHT_BLADE_ORC 
    [option]
        message ="&"+attacks/dagger-thrown-poison-orcish.png+"="+_ "Ability: Poison Thrown Light Blade
`Add poison to thrown light blades
`Required: 4 Mind, Thrown Light Blades Power: 1"="4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.target
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.poison_thrown_light_blade_orc
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.alignment
                        equals="chaotic"
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.weapon_skills.thrown_light_blade.damage
                            greater_than=0
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.variables.mind
                                greater_than_equal_to=4
                            [/variable]
                            [and]
                                [variable]
                                    name=current_unit.talentpoints
                                    greater_than_equal_to=4
                                [/variable]
                            [/and]
                        [/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.poison_thrown_light_blade_orc 1}
            {VARIABLE_OP current_unit.talentpoints add -4}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/dagger-thrown-poison-orcish.png+"="+_ "<255,0,0>Ability: Poison Thrown Light Blade
`<255,0,0>Add poison to thrown light blades
`<255,0,0>Required: 4 Mind, Thrown Light Blades Power: 1"="#4"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.target
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.poison_thrown_light_blade_orc
                    numerical_equals=-1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.alignment
                        equals="chaotic"
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.weapon_skills.thrown_light_blade.damage
                            numerical_equals=1
                        [/variable]
                        [and]
                            [variable]
                                name=current_unit.variables.mind
                                less_than=4
                            [/variable]
                            [or]
	                            [variable]
	                                name=current_unit.talentpoints
	                                less_than=4
	                            [/variable]
	                        [/or]
						[/and]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MARKSMAN_1
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Marksman Level 1
`Gives bows 55% minimum chance to hit on offense
`Required: 10 Deft, Bow Power: 2"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=10
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=10
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.bow.damage
							greater_than=1
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.marksman 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Marksman Level 1
`<255,0,0>Gives bows 55% minimum chance to hit on offense
`<255,0,0>Required: Deft 10, Bow Power: 2"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=10
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=10
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.weapon_skills.bow.damage
						less_than=2
					[/variable]
				[/or]
				[not]
					[variable]
						name=current_unit.variables.weapon_skills.bow.damage
						less_than=1
					[/variable]
				[/not]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MARKSMAN_2
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Marksman Level 2
`Gives bows 60% minimum chance to hit on offense
`Required: 14 Deft, Bow Power: 3"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=14
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.bow.damage
							greater_than=2
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.marksman add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Marksman Level 2
`<255,0,0>Gives bows 60% minimum chance to hit on offense
`<255,0,0>Required: Deft 14, Bow Power: 3"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.weapon_skills.bow.damage
						less_than=3
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MARKSMAN_3
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Marksman Level 3
`Gives bows 65% minimum chance to hit on offense
`Required: 18 Deft, Bow Power: 3"="18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=18
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=18
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.bow.damage
							greater_than=2
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.marksman add 1}
            {VARIABLE_OP current_unit.talentpoints add -18}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Marksman Level 3
`<255,0,0>Gives bows 65% minimum chance to hit on offense
`<255,0,0>Required: Deft 18, Bow Power: 3"="#18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=18
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=18
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.weapon_skills.bow.damage
						less_than=3
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MARKSMAN_THROWN_LIGHT_BLADE_1
    [option]
        message ="&"+attacks/dagger-thrown-human.png+"="+_ "Ability: Marksman Level 1
`Gives thrown light blades 50% minimum chance to hit on offense
`Required: 6 Deft, Thrown Light Blade Power: 1"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman_thrown_light_blade
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=6
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=6
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.thrown_light_blade.damage
							greater_than=0
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.marksman_thrown_light_blade 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/dagger-thrown-human.png+"="+_ "<255,0,0>Ability: Marksman Level 1
`<255,0,0>Gives thrown light blades 50% minimum chance to hit on offense
`<255,0,0>Required: Deft 6, Thrown Light Blade Power: 1"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman_thrown_light_blade
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=6
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=6
					[/variable]
				[/or]
				[and]
					[variable]
						name=current_unit.variables.weapon_skills.thrown_light_blade.damage
						greater_than=0
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MARKSMAN_THROWN_LIGHT_BLADE_2
    [option]
        message ="&"+attacks/dagger-thrown-human.png+"="+_ "Ability: Marksman Level 2
`Gives thrown light blades 55% minimum chance to hit on offense
`Required: 10 Deft, Thrown Light Blade Power: 2"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman_thrown_light_blade
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=10
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=10
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.thrown_light_blade.damage
							greater_than=1
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.marksman_thrown_light_blade add 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/dagger-thrown-human.png+"="+_ "<255,0,0>Ability: Marksman Level 2
`<255,0,0>Gives thrown light blades 55% minimum chance to hit on offense
`<255,0,0>Required: Deft 10, Thrown Light Blade Power: 2"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman_thrown_light_blade
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=10
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=10
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.variables.weapon_skills.thrown_light_blade.damage
						less_than=2
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MARKSMAN_THROWN_LIGHT_BLADE_3
    [option]
        message ="&"+attacks/dagger-thrown-human.png+"="+_ "Ability: Marksman Level 3
`Gives thrown light blades 60% minimum chance to hit on offense
`Required: 14 Deft, Thrown Light Blade Power: 3"="18"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman_thrown_light_blade
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=14
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.thrown_light_blade.damage
							greater_than=2
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.marksman_thrown_light_blade add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/dagger-thrown-human.png+"="+_ "<255,0,0>Ability: Marksman Level 3
`<255,0,0>Gives thrown light blades 60% minimum chance to hit on offense
`<255,0,0>Required: Deft 14, Thrown Light Blade Power: 3"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.marksman_thrown_light_blade
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_BOW_1
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Bow Level 1
`If target is killed, can attack again with remaining ammo -1
`Required: 6 Deft, Bow Speed: 1"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_bow
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=6
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=6
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.bow.attack
							greater_than=0
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.remaining_ammo_bow 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Bow Level 1
`<255,0,0>If target is killed, can attack again with remaining ammo -1
`<255,0,0>Required: Deft 6, Bow Speed: 1"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_bow
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.weapon_skills.bow.attack
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=6
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=6
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_BOW_2
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Bow Level 2
`If target is killed, can attack again with remaining ammo
`Required: 10 Deft"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_bow
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=10
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=10
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.remaining_ammo_bow add 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Bow Level 2
`<255,0,0>If target is killed, can attack again with remaining ammo
`<255,0,0>Required: Deft 10"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_bow
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=10
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=10
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_BOW_3
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Bow Level 3
`If target is killed, can attack again with remaining ammo +1
`Required: 14 Deft"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_bow
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=14
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.remaining_ammo_bow add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Bow Level 3
`<255,0,0>If target is killed, can attack again with remaining ammo +1
`<255,0,0>Required: Deft 14"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_bow
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_JAVELIN_1
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Javelin Level 1
`If target is killed, can attack again with remaining ammo -1
`Required: 6 Deft, Javelin Speed: 1"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_javelin
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=6
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=6
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.javelin.attack
							greater_than=0
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.remaining_ammo_javelin 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Javelin Level 1
`<255,0,0>If target is killed, can attack again with remaining ammo -1
`<255,0,0>Required: Deft 6, Javelin Speed: 1"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_javelin
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.weapon_skills.javelin.attack
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=6
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=6
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_JAVELIN_2
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Javelin Level 2
`If target is killed, can attack again with remaining ammo
`Required: 10 Deft"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_javelin
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=10
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=10
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.remaining_ammo_javelin add 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Javelin Level 2
`<255,0,0>If target is killed, can attack again with remaining ammo
`<255,0,0>Required: Deft 10"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_javelin
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=10
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=10
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_JAVELIN_3
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Javelin Level 3
`If target is killed, can attack again with remaining ammo +1
`Required: 14 Deft"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_javelin
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=14
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.remaining_ammo_javelin add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Javelin Level 3
`<255,0,0>If target is killed, can attack again with remaining ammo +1
`<255,0,0>Required: Deft 14"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_javelin
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_THROWN_LIGHT_1
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Thrown Light Blade Level 1
`If target is killed, can attack again with remaining ammo -1
`Required: 6 Deft, Thrown Light Blade Speed: 1"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_light_blade
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=6
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=6
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.thrown_light_blade.attack
							greater_than=0
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.remaining_ammo_thrown_light_blade 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Thrown Light Blade Level 1
`<255,0,0>If target is killed, can attack again with remaining ammo -1
`<255,0,0>Required: Deft 6, Thrown Light Blade Speed: 1"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_light_blade
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.weapon_skills.thrown_light_blade.attack
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=6
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=6
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_THROWN_LIGHT_2
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Thrown Light Blade Level 2
`If target is killed, can attack again with remaining ammo
`Required: 10 Deft"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_light_blade
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=10
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=10
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.remaining_ammo_thrown_light_blade add 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Thrown Light Blade Level 2
`<255,0,0>If target is killed, can attack again with remaining ammo
`<255,0,0>Required: Deft 10"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_light_blade
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=10
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=10
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_THROWN_LIGHT_3
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Thrown Light Blade Level 3
`If target is killed, can attack again with remaining ammo +1
`Required: 14 Deft"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_light_blade
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=14
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.remaining_ammo_thrown_light_blade add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Thrown Light Blade Level 3
`<255,0,0>If target is killed, can attack again with remaining ammo +1
`<255,0,0>Required: Deft 14"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_light_blade
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_THROWN_HEAVY_1
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Thrown Heavy Blade Level 1
`If target is killed, can attack again with remaining ammo -1
`Required: 6 Deft, Thrown Heavy Blade Speed: 1"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=6
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=6
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.thrown_heavy_blade.attack
							greater_than=0
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Thrown Heavy Blade Level 1
`<255,0,0>If target is killed, can attack again with remaining ammo -1
`<255,0,0>Required: Deft 6, Thrown Heavy Blade Speed: 1"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.weapon_skills.thrown_heavy_blade.attack
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=6
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=6
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_THROWN_HEAVY_2
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Thrown Heavy Blade Level 2
`If target is killed, can attack again with remaining ammo
`Required: 10 Deft"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=10
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=10
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade add 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Thrown Heavy Blade Level 2
`<255,0,0>If target is killed, can attack again with remaining ammo
`<255,0,0>Required: Deft 10"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=10
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=10
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_AMMO_THROWN_HEAVY_3
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Remaining Ammo Thrown Heavy Blade Level 3
`If target is killed, can attack again with remaining ammo +1
`Required: 14 Deft"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=14
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Remaining Ammo Thrown Heavy Blade Level 3
`<255,0,0>If target is killed, can attack again with remaining ammo +1
`<255,0,0>Required: Deft 14"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.remaining_ammo_thrown_heavy_blade
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef


#define MENU_ABILITY_GOLIATH_BANE_1
    [option]
        message ="&"+attacks/sling.png+"="+_ "Ability: Goliath Bane Level 1
`10% damage bonus for each level of the enemy with slings on offense.
`Required: 6 Deft, Lob Damage: 1"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.goliath_bane
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=6
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=6
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.weapon_skills.lob.damage
							greater_than=0
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.goliath_bane 1}
            {VARIABLE_OP current_unit.talentpoints add -6}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/sling.png+"="+_ "<255,0,0>Ability: Goliath Bane Level 1
`<255,0,0>10% damage bonus for each level of the enemy with slings on offense.
`<255,0,0>Required: 6 Deft, Lob Damage: 1"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.goliath_bane
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.weapon_skills.lob.damage
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						less_than=6
					[/variable]
					[or]
						[variable]
							name=current_unit.talentpoints
							less_than=6
						[/variable]
					[/or]
				[/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_GOLIATH_BANE_2
    [option]
        message ="&"+attacks/sling.png+"="+_ "Ability: Goliath Bane Level 2
`20% damage bonus for each level of the enemy with slings on offense.
`Required: 10 Deft"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.goliath_bane
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=10
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=10
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.goliath_bane add 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/sling.png+"="+_ "<255,0,0>Ability: Goliath Bane Level 2
`<255,0,0>20% damage bonus for each level of the enemy with slings on offense.
`<255,0,0>Required: 10 Deft"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.goliath_bane
                numerical_equals=1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=10
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=10
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_GOLIATH_BANE_3
    [option]
        message ="&"+attacks/sling.png+"="+_ "Ability: Goliath Bane Level 3
`30% damage bonus for each level of the enemy with slings on offense.
`Required: 14 Deft"="14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.goliath_bane
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					greater_than_equal_to=14
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=14
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.goliath_bane add 1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/sling.png+"="+_ "<255,0,0>Ability: Goliath Bane Level 3
`<255,0,0>30% damage bonus for each level of the enemy with slings on offense.
`<255,0,0>Required: 14 Deft"="#14"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.goliath_bane
                numerical_equals=2
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.deft
					less_than=14
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=14
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_READIED_BOLT
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Readied Bolt
`Firststrike on crossbows
`Required: 8 Deft, Crossbow Speed 1"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.readied_bolt
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.crossbow.attack
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=8
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=8
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.readied_bolt 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Readied Bolt
`<255,0,0>Firststrike on crossbows
`<255,0,0>Required: 8 Deft, Crossbow Speed 1"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.readied_bolt
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.crossbow.attack
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=8
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=8
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_FIRE_SHOT_BOW
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Fire Shot Bow
`Add a bow fire attack 
`Required: 8 Deft, Bow Speed 1"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.fire_shot_bow
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.bow.attack
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=8
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=8
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.fire_shot_bow 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Fire Shot Bow
`<255,0,0>Add a bow fire attack 
`<255,0,0>Required: 8 Deft, Bow Speed 1"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.fire_shot_bow
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.bow.attack
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=8
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=8
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_FIRE_SHOT_XBOW
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "Ability: Fire Shot Crossbow
`Add a crossbow fire attack 
`Required: 8 Deft, Crossbow Speed 1"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.fire_shot_xbow
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.crossbow.attack
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=8
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.deft
                            greater_than_equal_to=8
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.fire_shot_xbow 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/marksman.png+"="+_ "<255,0,0>Ability: Fire Shot Crossbow
`<255,0,0>Add a crossbow fire attack 
`<255,0,0>Required: 8 Deft, Crossbow Speed 1"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.fire_shot_xbow
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.weapon_skills.crossbow.attack
                    greater_than_equal_to=1
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=8
                    [/variable]
                    [or]
                        [variable]
                            name=current_unit.variables.deft
                            less_than=8
                        [/variable]
                    [/or]
                [/and]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_SNEAK
    [option]
        message ="&"+upgrades/sneak.png+"="+_ "Ability: Sneak
`Unarmored units sneak if half or less movement is used
`Required: 12 Deft, Evade 3"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.sneak
                numerical_equals=-1
            [/variable]
            [and]
				[variable]
					name=current_unit.variables.evade_level
					greater_than_equal_to=3
				[/variable]
				[and]
					[variable]
						name=current_unit.variables.deft
						greater_than_equal_to=12
					[/variable]
					[and]
						[variable]
							name=current_unit.talentpoints
							greater_than_equal_to=12
						[/variable]
					[/and]
				[/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.sneak 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/sneak.png+"="+_ "<255,0,0>Ability: Sneak
`<255,0,0>Unarmored units sneak if half or less movement is used
`<255,0,0>Required: 12 Deft, Evade 3"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.sneak
                numerical_equals=-1
            [/variable]
			[and]
				[variable]
					name=current_unit.variables.evade_level
					less_than=3
				[/variable]
				[or]
					[variable]
						name=current_unit.variables.deft
						less_than=12
					[/variable]
				[/or]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=12
					[/variable]
				[/or]
				[not]
					[variable]
						name=current_unit.variables.evade_level
						less_than=1
					[/variable]
				[/not]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#magic abilities

#define MENU_ABILITY_MAGIC_INITIATE
    [option]
        message ="&"+categories/misc-scroll.png+"="+_ "Ability: Magical Initiate
`Spell: magic missile, 5-2 fire, +1 dmg/casting power
`Required: 8 Mind"="8"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.human_magic
				numerical_equals=-1
			[/variable]
			[and]
				[variable]
					name=current_unit.variables.mind
					greater_than_equal_to=8
				[/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=8
					[/variable]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.human_magic 1}
            {VARIABLE current_unit.variables.abilities.magic_casting.power 0}
            {VARIABLE current_unit.variables.abilities.magic_casting.speed 0}
            {VARIABLE_OP current_unit.talentpoints add -8}
			{VARIABLE current_unit.variables.abilities.magic_casting.max_mana $current_unit.variables.mind}
			{VARIABLE current_unit.variables.abilities.magic_casting.mana $current_unit.variables.abilities.magic_casting.max_mana}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
				[value]
                    user_name="mapping"
                    icon="categories/misc-scroll"
                    usable_self=1
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="mapping"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+categories/misc-scroll.png+"="+_ "<255,0,0>Ability: Magical Initiate
`<255,0,0>Spell: magic missile, 5-1 fire, +1 dmg/casting power
`<255,0,0>Required: 8 Mind"="#8"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.human_magic
				numerical_equals=-1
			[/variable]
			[and]
				[variable]
					name=current_unit.variables.mind
					less_than=8
				[/variable]
				[or]
					[variable]
						name=current_unit.talentpoints
						less_than=8
					[/variable]
				[/or]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_RED
    [option]
        message ="&"+attacks/fireball.png+"="+_ "Ability: Magic - Red Order
`Spell: fireball, 5-1 fire, +3 dmg/casting power
`Required: 10 Mind"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=10
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=10
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.human_magic add 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
            {VARIABLE current_unit.alignment "neutral"}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
				[value]
                    user_name="detect_units"
                    icon="categories/misc-scroll"
                    usable_self=1
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="detect_units"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+attacks/fireball.png+"="+_ "<255,0,0>Ability: Magic - Red Order
`<255,0,0>Spell: fireball, 5-1 fire, +3 dmg/casting power
`<255,0,0>Required: 10 Mind"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=10
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=10
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_WHITE
    [option]
        message ="&"+upgrades/spirit.png+"="+_ "Ability: Magic - White Order
`Spell: light beam, 5-1 arcane, +2 dmg/casting power
`Heals: +3 hp/casting power, 2 casting time
`Required: 12 Mind"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=12
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=12
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.human_magic add 2}
            {VARIABLE_OP current_unit.talentpoints add -12}
            [set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
                [value]
					#make construct unit that finds healing value and if cures
                    user_name="heals"
                    icon="potions/potion-blue"
                    usable_self=1
                    usable_other_adj=1
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="2 casting time"
                    command=white_healing
                [/value]
				[value]
                    user_name="protection_armor_magic"
                    icon="armor/shield"
                    usable_self=1
                    usable_other_adj=1
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="protection_armor_magic"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/spirit.png+"="+_ "<255,0,0>Ability: Magic - White Order
`<255,0,0>Spell: light beam, 5-1 arcane, +2 dmg/casting power
`<255,0,0>Heals: +3 hp/casting power, 2 casting time
`<255,0,0>Required: 12 Mind"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=12
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=12
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_SILVER
    [option]
        message ="&"+upgrades/silver_order.png+"="+_ "Ability: Magic - Silver Order
`Spell: magic missile, 5-2 fire, +1 dmg/casting power
`Teleport spell: 2+ casting time
`Required: 15 Mind"="15"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=15
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=15
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            [set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
                [value]
                    user_name="silver_teleport"
                    icon="upgrades/silver_order"
                    usable_self=0
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=1
                    usable_dis=1
                    infinite=1
					action_use="variable (2+) casting time"
                    command=silver_teleport
					mana_cost=3
                [/value]
				[value]
                    user_name="summon_fire_elemental"
                    icon="attacks/vortex"
                    usable_self=0
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=1
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command=summon_fire_elemental
					mana_cost=6
                [/value]
				[value]
                    user_name="summon_air_elemental"
                    icon="attacks/vortex"
                    usable_self=0
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=1
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command=summon_air_elemental
					mana_cost=6
                [/value]
				[value]
                    user_name="summon_earth_elemental"
                    icon="attacks/vortex"
                    usable_self=0
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=1
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command=summon_earth_elemental
					mana_cost=6
                [/value]
				[value]
                    user_name="summon_water_elemental"
                    icon="attacks/vortex"
                    usable_self=0
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=1
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command=summon_water_elemental
					mana_cost=6
                [/value]
            [/set_variables]
            {VARIABLE_OP current_unit.variables.abilities.human_magic add 2}
            {VARIABLE_OP current_unit.talentpoints add -15}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/silver_order.png+"="+_ "<255,0,0>Ability: Magic - Silver Order
`<255,0,0>Spell: magic missile, 5-1 fire, +1 dmg/casting power
`<255,0,0>Teleport spell
`<255,0,0>Required: 15 Mind"="#15"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=15
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=15
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_ELDER
    [option]
        message ="&"+attacks/lightning.png+"="+_ "Ability: Magic - Elder Order
`Spell: lightning, 3-(-1) fire, +4 dmg/casting power
`Required: 20 Mind"="20"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=20
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=20
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.human_magic add 3}
            {VARIABLE_OP current_unit.talentpoints add -20}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
                [value]
                    user_name="phoenix_fire"
                    icon="attacks/fireball"
                    usable_self=1
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="4 casting time"
                    command="phoenix_fire"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+attacks/lightning.png+"="+_ "<255,0,0>Ability: Magic - Elder Order
`<255,0,0>Spell: lightning, 5-0 fire, +4 dmg/casting power
`<255,0,0>Required: 20 Mind"="#20"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=2
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=20
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=20
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_DARK
    [option]
        message ="&"+attacks/staff-necromantic.png+"="+_ "Ability: Dark Magic
`Spell: chill wave, 9-1 cold, +2 dmg/casting power
`Spell: shadow wave, 6-1 cold, +2 dmg/casting power
`Required: 5 Mind"="5"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.dark_magic
				numerical_equals=-1
			[/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=5
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=5
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.dark_magic 1}
            {VARIABLE_OP current_unit.talentpoints add -5}
            {VARIABLE current_unit.variables.abilities.magic_casting.power 0}
            {VARIABLE current_unit.variables.abilities.magic_casting.speed 0}
			{VARIABLE current_unit.variables.abilities.magic_casting.max_mana $current_unit.variables.mind}
			{VARIABLE current_unit.variables.abilities.magic_casting.mana $current_unit.variables.abilities.magic_casting.max_mana}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
				[value]
                    user_name="mapping"
                    icon="categories/misc-scroll"
                    usable_self=1
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="mapping"
                [/value]
            [/set_variables]
		[/command]
    [/option]
    [option]
        message ="&"+attacks/staff-necromantic.png+"="+_ "<255,0,0>Ability: Dark Magic
`<255,0,0>Spell: chill wave, 9-1 cold, +2 dmg/casting power
`<255,0,0>Spell: shadow wave, 6-1 arcane, +2 dmg/casting power
`<255,0,0>Required: 5 Mind"="#5"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.dark_magic
				numerical_equals=-1
			[/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=5
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=5
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_DARK_INITIATE
    [option]
        message ="&"+attacks/staff-necromantic.png+"="+_ "Ability: Dark Magic
`Spell: chill wave, 9-1 cold, +2 dmg/casting power
`Spell: shadow wave, 6-1 cold, +2 dmg/casting power"="0"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.human_magic
                numerical_equals=1
            [/variable]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.dark_magic 1}
            {VARIABLE current_unit.variables.abilities.human_magic 0}
            {VARIABLE current_unit.alignment "chaotic"}
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_FAERIE
    [option]
        message ="&"+attacks/faerie-fire.png+"="+_ "Ability: Faerie Magic
`Spell: faerie fire, 2-3 arcane, +2 dmg/casting power
`Required: 6 Mind"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.faerie_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=6
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=6
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.faerie_magic 1}
			[if]
				[variable]
					name=current_unit.variables.abilities.magic_casting.power
					numerical_equals=-1
				[/variable]
				[then]
		            {VARIABLE current_unit.variables.abilities.magic_casting.power 0}
		            {VARIABLE current_unit.variables.abilities.magic_casting.speed 0}
					{VARIABLE current_unit.variables.abilities.magic_casting.max_mana $current_unit.variables.mind}
					{VARIABLE current_unit.variables.abilities.magic_casting.mana $current_unit.variables.abilities.magic_casting.max_mana}
				[/then]
			[/if]
			{VARIABLE current_unit.variables.abilities.faerie_touch -1}
            {VARIABLE_OP current_unit.talentpoints add -6}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
				[value]
                    user_name="detect_units"
                    icon="categories/misc-scroll"
                    usable_self=1
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="detect_units"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+attacks/faerie-fire.png+"="+_ "<255,0,0>Ability: Faerie Magic
`<255,0,0>Spell: faerie fire, 2-3 arcane, +2 dmg/casting power
`<255,0,0>Required: 6 Mind"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.faerie_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=6
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=6
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABLITY_FAERIE_TOUCH
	[option]
		message="&"+attacks/touch-faerie.png+"="+_ "Ability: Faerie Touch
`Fist attack becomes magical, damage/strike bonuses
`determined by casting power/casting speed
`Required: 10 Mind"="10"
		[show_if]
			[variable]
                name=current_unit.variables.abilities.faerie_magic
                numerical_equals=1
            [/variable]
			[and]
				[variable]
	                name=current_unit.variables.abilities.faerie_touch
	                numerical_equals=-1
	            [/variable]
				[and]
	                [variable]
	                    name=current_unit.variables.mind
	                    greater_than_equal_to=10
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.talentpoints
	                        greater_than_equal_to=10
	                    [/variable]
	                [/and]
				[/and]
            [/and]
		[/show_if]
		[command]
			{VARIABLE current_unit.variables.abilities.faerie_touch 1}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].icon "touch-faerie"}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].user_name ("faerie touch")}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].description (_ "faerie touch")}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].class "fey"}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].class_description ("Fey")}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].body_damage_rate 0}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].deft_damage_rate 5}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].mind_damage_rate 10}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].deft_number_rate 5}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].mind_number_rate 5}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].special_type.magical_to_hit 1}
			{APPLY_WEAPON_SPECIAL_DESCRIPTION current_unit.variables.inventory.weapons.melee[0]}
			{VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
	[/option]
	[option]
		message="&"+attacks/touch-faerie.png+"="+_ "<255,0,0>Ability: Faerie Touch
`<255,0,0>Fist attack becomes magical, damage/strike bonuses
`<255,0,0>determined by casting power/casting speed
`<255,0,0>Required: 10 Mind"="#10"
		[show_if]
			[variable]
                name=current_unit.variables.abilities.faerie_magic
                numerical_equals=1
            [/variable]
			[and]
				[variable]
	                name=current_unit.variables.abilities.faerie_touch
	                numerical_equals=-1
	            [/variable]
				[and]
	                [variable]
	                    name=current_unit.variables.mind
	                    less_than=10
	                [/variable]
	                [or]
	                    [variable]
	                        name=current_unit.talentpoints
	                        less_than=10
	                    [/variable]
	                [/or]
				[/and]
            [/and]
		[/show_if]
		[command]
        [/command]
	[/option]
#enddef

#define MENU_ABLITY_ELDRITCH_TOUCH
	[option]
		message="&"+attacks/touch-faerie.png+"="+_ "Ability: Eldritch Touch
`Faerie Touch deals arcane damage
`Required: 14 Mind"="14"
		[show_if]
			[variable]
                name=current_unit.variables.abilities.faerie_touch
                numerical_equals=1
            [/variable]
			[and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=14
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=14
                    [/variable]
                [/and]
			[/and]
		[/show_if]
		[command]
			{VARIABLE_OP current_unit.variables.abilities.faerie_touch add 1}
			{VARIABLE current_unit.variables.inventory.weapons.melee[0].type "arcane"}
			{APPLY_WEAPON_SPECIAL_DESCRIPTION current_unit.variables.inventory.weapons.melee[0]}
			{VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
	[/option]
	[option]
		message="&"+attacks/touch-faerie.png+"="+_ "<255,0,0>Ability: Eldritch Touch
`<255,0,0>Faerie Touch deals arcane damage
`<255,0,0>Required: 14 Mind"="#14"
		[show_if]
			[variable]
                name=current_unit.variables.abilities.faerie_touch
                numerical_equals=1
            [/variable]
			[and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=14
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=14
                    [/variable]
                [/or]
			[/and]
		[/show_if]
		[command]
        [/command]
	[/option]
#enddef

#define MENU_ABILITY_MAGIC_WOOD
    [option]
        message ="&"+attacks/entangle.png+"="+_ "Ability: Forest Magic
`Spell: vines, 3-1 impact, +1 dmg/casting power
`Required: 5 Mind"="5"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wood_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=5
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=5
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.wood_magic 1}
			[if]
				[variable]
					name=current_unit.variables.abilities.magic_casting.power
					numerical_equals=-1
				[/variable]
				[then]
		            {VARIABLE current_unit.variables.abilities.magic_casting.power 0}
		            {VARIABLE current_unit.variables.abilities.magic_casting.speed 0}
					{VARIABLE current_unit.variables.abilities.magic_casting.max_mana $current_unit.variables.mind}
					{VARIABLE current_unit.variables.abilities.magic_casting.mana $current_unit.variables.abilities.magic_casting.max_mana}
				[/then]
			[/if]
			{VARIABLE current_unit.variables.abilities.vine_ensnare -1}
			{VARIABLE current_unit.variables.abilities.vine_slows -1}
            {VARIABLE_OP current_unit.talentpoints add -5}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
				[value]
                    user_name="protection_from_poison"
                    icon="categories/misc-scroll"
                    usable_self=1
                    usable_other_adj=1
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="protection_from_poison"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+attacks/entangle.png+"="+_ "<255,0,0>Ability: Forest Magic
`<255,0,0>Spell: vines, 3-1 impact, +1 dmg/casting power
`<255,0,0>Required: 5 Mind"="#5"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wood_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=5
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=5
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_BRAMBLES
    [option]
        message ="&"+attacks/thorns.png+"="+_ "Ability: Magic - Brambles
`Spell: vines, 8-1 impact, +2 dmg/casting power, excludes Nature's Balm
`Required: 8 Mind"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wood_magic
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=8
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=8
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
			{VARIABLE_OP current_unit.variables.abilities.wood_magic add 1}
			{VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/thorns.png+"="+_ "<255,0,0>Ability: Magic - Brambles
`<255,0,0>Spell: vines, 6-1 impact, +2 dmg/casting power, excludes Nature's Balm
`<255,0,0>Required: 8 Mind"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wood_magic
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=8
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_NATURE_HEAL
    [option]
        message ="&"+attacks/entangle.png+"="+_ "Ability: Magic - Nature's Balm
`Heals: +2 hp/casting power, 2 casting time, excludes Brambles
`Required: 8 Mind"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wood_magic
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=8
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=8
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.wood_magic add 2}
            {VARIABLE_OP current_unit.talentpoints add -8}
            [set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
                [value]
					#make construct unit that finds healing value and if cures
                    user_name="heals"
                    icon="potions/potion-blue"
                    usable_self=1
                    usable_other_adj=1
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="2 casting time"
                    command=green_healing
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+attacks/entangle.png+"="+_ "<255,0,0>Ability: Magic - Nature's Balm
`<255,0,0>Heals: +2 hp/casting power, 2 casting time, excludes Brambles
`<255,0,0>Required: 8 Mind"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.wood_magic
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=8
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_VINE_ENSNARE_1
    [option]
        message ="&"+attacks/entangle.png+"="+_ "Ability: Grasping Vines Level 1
`Vines gain 5% chance to hit on each hit
`Required: 8 Mind, Casting Power 1"="8"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.wood_magic
				greater_than=0
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.vine_ensnare
	                numerical_equals=-1
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.abilities.magic_casting.power
	                    greater_than_equal_to=1
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.talentpoints
	                        greater_than_equal_to=8
	                    [/variable]
	                    [and]
	                        [variable]
	                            name=current_unit.variables.mind
	                            greater_than_equal_to=8
	                        [/variable]
	                    [/and]
	                [/and]
	            [/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.vine_ensnare 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/entangle.png+"="+_ "<255,0,0>Ability: Grasping Vines Level 1
`<255,0,0>Vines gain 5% chance to hit on each hit
`<255,0,0>Required: 8 Mind, Casting Power 1"="#8"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.wood_magic
				greater_than=0
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.vine_ensnare
	                numerical_equals=-1
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.abilities.magic_casting.power
	                    greater_than_equal_to=1
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.talentpoints
	                        less_than=8
	                    [/variable]
	                    [or]
	                        [variable]
	                            name=current_unit.variables.mind
	                            less_than=8
	                        [/variable]
	                    [/or]
	                [/and]
	            [/and]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_VINE_ENSNARE_2
    [option]
        message ="&"+attacks/entangle.png+"="+_ "Ability: Grasping Vines Level 2
`Vines gain 10% chance to hit on each hit
`Required: 12 Mind, Casting Power 2"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.vine_ensnare
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.magic_casting.power
                    greater_than_equal_to=2
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=12
                    [/variable]
                    [and]
                        [variable]
                            name=current_unit.variables.mind
                            greater_than_equal_to=12
                        [/variable]
                    [/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.vine_ensnare add 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/entangle.png+"="+_ "<255,0,0>Ability: Grasping Vines Level 2
`<255,0,0>Vines gain 10% chance to hit on each hit
`<255,0,0>Required: 12 Mind, Casting Power 2"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.vine_ensnare
                numerical_equals=1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.abilities.magic_casting.power
                    less_than=2
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=12
                    [/variable]
                [/or]
				[or]
					[variable]
						name=current_unit.variables.mind
						less_than=12
					[/variable]
				[/or]
            [/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_VINE_ENSNARE_3
    [option]
        message ="&"+attacks/entangle.png+"="+_ "Ability: Grasping Vines Level 3
`Vines gain 15% chance to hit on each hit
`Required: 16 Mind"="16"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.wood_magic
				numerical_equals=2
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.vine_ensnare
	                numerical_equals=2
	            [/variable]
				[and]
					[variable]
						name=current_unit.talentpoints
						greater_than_equal_to=16
					[/variable]
					[and]
						[variable]
							name=current_unit.variables.mind
							greater_than_equal_to=16
						[/variable]
					[/and]
				[/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.vine_ensnare add 1}
            {VARIABLE_OP current_unit.talentpoints add -16}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/entangle.png+"="+_ "<255,0,0>Ability: Grasping Vines Level 3
`<255,0,0>Vines gain 15% chance to hit on each hit
`<255,0,0>Required: 16 Mind"="#16"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.wood_magic
				numerical_equals=2
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.vine_ensnare
	                numerical_equals=2
	            [/variable]
	            [and]
					[variable]
						name=current_unit.talentpoints
						less_than=16
					[/variable]
					[or]
						[variable]
							name=current_unit.variables.mind
							less_than=16
						[/variable]
					[/or]
				[/and]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_VINE_SLOWS
    [option]
        message ="&"+attacks/entangle.png+"="+_ "Ability: Entangling Vines
`Vines slow enemies on a successful attack
`Required: 12 Mind, Grasping Vines 1, Casting Power 2"="12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.vine_ensnare
                greater_than=0
            [/variable]
			[and]
				[variable]
	                name=current_unit.variables.abilities.vine_slows
	                numerical_equals=-1
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.abilities.magic_casting.power
	                    greater_than_equal_to=2
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.talentpoints
	                        greater_than_equal_to=12
	                    [/variable]
	                    [and]
	                        [variable]
	                            name=current_unit.variables.mind
	                            greater_than_equal_to=12
	                        [/variable]
	                    [/and]
	                [/and]
	            [/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.vine_slows 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/entangle.png+"="+_ "<255,0,0>Ability: Entangling Vines
`<255,0,0>Vines slow enemies on a successful attack
`<255,0,0>Required: 12 Mind, Grasping Vines 1, Casting Power 2"="#12"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.vine_ensnare
                numerical_equals=1
            [/variable]
			[and]
				[variable]
	                name=current_unit.variables.abilities.vine_slows
	                numerical_equals=-1
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.abilities.magic_casting.power
	                    less_than=2
	                [/variable]
	                [or]
	                    [variable]
	                        name=current_unit.talentpoints
	                        less_than=12
	                    [/variable]
	                [/or]
					[or]
						[variable]
							name=current_unit.variables.mind
							less_than=12
						[/variable]
					[/or]
	            [/and]
			[/and]
            [command]
            [/command]
        [/show_if]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_RUNIC
    [option]
        message ="&"+upgrades/rune-stone-dark.png+"="+_ "Ability: Runic Magic
`Spell: lightning, 3-1 fire, +2 dmg/casting power
`Required: 7 Mind"="7"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.runic_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=7
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=7
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.runic_magic 1}
            {VARIABLE current_unit.variables.abilities.magic_casting.power 0}
            {VARIABLE current_unit.variables.abilities.magic_casting.speed 0}
			{VARIABLE current_unit.variables.abilities.magic_casting.max_mana $current_unit.variables.mind}
			{VARIABLE current_unit.variables.abilities.magic_casting.mana $current_unit.variables.abilities.magic_casting.max_mana}
            {VARIABLE_OP current_unit.talentpoints add -7}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
				[value]
                    user_name="detect_gold"
                    icon="categories/misc-scroll"
                    usable_self=1
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="detect_gold"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/rune-stone-dark.png+"="+_ "<255,0,0>Ability: Runic Magic
`<255,0,0>Spell: lightning, 3-1 fire, +2 dmg/casting power
`<255,0,0>Required: 7 Mind"="#7"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.runic_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=7
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=7
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_TROLL
    [option]
        message ="&"+upgrades/rune-stone-dark.png+"="+_ "Ability: Troll Magic
`Spell: flame blast, 7-2 fire, +1 dmg/casting power
`Required: 8 Mind"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.troll_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=8
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=8
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.troll_magic 1}
            {VARIABLE current_unit.variables.abilities.magic_casting.power 0}
            {VARIABLE current_unit.variables.abilities.magic_casting.speed 0}
			{VARIABLE current_unit.variables.abilities.magic_casting.max_mana $current_unit.variables.mind}
			{VARIABLE current_unit.variables.abilities.magic_casting.mana $current_unit.variables.abilities.magic_casting.max_mana}
            {VARIABLE_OP current_unit.talentpoints add -8}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
				[value]
                    user_name="protection_armor_magic"
                    icon="armor/shield"
                    usable_self=1
                    usable_other_adj=1
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="protection_armor_magic"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/rune-stone-dark.png+"="+_ "<255,0,0>Ability: Troll Magic
`<255,0,0>Spell: flame blast, 7-2 fire, +1 dmg/casting power
`<255,0,0>Required: 8 Mind"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.troll_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=8
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_SWAMP
    [option]
        message ="&"+upgrades/rune-stone-dark.png+"="+_ "Ability: Swamp Magic
`Spell: curse, 4-2 cold, +1 dmg/casting power
`Heals: +1 hp/casting power, 2 casting time
`Required: 6 Mind"="6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.swamp_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=6
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=6
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.swamp_magic 1}
            {VARIABLE current_unit.variables.abilities.magic_casting.power 0}
            {VARIABLE current_unit.variables.abilities.magic_casting.speed 0}
			{VARIABLE current_unit.variables.abilities.benevolent -1}
			{VARIABLE current_unit.variables.abilities.baleful -1}
			{VARIABLE current_unit.variables.abilities.magic_casting.max_mana $current_unit.variables.mind}
			{VARIABLE current_unit.variables.abilities.magic_casting.mana $current_unit.variables.abilities.magic_casting.max_mana}
            {VARIABLE_OP current_unit.talentpoints add -6}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
                [value]
					#make construct unit that finds healing value and if cures
                    user_name="heals"
                    icon="potions/potion-blue"
                    usable_self=1
                    usable_other_adj=1
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="2 casting time"
                    command=spirit_healing
                [/value]
				[value]
                    user_name="protection_from_poison"
                    icon="categories/misc-scroll"
                    usable_self=1
                    usable_other_adj=1
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="protection_from_poison"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/rune-stone-dark.png+"="+_ "<255,0,0>Ability: Swamp Magic
`<255,0,0>Spell: curse, 4-2 cold, +1 dmg/casting power
`<255,0,0>Heals: +1 hp/casting power, 2 casting time
`<255,0,0>Required: 6 Mind"="#6"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.swamp_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=6
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=6
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_TRIBAL
    [option]
        message ="&"+upgrades/rune-stone-dark.png+"="+_ "Ability: Tribal Magic
`Spell: curse, 6-1 pierce, drains, +1 dmg/casting power
`Required: 8 Mind"="8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.tribal_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=8
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=8
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.tribal_magic 1}
            {VARIABLE current_unit.variables.abilities.magic_casting.power 0}
            {VARIABLE current_unit.variables.abilities.magic_casting.speed 0}
			{VARIABLE current_unit.variables.abilities.magic_casting.max_mana $current_unit.variables.mind}
			{VARIABLE current_unit.variables.abilities.magic_casting.mana $current_unit.variables.abilities.magic_casting.max_mana}
            {VARIABLE_OP current_unit.talentpoints add -8}
			[set_variables]
                name=current_unit.variables.inventory.spells
                mode=append
				[value]
                    user_name="improved_detect_units"
                    icon="categories/misc-scroll"
                    usable_self=1
                    usable_other_adj=0
                    usable_other_dis=0
                    usable_adj=0
                    usable_dis=0
                    infinite=1
					action_use="3 casting time"
                    command="improved_detect_units"
                [/value]
            [/set_variables]
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/rune-stone-dark.png+"="+_ "<255,0,0>Ability: Tribal Magic
`<255,0,0>Spell: curse, 6-1 pierce, drains, +1 dmg/casting power
`<255,0,0>Required: 8 Mind"="#8"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.tribal_magic
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=8
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=8
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_BENEVOLENT
    [option]
        message ="&"+upgrades/spirit.png+"="+_ "Ability: Magic - Benevolent Spirits
`Improves healing by +2 hp/casting power, excludes Baleful Spirits
`Required: 10 Mind"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.benevolent
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=10
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=10
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
			{VARIABLE current_unit.variables.abilities.baleful 0}
			{VARIABLE current_unit.variables.abilities.benevolent 1}
			{VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/spirit.png+"="+_ "<255,0,0>Ability: Magic - Benevolent Spirits
`<255,0,0>Improves healing by +2 hp/casting power, excludes Baleful Spirits
`<255,0,0>Required: 10 Mind"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.benevolent
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=10
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=10
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_BALEFUL
    [option]
        message ="&"+attacks/curse.png+"="+_ "Ability: Magic - Baleful Spirits
`Improves curse by +2 dmg/casting power, excludes Benevolent Spirits
`Required: 10 Mind"="10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.baleful
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=10
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=10
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
			{VARIABLE current_unit.variables.abilities.baleful 1}
			{VARIABLE current_unit.variables.abilities.benevolent 0}
			{VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/curse.png+"="+_ "<255,0,0>Ability: Magic - Baleful Spirits
`<255,0,0>Improves curse by +2 dmg/casting power, excludes Benevolent Spirits
`<255,0,0>Required: 10 Mind"="#10"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.baleful
                numerical_equals=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=10
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=10
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_WHITE_ILLUMINATES
    [option]
        message ="&"+upgrades/spirit.png+"="+_ "Ability: Illuminates
`Illuminate your surroundings
`Required: 16 Mind, Casting Power: 3"="16"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.illuminates
				numerical_not_equals=1
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.magic_casting.power
	                greater_than=2
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.abilities.human_magic
	                    numerical_equals=3
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.talentpoints
	                        greater_than_equal_to=16
	                    [/variable]
	                    [and]
	                        [variable]
	                            name=current_unit.variables.mind
	                            greater_than_equal_to=16
	                        [/variable]
	                    [/and]
	                [/and]
	            [/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.illuminates	1}
            {VARIABLE_OP current_unit.talentpoints add -14}
        [/command]
    [/option]
    [option]
        message ="&"+upgrades/spirit.png+"="+_ "<255,0,0>Ability: Illuminates
`<255,0,0>Illuminate your surroundings
`<255,0,0>Required: 16 Mind, Casting Power: 3"="#16"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.illuminates
				numerical_not_equals=1
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.human_magic
	                numerical_equals=3
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.abilities.magic_casting.power
	                    less_than=3
	                [/variable]
	                [or]
	                    [variable]
	                        name=current_unit.talentpoints
	                        less_than=16
	                    [/variable]
	                [/or]
	                [or]
	                    [variable]
	                        name=current_unit.variables.mind
	                        less_than=16
	                    [/variable]
	                [/or]
	            [/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_WHITE_METAL_TO_ARCANE
    [option]
        message ="&"+attacks/sword-holy.png+"="+_ "Ability: Bless Weapon
`Enbue any metal weapon with arcane damage type
`Required: 10 Mind, 10 Body, 10 Deft"="10"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.metal_to_arcane
				numerical_not_equals=1
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.human_magic
	                numerical_equals=3
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.mind
	                    greater_than_equal_to=10
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.variables.body
	                        greater_than=9
	                    [/variable]
	                    [and]
	                        [variable]
	                            name=current_unit.variables.deft
	                            greater_than=9
	                        [/variable]
	                        [and]
	                            [variable]
	                                name=current_unit.talentpoints
	                                greater_than_equal_to=10
	                            [/variable]
	                        [/and]
	                    [/and]
	                [/and]
	            [/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.metal_to_arcane 1}
            {VARIABLE_OP current_unit.talentpoints add -10}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/sword-holy.png+"="+_ "<255,0,0>Ability: Bless Weapon
`<255,0,0>Enbue any metal weapon with arcane damage type
`<255,0,0>Required: 10 Mind, 10 Body, 10 Deft"="#10"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.metal_to_arcane
				numerical_not_equals=1
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.human_magic
	                numerical_equals=3
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.variables.mind
	                    less_than=10
	                [/variable]
	                [or]
	                    [variable]
	                        name=current_unit.variables.body
	                        less_than_equal_to=9
	                    [/variable]
	                [/or]
	                [or]
	                    [variable]
	                        name=current_unit.variables.deft
	                        less_than_equal_to=9
	                    [/variable]
	                [/or]
	                [or]
	                    [variable]
	                        name=current_unit.talentpoints
	                        less_than=10
	                    [/variable]
	                [/or]
	            [/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_DARK_PLAGUE
    [option]
        message ="&"+attacks/staff-plague.png+"="+_ "Ability: Plague
`Enbue a Necromancer's Staff with plague
`Required: 8 Mind, Casting Power: 1"="8"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.plague
				numerical_not_equals=1
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.dark_magic
	                numerical_equals=1
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.talentpoints
	                    greater_than_equal_to=8
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.variables.abilities.magic_casting.power
	                        greater_than_equal_to=1
	                    [/variable]
	                    [and]
	                        [variable]
	                            name=current_unit.variables.mind
	                            greater_than_equal_to=8
	                        [/variable]
	                    [/and]
	                [/and]
	            [/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.plague 1}
            {VARIABLE_OP current_unit.talentpoints add -8}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/staff-plague.png+"="+_ "<255,0,0>Ability: Plague
`<255,0,0>Enbue a Necromancer's Staff with plague
`<255,0,0>Required: 8 Mind, Casting Power: 1"="#8"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.plague
				numerical_not_equals=1
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.dark_magic
	                numerical_equals=1
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.talentpoints
	                    less_than=8
	                [/variable]
	                [or]
	                    [variable]
	                        name=current_unit.variables.abilities.magic_casting.power
	                        less_than=1
	                    [/variable]
	                [/or]
	                [or]
	                    [variable]
	                        name=current_unit.variables.mind
	                        less_than=8
	                    [/variable]
	                [/or]
	            [/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_MAGIC_DARK_SOULTRAP
    [option]
        message ="&"+attacks/wail.png+"="+_ "Ability: Soul Trap
`Entrap a soul by sacrificing a living being with a dagger
`Required: 12 Mind, Casting Power: 2"="12"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.soultrap
				numerical_not_equals=1
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.dark_magic
	                numerical_equals=1
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.talentpoints
	                    greater_than_equal_to=12
	                [/variable]
	                [and]
	                    [variable]
	                        name=current_unit.variables.abilities.magic_casting.power
	                        greater_than_equal_to=2
	                    [/variable]
	                    [and]
	                        [variable]
	                            name=current_unit.variables.mind
	                            greater_than_equal_to=12
	                        [/variable]
	                    [/and]
	                [/and]
	            [/and]
			[/and]
        [/show_if]
        [command]
            {VARIABLE current_unit.variables.abilities.soultrap 1}
            {VARIABLE_OP current_unit.talentpoints add -12}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/wail.png+"="+_ "<255,0,0>Ability: Soul Trap
`<255,0,0>Entrap a soul by sacrificing a living being with a dagger
`<255,0,0>Required: 12 Mind, Casting Power: 2"="#12"
        [show_if]
			[variable]
				name=current_unit.variables.abilities.soultrap
				numerical_not_equals=1
			[/variable]
			[and]
	            [variable]
	                name=current_unit.variables.abilities.dark_magic
	                numerical_equals=1
	            [/variable]
	            [and]
	                [variable]
	                    name=current_unit.talentpoints
	                    less_than=12
	                [/variable]
	                [or]
	                    [variable]
	                        name=current_unit.variables.abilities.magic_casting.power
	                        less_than=2
	                    [/variable]
	                [/or]
	                [or]
	                    [variable]
	                        name=current_unit.variables.mind
	                        less_than=12
	                    [/variable]
	                [/or]
	            [/and]
			[/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_UPGRADE_MAGIC_CASTING_POWER
    [option]
        message ="&"+potions/potion-red-huge.png+"="+_ "Casting Power, Current level: $current_unit.variables.abilities.magic_casting.power|
`Add damage to magic attacks, according to order. 
`Required: $magic_power_cost| Mind"="$magic_power_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.magic_casting.power
                greater_than=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=$magic_power_cost
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=$magic_power_cost
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.magic_casting.power add 1}
            {VARIABLE_OP current_unit.talentpoints add -$magic_power_cost}
        [/command]
    [/option]
    [option]
        message ="&"+potions/potion-red-huge.png+"="+_ "<255,0,0>Casting Power, Current level: $current_unit.variables.abilities.magic_casting.power|
`<255,0,0>Add damage to magic attacks according to order. 
`<255,0,0>Required: $magic_power_cost| Mind"="#$magic_power_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.magic_casting.power
                greater_than=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=$magic_power_cost
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=$magic_power_cost
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_UPGRADE_MAGIC_CASTING_SPEED
    [option]
        message ="&"+potions/potion-blue-big.png+"="+_ "Casting Speed, Current level: $current_unit.variables.abilities.magic_casting.speed|
`Add 1 to magic strikes, +1 casting time per simple action. 
`Required: $magic_speed_cost| Mind"="$magic_speed_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.magic_casting.speed
                greater_than=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=$magic_speed_cost
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=$magic_speed_cost
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.magic_casting.speed add 1}
            {VARIABLE_OP current_unit.talentpoints add -$magic_speed_cost}
        [/command]
    [/option]
    [option]
        message ="&"+potions/potion-blue-big.png+"="+_ "<255,0,0>Casting Speed, Current level: $current_unit.variables.abilities.magic_casting.speed|
`<255,0,0>Add 1 to magic strikes, +1 casting time per simple action. 
`<255,0,0>Required: $magic_speed_cost| Mind"="#$magic_speed_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.magic_casting.speed
                greater_than=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=$magic_speed_cost
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=$magic_speed_cost
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_UPGRADE_HAMMER_FOCUS
    [option]
        message ="&"+attacks/hammer-dwarven-runic.png+"="+_ "Martial Focus, Current level: $current_unit.variables.abilities.magic_casting.focus|
`If caster's primary weapon is a hammer or runic hammer,
`reduce effect of armor penalty on Runic Magic by 3%/level
`Required: $magic_focus_cost| Body, $magic_focus_cost| Mind"="$magic_focus_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.runic_magic
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=$magic_focus_cost
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=$magic_focus_cost
                    [/variable]
					[and]
						[variable]
	                        name=current_unit.variables.body
	                        greater_than_equal_to=$magic_focus_cost
						[/variable]
					[/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.magic_casting.focus add 1}
            {VARIABLE_OP current_unit.talentpoints add -$magic_focus_cost}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/hammer-dwarven-runic.png+"="+_ "<255,0,0>Martial Focus, Current level: $current_unit.variables.abilities.magic_casting.focus|
`<255,0,0>If caster's primary weapon is a hammer or runic hammer,
`<255,0,0>reduce effect of armor penalty on Runic Magic by 3%/level
`<255,0,0>Required: $magic_focus_cost| Body, $magic_focus_cost| Mind"="#$magic_focus_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.runic_magic
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=$magic_focus_cost
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=$magic_focus_cost
                    [/variable]
					[or]
						[variable]
	                        name=current_unit.variables.body
	                        less_than=$magic_focus_cost
						[/variable]
					[/or]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_UPGRADE_SWORD_FOCUS
    [option]
        message ="&"+icons/sword-faerie.png+"="+_ "Martial Focus, Current level: $current_unit.variables.abilities.magic_casting.focus|
`If caster's primary weapon is a sword (light or heavy),
`reduce effect of armor penalty on Faerie Magic by 3%/level
`Required: $magic_focus_cost| Body, $magic_focus_cost| Mind"="$magic_focus_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.faerie_magic
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    greater_than_equal_to=$magic_focus_cost
                [/variable]
                [and]
                    [variable]
                        name=current_unit.variables.mind
                        greater_than_equal_to=$magic_focus_cost
                    [/variable]
					[and]
						[variable]
	                        name=current_unit.variables.body
	                        greater_than_equal_to=$magic_focus_cost
						[/variable]
					[/and]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.magic_casting.focus add 1}
            {VARIABLE_OP current_unit.talentpoints add -$magic_focus_cost}
        [/command]
    [/option]
    [option]
        message ="&"+icons/sword-faerie.png+"="+_ "<255,0,0>Martial Focus, Current level: $current_unit.variables.abilities.magic_casting.focus|
`<255,0,0>If caster's primary weapon is a sword (light or heavy),
`<255,0,0>reduce effect of armor penalty on Faerie Magic by 3%/level
`<255,0,0>Required: $magic_focus_cost| Body, $magic_focus_cost| Mind"="#$magic_focus_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.faerie_magic
                greater_than=0
            [/variable]
            [and]
                [variable]
                    name=current_unit.talentpoints
                    less_than=$magic_focus_cost
                [/variable]
                [or]
                    [variable]
                        name=current_unit.variables.mind
                        less_than=$magic_focus_cost
                    [/variable]
					[or]
						[variable]
	                        name=current_unit.variables.body
	                        less_than=$magic_focus_cost
						[/variable]
					[/or]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define MENU_ABILITY_THUNDERSTICK_TINKER
    [option]
        message ="&"+attacks/thunderstick.png+"="+_ "Thunderstick Tinker, Current level: $current_unit.variables.abilities.thunderstick_tinker|
`Improve an existing thunderstick
`Required: $ts_tinker_cost| Mind"="$ts_tinker_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.thunderstick_tinker
                greater_than=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    greater_than_equal_to=$ts_tinker_cost
                [/variable]
                [and]
                    [variable]
                        name=current_unit.talentpoints
                        greater_than_equal_to=$ts_tinker_cost
                    [/variable]
                [/and]
            [/and]
        [/show_if]
        [command]
            {VARIABLE_OP current_unit.variables.abilities.thunderstick_tinker add 1}
            {VARIABLE_OP current_unit.talentpoints add -$ts_tinker_cost}
        [/command]
    [/option]
    [option]
        message ="&"+attacks/thunderstick.png+"="+_ "<255,0,0>Thunderstick Tinker, Current level: $current_unit.variables.abilities.thunderstick_tinker|
`<255,0,0>Improve an existing thunderstick
`<255,0,0>Required: $ts_tinker_cost| Mind"="#$ts_tinker_cost|"
        [show_if]
            [variable]
                name=current_unit.variables.abilities.thunderstick_tinker
                greater_than=-1
            [/variable]
            [and]
                [variable]
                    name=current_unit.variables.mind
                    less_than=$ts_tinker_cost
                [/variable]
                [or]
                    [variable]
                        name=current_unit.talentpoints
                        less_than=$ts_tinker_cost
                    [/variable]
                [/or]
            [/and]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#command and menu

#define LEVELUP_MENU
    [store_unit]
        variable=current_unit
        [filter]
            canrecruit=yes
            side=$side_number
        [/filter]
        kill=no
    [/store_unit]

    [store_unit]
        variable=cancel_current_unit
        [filter]
            canrecruit=yes
            side=$side_number
        [/filter]
        kill=no
    [/store_unit]

    {VARIABLE upgrading 1}
    [while]
        [variable]
            name=upgrading
            numerical_equals=1
        [/variable]
        [do]
            {CONSTRUCT_UNIT}
			
			#upgrade costs and rates
			
            {VARIABLE body_plus $current_unit.variables.body}
            {VARIABLE_OP body_plus add 1}
            {VARIABLE body_cost $body_plus}
            {VARIABLE_OP body_cost add $current_unit.variables.body_rate}
            {VARIABLE deft_plus $current_unit.variables.deft}
            {VARIABLE_OP deft_plus add 1}
            {VARIABLE deft_cost $deft_plus}
            {VARIABLE_OP deft_cost add $current_unit.variables.deft_rate}
            {VARIABLE mind_plus $current_unit.variables.mind}
            {VARIABLE_OP mind_plus add 1}
            {VARIABLE mind_cost $mind_plus}
            {VARIABLE_OP mind_cost add $current_unit.variables.mind_rate}

            {UPGRADE_HARD_WEAPON bludgeon.damage bludgeon_damage}
            {UPGRADE_EASY_WEAPON_NUMBER bludgeon.attack bludgeon_attack}
            {VARIABLE bludgeon_attack_cost_half "$($bludgeon_attack_cost/2)"}
            {UPGRADE_HARD_WEAPON light_blade.damage light_blade_damage}
            {UPGRADE_EASY_WEAPON_NUMBER light_blade.attack light_blade_attack}
            {VARIABLE light_blade_attack_cost_half "$($light_blade_attack_cost/2)"}
            {UPGRADE_EASY_WEAPON heavy_blade.damage heavy_blade_damage}
            {UPGRADE_HARD_WEAPON_NUMBER heavy_blade.attack heavy_blade_attack}
            {VARIABLE heavy_blade_attack_cost_half "$($heavy_blade_attack_cost/2)"}
            {UPGRADE_EASY_WEAPON polearm.damage polearm_damage}
            {UPGRADE_HARD_WEAPON_NUMBER polearm.attack polearm_attack}
            {VARIABLE polearm_attack_cost_half "$($polearm_attack_cost/2)"}

            {UPGRADE_HARD_WEAPON lob.damage lob_damage}
            {UPGRADE_EASY_WEAPON_NUMBER lob.attack lob_attack}
            {VARIABLE lob_attack_cost_half "$($lob_attack_cost/2)"}
            {UPGRADE_HARD_WEAPON thrown_light_blade.damage thrown_light_blade_damage}
            {UPGRADE_EASY_WEAPON_NUMBER thrown_light_blade.attack thrown_light_blade_attack}
            {VARIABLE thrown_light_blade_attack_cost_half "$($thrown_light_blade_attack_cost/2)"}
            {UPGRADE_HARD_WEAPON thrown_heavy_blade.damage thrown_heavy_blade_damage}
            {UPGRADE_EASY_WEAPON_NUMBER thrown_heavy_blade.attack thrown_heavy_blade_attack}
            {VARIABLE thrown_heavy_blade_attack_cost_half "$($thrown_heavy_blade_attack_cost/2)"}
            {UPGRADE_MEDIUM_WEAPON bow.damage bow_damage}
            {UPGRADE_MEDIUM_WEAPON_NUMBER bow.attack bow_attack}
            {VARIABLE bow_attack_cost_half "$($bow_attack_cost/2)"}
            {UPGRADE_EASY_WEAPON javelin.damage javelin_damage}
            {UPGRADE_HARD_WEAPON_NUMBER javelin.attack javelin_attack}
            {VARIABLE javelin_attack_cost_half "$($javelin_attack_cost/2)"}
            {UPGRADE_HARD_WEAPON crossbow.damage crossbow_damage}
            {UPGRADE_EASY_WEAPON_NUMBER crossbow.attack crossbow_attack}
            {VARIABLE crossbow_attack_cost_half "$($crossbow_attack_cost/2)"}

            {UPGRADE_TRIVIAL variables.max_hp_level hp_level}
            {UPGRADE_SUPERHARD variables.evade_level evade}
            {UPGRADE_SUPERHARD variables.moves_level moves}
            {UPGRADE_MEDIUM variables.abilities.regen regen}
            {UPGRADE_HARD variables.abilities.thunderstick_tinker ts_tinker}
	
			{VARIABLE magic_power_cost $current_unit.variables.abilities.magic_casting.power}
			{VARIABLE_OP magic_power_cost multiply 4}
			{VARIABLE_OP magic_power_cost add 5}

			{VARIABLE magic_speed_cost $current_unit.variables.abilities.magic_casting.speed}
			{VARIABLE_OP magic_speed_cost multiply 5}
			{VARIABLE_OP magic_speed_cost add 7}
			
			{VARIABLE magic_focus_cost $current_unit.variables.abilities.magic_casting.focus}
			{VARIABLE_OP magic_focus_cost add 1}
			{VARIABLE_OP magic_focus_cost multiply 4}
			
            [message]
                speaker=narrator
                message= _ "You have $current_unit.talentpoints| Talent Points."

                [option]
			        message ="&"+check.png+"="+_ "(End)"

			        [command]
			            {CONSTRUCT_UNIT}
			            {VARIABLE upgrading 0}
			        [/command]
			    [/option]
                [option]
			        message ="&"+x.png+"="+_ "(Cancel Changes)"

			        [command]
			            {VARIABLE upgrading 0}
			            [unstore_unit]
			                variable=cancel_current_unit
			            [/unstore_unit]
			            {CLEAR_VARIABLE current_unit}
			            {CLEAR_VARIABLE cancel_current_unit}
			        [/command]
			    [/option]

                {MENU_UPGRADE_BODY}
                {MENU_UPGRADE_DEFT}
                {MENU_UPGRADE_MIND}
                {MENU_UPGRADE_HIT_POINTS}
                {MENU_UPGRADE_EVADE}
                {MENU_ABILITY_REGEN}
                {MENU_UPGRADE_MOVES}
                {MENU_UPGRADE_WEAPON_GIFT ("club-small") ("bludgeon weapons") ("Bludgeon") ("bludgeon") ("body") ("body") ("deft")}
                {MENU_UPGRADE_WEAPON_GIFT ("dagger-human") ("light blades") ("Light Blade") ("light_blade") ("deft") ("deft") ("body")}
                {MENU_UPGRADE_WEAPON_GIFT ("sword-human") ("heavy blades") ("Heavy Blade") ("heavy_blade") ("body") ("body") ("deft")}
                {MENU_UPGRADE_WEAPON_GIFT ("spear") ("polearms") ("Polearm") ("polearm") ("body") ("body") ("deft")}
                {MENU_UPGRADE_WEAPON_GIFT ("rock_thrown") ("lobbed weapons") ("Lob") ("lob") ("body") ("body") ("deft")}
                {MENU_UPGRADE_WEAPON_GIFT ("dagger-thrown-human") ("thrown light blades") ("Thrown Light Blade") ("thrown_light_blade") ("deft") ("deft") ("body")}
                {MENU_UPGRADE_WEAPON_GIFT ("bow") ("bows") ("Bow") ("bow") ("deft") ("deft") ("body")}
                {MENU_UPGRADE_WEAPON_GIFT ("hatchet") ("thrown heavy blades") ("Thrown Heavy Blades") ("thrown_heavy_blade") ("body") ("body") ("deft")}
                {MENU_UPGRADE_WEAPON_GIFT ("javelin-human") ("javelins") ("Javelin") ("javelin") ("body") ("body") ("deft")}
                {MENU_UPGRADE_WEAPON_GIFT ("crossbow-human") ("crossbows") ("Crossbow") ("crossbow") ("deft") ("body") ("deft")}

                {MENU_ABILITY_DUAL_WIELD}
                {MENU_ABILITY_TRIPLE_WIELD}
                {MENU_ABILITY_RPG_LEADERSHIP_1}
                {MENU_ABILITY_RPG_LEADERSHIP_2}
                {MENU_ABILITY_RPG_LEADERSHIP_3}
                {MENU_ABILITY_RPG_LEADERSHIP_4}
				{MENU_ABILITY_RPG_CRUELTY}
                {MENU_ABILITY_RPG_LONER}
                {MENU_ABILITY_RPG_RANGER}
                {MENU_ABILITY_RPG_SURVIVALIST}
                {MENU_ABILITY_RPG_TRAILBLAZER}
                {MENU_ABILITY_RPG_AMBUSH_FOREST}
                {MENU_ABILITY_RPG_TRAILBLAZER_ELF}
                {MENU_ABILITY_RPG_AMBUSH_MOUNTAINS}
                {MENU_ABILITY_RPG_HEALTHY}
                {MENU_ABILITY_RPG_FEARLESS}
				{MENU_ABILITY_SKIRMISHER}
				{MENU_ABILITY_DISTRACT}
                {MENU_ABILITY_DASH}
				{MENU_ABILITY_GRACE}
                {MENU_ABILITY_FIRSTSTRIKE}
                {MENU_ABILITY_BLOODLUST_1}
				{MENU_ABILITY_BLOODLUST_2}
				{MENU_ABILITY_BLOODLUST_3}
                {MENU_ABILITY_RAGE}
                {MENU_ABILITY_BERSERK}
                {MENU_ABILITY_STEADFAST_1}
				{MENU_ABILITY_STEADFAST_2}
				{MENU_ABILITY_STEADFAST_3}
                {MENU_ABILITY_BACKSTAB_1}
				{MENU_ABILITY_BACKSTAB_2}
				{MENU_ABILITY_BACKSTAB_3}
				{MENU_ABILITY_TARGET_1}
				{MENU_ABILITY_TARGET_2}
				{MENU_ABILITY_TARGET_3}
				{MENU_ABILITY_SLASHDASH_1}
				{MENU_ABILITY_SLASHDASH_2}
				{MENU_ABILITY_SLASHDASH_3}
				{MENU_ABILITY_RIPOSTE_1}
				{MENU_ABILITY_RIPOSTE_2}
				{MENU_ABILITY_RIPOSTE_3}
				{MENU_ABILITY_ENSNARE_1}
				{MENU_ABILITY_ENSNARE_2}
				{MENU_ABILITY_ENSNARE_3}
				{MENU_ABILITY_POINTPIKE_1}
				{MENU_ABILITY_POINTPIKE_2}
				{MENU_ABILITY_POINTPIKE_3}
				{MENU_ABILITY_STORM_1}
				{MENU_ABILITY_STORM_2}
				{MENU_ABILITY_STORM_3}
				{MENU_ABILITY_BRUTAL_ASSAULT}
				{MENU_ABILITY_CLEAVE_1}
				{MENU_ABILITY_CLEAVE_2}
				{MENU_ABILITY_CLEAVE_3}
                {MENU_ABILITY_MARKSMAN_1}
				{MENU_ABILITY_MARKSMAN_2}
				{MENU_ABILITY_MARKSMAN_3}
				{MENU_ABILITY_MARKSMAN_THROWN_LIGHT_BLADE_1}
				{MENU_ABILITY_MARKSMAN_THROWN_LIGHT_BLADE_2}
				{MENU_ABILITY_MARKSMAN_THROWN_LIGHT_BLADE_3}
				{MENU_ABILITY_AMMO_BOW_1}
				{MENU_ABILITY_AMMO_BOW_2}
				{MENU_ABILITY_AMMO_BOW_3}
				{MENU_ABILITY_AMMO_JAVELIN_1}
				{MENU_ABILITY_AMMO_JAVELIN_2}
				{MENU_ABILITY_AMMO_JAVELIN_3}
				{MENU_ABILITY_AMMO_THROWN_LIGHT_1}
				{MENU_ABILITY_AMMO_THROWN_LIGHT_2}
				{MENU_ABILITY_AMMO_THROWN_LIGHT_3}
				{MENU_ABILITY_AMMO_THROWN_HEAVY_1}
				{MENU_ABILITY_AMMO_THROWN_HEAVY_2}
				{MENU_ABILITY_AMMO_THROWN_HEAVY_3}
				{MENU_ABILITY_GOLIATH_BANE_1}
				{MENU_ABILITY_GOLIATH_BANE_2}
				{MENU_ABILITY_GOLIATH_BANE_3}
				{MENU_ABILITY_FIRE_SHOT_BOW}
				{MENU_ABILITY_FIRE_SHOT_XBOW}
				{MENU_ABILITY_READIED_BOLT}
				{MENU_ABILITY_THUNDERSTICK_TINKER}
                {MENU_ABILITY_SNEAK}                
                {MENU_ABILITY_MAGIC_TROLL}
                {MENU_ABILITY_MAGIC_FAERIE}
				{MENU_ABLITY_FAERIE_TOUCH}
				{MENU_ABLITY_ELDRITCH_TOUCH}
				{MENU_ABILITY_MAGIC_WOOD}
				{MENU_ABILITY_NATURE_HEAL}
				{MENU_ABILITY_BRAMBLES}
				{MENU_ABILITY_VINE_ENSNARE_1}
				{MENU_ABILITY_VINE_ENSNARE_2}
				{MENU_ABILITY_VINE_ENSNARE_3}
				{MENU_ABILITY_VINE_SLOWS}
                {MENU_ABILITY_MAGIC_RUNIC}
                {MENU_ABILITY_MAGIC_INITIATE}
                {MENU_ABILITY_MAGIC_DARK}
				{MENU_ABILITY_MAGIC_DARK_INITIATE}
                {MENU_ABILITY_MAGIC_RED}
                {MENU_ABILITY_MAGIC_WHITE}
                {MENU_ABILITY_MAGIC_SILVER}
                {MENU_ABILITY_MAGIC_ELDER}
				{MENU_ABILITY_MAGIC_SWAMP}
				{MENU_ABILITY_MAGIC_TRIBAL}
				{MENU_ABILITY_MAGIC_BENEVOLENT}
				{MENU_ABILITY_MAGIC_BALEFUL}
                {MENU_UPGRADE_MAGIC_CASTING_POWER}
                {MENU_UPGRADE_MAGIC_CASTING_SPEED}
				{MENU_UPGRADE_HAMMER_FOCUS}
				{MENU_UPGRADE_SWORD_FOCUS}
                {MENU_ABILITY_MAGIC_WHITE_ILLUMINATES}
                {MENU_ABILITY_MAGIC_DARK_PLAGUE}
				{MENU_ABILITY_MAGIC_DARK_SOULTRAP}
                {MENU_ABILITY_MAGIC_WHITE_METAL_TO_ARCANE}
                {MENU_ABILITY_POISON_THROWN_LIGHT_BLADE}
				{MENU_ABILITY_POISON_THROWN_LIGHT_BLADE_ORC}
                image=wesnoth-icon.png
            [/message]
        [/do]
    [/while]
#enddef
