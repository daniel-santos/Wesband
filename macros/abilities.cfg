#define ABILITY_DESERTHOME
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Dd,Ds
            [/filter_location]
        [/filter_self]
        value=6
        id=healing
        name= _ "deserthome"
        description= _ "Deserthome:
This unit will regenerate 6 hp when in desert or sand."
        name_inactive= _ "deserthome"
        description_inactive= _ "Deserthome:
This unit will regenerate 6 hp when in desert or sand."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_FORESTHOME
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Gs^Fp,Gg^Fet,Gs^Ft,Aa^Fpa
            [/filter_location]
        [/filter_self]
        value=6
        id=healing
        name= _ "foresthome"
        description= _ "Foresthome:
This unit will regenerate 6 hp when in forest."
        name_inactive= _ "foresthome"
        description_inactive= _ "Foresthome:
This unit will regenerate 6 hp when in forest."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_WATERHOME
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Wo,Ww
            [/filter_location]
        [/filter_self]
        value=6
        id=healing
        name= _ "waterhome"
        description= _ "Waterhome:
This unit will regenerate 6 hp when in deep or shallow water."
        name_inactive= _ "waterhome"
        description_inactive= _ "Waterhome:
This unit will regenerate 6 hp when in deep or shallow water."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_MTNHOME
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Mm
            [/filter_location]
        [/filter_self]
        value=6
        id=healing
        name= _ "mountainhome"
        description= _ "Mountainhome:
This unit will regenerate 6 hp when on mountains."
        name_inactive= _ "mountainhome"
        description_inactive= _ "Mountainhome:
This unit will regenerate 6 hp when in mountains."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_DIVINE_HEALTH
    [regenerate]
        value=3
        id=divine_health
        name= _ "divine health"
        description= _ "Divine Health: Due to this unit's relationship with its deity it is granted a magical body in which the magic is manifested as the ability to self heal. Thus this unit will be healed by 3 HP per turn, poison will not be prolonged or cured..."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_DIVINE_HEALTH_ENHANCED
    [regenerate]
        value=6
        id=divine_health_enhanced
        name= _ "divine health en"
        description= _ "Divine Health: Due to this unit's relationship with its deity it is granted a magical body in which the magic is manifested as the ability to self heal and is enhanced by this unit's blood thirsty lifestyle. Thus this unit will be healed by 6 HP per turn, poison will not be prolonged or cured..."
        affect_self=yes
    [/regenerate]
#enddef

#define WEAPON_SPECIAL_DREAD
    [damage]
        id=dread
        name= _ "dread"
        name_inactive= _ "dread"
        description= _ "Dread:
When this attack is used offensively, this unit takes one third less damage in retaliation." 
        description_inactive= _ "Dread:
When this attack is used offensively, this unit takes one third less damage in retaliation."
        active_on=offense
        apply_to=opponent
        multiply=0.66
    [/damage]
#enddef

#define ABILITY_SWAMP_PROWL
    [hides]
        id=swamp_prowl
        name= _ "swamp prowl"
        name_inactive= _ "swamp prowl"
        description= _ "Swamp Prowl:
This unit can hide in swamps, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in a swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "Swamp Prowl:
This unit can hide in swamps, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in a swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Chs,Khs,Ss,Ss^Vhs,Ss^Vm
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

#define ABILITY_WATER
	[regenerate]
		value=6
		id=water
		name= _ "water"
		description= _ "Made of Water:
This unit is made of water. As a result, if it is standing in water, it will receive 6 hp. If it is poisoned, it will remove it instead of healing."
		name_inactive= _ "waterhome"
		description_inactive= _ "waterhome:
This unit is made of water. If it stands in water, it will receive 6 hp. If it is poisoned, it will remove it instead of healing."
		affect_self=yes
		poison=cured
		[filter_self]
			[filter_location]
				terrain=Wo,Ww
			[/filter_location]
		[/filter_self]
	[/regenerate]
#enddef

#define ABILITY_FIRE
	[regenerate]
		value=6
		id=fire
		name= _ "fire"
		description= _ "Made of Fire:
This unit is made of fire. If it stands in lava, it will recive 6 hp. If it is poisoned, it will remove it instead of healing."
		name_inactive= _ "lavahome"
		description_inactive= _ "lavahome:
This unit is made of fire. If it stands in lava, it will recive 6 hp. If it is poisoned, it will remove it instead of healing."
		affect_self=yes
		poison=cured
		[filter_self]
			[filter_location]
				terrain=l
			[/filter_location]
		[/filter_self]
	[/regenerate]
#enddef

#define ABILITY_MEGACIRCLE
	[regenerate]
		value=8
		id=healing
		name= _ "megacircle"
		description= _ "megacircle:
This unit owns powerful magic circle which affects all units inside. All friendly units fight better (+125%, +100%, +75%, +50%, +25% - lvl 0, 1, 2, 3, 4) and regenerate themselves."
		affect_self=yes
		poison=cured
	[/regenerate]
	[heals]
		value=8
		id=healing
		affect_allies=yes
		affect_self=no
		poison=slowed
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
		[/affect_adjacent]
	[/heals]
	[heals]
		affect_allies=yes
		id=curing
		affect_self=no
		poison=cured
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
		[/affect_adjacent]
	[/heals]
	[leadership]
		id=leadership
		value=125
		cumulative=no
		affect_self=no
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
			[filter]
				level=0
			[/filter]
		[/affect_adjacent]
	[/leadership]
	[leadership]
		id=leadership
		value=100
		cumulative=no
		affect_self=no
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
			[filter]
				level=1
			[/filter]
		[/affect_adjacent]
	[/leadership]
	[leadership]
		id=leadership
		value=75
		cumulative=no
		affect_self=no
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
			[filter]
				level=2
			[/filter]
		[/affect_adjacent]
	[/leadership]
	[leadership]
		id=leadership
		value=50
		cumulative=no
		affect_self=no
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
			[filter]
				level=3
			[/filter]
		[/affect_adjacent]
	[/leadership]
	[leadership]
		id=leadership
		value=25
		cumulative=no
		affect_self=no
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
			[filter]
				level=4
			[/filter]
		[/affect_adjacent]
	[/leadership]
#enddef


#define WEAPON_SPECIAL_CIRCLE
	[chance_to_hit]
		id=circle
		name= _ "circle"
		description= _ "circle:
This attack always has a 100% chance to hit"
		value=100
		cumulative=no
	[/chance_to_hit]
#enddef


#define WEAPON_SPECIAL_NOCOUNTERATTACK
		[chance_to_hit]
			id=nocounter
			name= _ "no counter-attack"
			description= _ "no counter-attack:
The opponent has always a 0% chance to hit, when this unit is attacking."
			description_inactive= _ "no counter-attack:
The opponent has always a 0% chance to hit, when this unit is attacking."
			value=0
			cumulative=no
			active_on=offense
			apply_to=opponent
		[/chance_to_hit]
#enddef

#define WEAPON_SPECIAL_EVASION
	[damage]
		id=evasion
		name= _ "evasion"
		name_inactive= _ "evasion"
		description= _ "Evasion:
When this attack is used offensively, this unit takes one third less damage in retaliation." 
		description_inactive= _ "Evasion:
When this attack is used offensively, this unit takes one third less damage in retaliation."
		active_on=offense
		apply_to=opponent
		multiply=0.66
	[/damage]
#enddef

#define ABILITY_DARKAURA
	[leadership]
		id=darkaura
		value=-25
		cumulative=no
		name= _ "dark aura"
		description= _ "Dark aura makes all enemy units fight worse (-25% for attack)."
		affect_self=no
		affect_allies=no
		affect_enemies=yes
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
			#[filter]
			#	level=0
			#[/filter]
		[/affect_adjacent]
	[/leadership]
#enddef

#define ABILITY_ULTRACURES
[heals]
		value=12
		id=healing
		affect_allies=yes
		name= _ "ultracures"
		description=  _ "Heals +12:
Allows the unit to heal adjacent friendly units at the beginning of each turn.

A unit cared for by this healer may heal up to 12 HP per turn.
A curer can cure a unit of poison, although that unit will receive no additional healing on the turn it is cured of the poison."
		affect_self=no
		poison=cured
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
		[/affect_adjacent]
	[/heals]
	[regenerate]
		value=12
		id=healing
		affect_self=yes
		poison=cured
	[/regenerate]
#enddef

#define ABILITY_I8PROTECTION
	[resistance]
		id=i8protection
		add=20
		max_value=50
		apply_to=blade,pierce,impact,fire,cold,arcane
		name= _ "defender"
		description= _ "Defender:
Adjacent friendly units receive a +20% bonus to all resistances (up to a maximum of 50%)."
		affect_self=yes
		affect_allies=yes
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
		[/affect_adjacent]
	[/resistance]
#enddef

#define WEAPON_SPECIAL_PRECISION
	[chance_to_hit]
		id=precision
		name= _ "precision"
		description= _ "precision:
This attack always has a 80% chance to hit"
		value=80
		cumulative=no
	[/chance_to_hit]
#enddef

#define ABILITY_CIRCLERES
[resistance]
		id=cr
		add=20
		max_value=100
		apply_to=fire,cold,arcane
		name= _ "circle of resistance"
		description= _ "Circle of Resistance:
This unit and all adjacent friendly units receive a +20% bonus to fire, cold and arcane resistance."
		affect_self=yes
		affect_allies=yes
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
		[/affect_adjacent]
	[/resistance]
#enddef

#define ABILITY_DEADZONE
	[resistance]
		id=deadzone
		add=99
		max_value=99
		apply_to=fire,cold,arcane
		name= _ "deadzone"
		description= _ "Deadzone:
Adjacent friendly units receive a 99% bonus to fire,cold and arcane resistance"
		affect_self=yes
		affect_allies=yes
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
		[/affect_adjacent]
	[/resistance]
#enddef

#define ABILITY_COLDAURA
	[resistance]
		id=coldaura
		add=50
		max_value=50
		apply_to=fire
		name= _ "cold aura"
		description= _ "Cold Aura:
Adjacent units receive a 50% bonus to fire resistance and a -25% bonus to cold resistance. All cold spells are very powerful here."
		affect_self=yes
		affect_allies=yes
		affect_enemies=yes
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
		[/affect_adjacent]
	[/resistance]
	[resistance]
		id=coldaura
		value=-25
		max_value=-25
		apply_to=cold
		affect_self=yes
		affect_allies=yes
		affect_enemies=yes
		[affect_adjacent]
			adjacent=n,ne,se,s,sw,nw
		[/affect_adjacent]
	[/resistance]
#enddef



#define ABILITY_I8_SUMMON_LEVEL3
	[dummy]
		id=summon_lvl3
		name= _ "Summon"
		description= _ "Summon:
this unit can summon new units near him, but not in villages."
	[/dummy]
[/abilities]


#events for summoning and types will go here


[+abilities]
#enddef





#define SPECIAL_NOTES_SUMMON_LVL3
	_ " this unit can create other units in the near free spaces, but not in villages."
#enddef

					
#define ABILITY_I8_SUMMON_LEVEL4
	[dummy]
		id=summon_lvl4
		name= _ "Summon"
		description= _ "Summon:
this unit can summon new units near him, but not in villages."
	[/dummy]
[/abilities]


#events for summoning and types will go here








[+abilities]
#enddef





#define SPECIAL_NOTES_SUMMON_LVL3
	_ " this unit can create other units in the near free spaces, but not in villages."
#enddef

#define ABILITY_CURE_VALUE VALUE
    # Canned definition of the heal+X ability to be included in an [abilities] clause.
    {ABILITY_HEAL_VALUE {VALUE}}
    {ABILITY_UNPOISON}
#enddef

#define ABILITY_HEAL_VALUE VALUE
    # Canned definition of the heal+X ability to be included in an [abilities] clause.
    [heals]
        value={VALUE}
        id=healing
        affect_allies=yes
        name= _ "heals +" +{VALUE}
        description=  _ "Heals +"+{VALUE}+_ ": Allows the unit to heal adjacent friendly units at the beginning of each turn.
A unit cared for by this healer may heal, or stop poison from taking effect for that turn.
A poisoned unit cannot be cured of its poison by a healer, and must seek the care of a village or a unit that can cure."
        affect_self=no
        poison=slowed
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef

#define ABILITY_FS_BATTLETUTOR TYPE
    #wmllint: unbalanced-on
    [regenerate]
        id=battletutor
        value=0
        cumulative=no
        name= _ "battle tutor"
        description= _ "Battle Tutor:
This unit's ability to teach battle skills gives each adjacent allied unit a +1 to experience earned in battle."
    [/regenerate]
[/abilities]
[event]
    name=attack_end
    [filter]
        [filter_adjacent]
            type={TYPE}
            is_enemy=false
        [/filter_adjacent]
    [/filter]
    [set_variable]
        name=unit.experience
        add=1
    [/set_variable]
    [unstore_unit]
        variable=unit
        text=_ "1"
        red,green,blue=0,200,255
    [/unstore_unit]
    first_time_only=no
[/event]

[event]
    name=attack_end
    [filter_second]
        [filter_adjacent]
            type={TYPE}
            is_enemy=false
        [/filter_adjacent]
    [/filter_second]
    [set_variable]
        name=second_unit.experience
        add=1
    [/set_variable]
    [unstore_unit]
        variable=second_unit
        text=_ "1"
        red,green,blue=0,200,255
    [/unstore_unit]
    first_time_only=no
[/event]
[+abilities]
    #wmllint: unbalanced-off
#enddef

#define ABILITY_DAUNTLESS
    [resistance]
        id=dauntless
        name= _ "dauntless"
        description= _ "Dauntless:
While attacking, this unit's resistances are doubled, up to a maximum of 50. Weaknesses are not affected."
        name_inactive= _ "dauntless"
        description_inactive= _ "Dauntless:
While attacking, this unit's resistances are doubled, up to a maximum of 50. Weaknesses are not affected."
        multiply=2
        max_value=50
        apply_to=blade,pierce,impact,fire,cold,arcane
        [filter_base_value]
            greater_than=0
        [/filter_base_value]
        active_on=offense
    [/resistance]
#enddef

#define ABILITY_DELUMINATES
    # definition of the Illuminates ability
    # [abilities] clause.
    [illuminates]
        [filter_self]
            [filter_location]
                [not]
                    time_of_day = chaotic
                [/not]
            [/filter_location]
        [/filter_self]
        id=delumination
        value=-25
        cumulative=no
        name= _ "deluminates"
        description= _ "Deluminates:
This unit deluminates the surrounding area, making chaotic units fight better, and lawful units fight worse.

Any units adjacent to this unit will fight as if it were dawn when it is day, and as if it were night when it is dawn."
        affect_self=yes
    [/illuminates]
#enddef

# doesn't work, for no reason i can see; affected enemies lose their resistances entirely
#define ABILITY_DISRUPTS
    [resistance]
        id=disrupts
        name= _ "disrupts"
        description= _ "Disrupts:
Enemy units adjacent to this unit will have their resistances halved. Weaknesses are not affected."
        name_inactive= _ "disrupts"
        description_inactive= _ "Disrupts:
Enemy units adjacent to this unit will have their resistances halved. Weaknesses are not affected."
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
        [filter_base_value]
            greater_than=0
        [/filter_base_value]
        multiply=0.5
        cumulative=no
    [/resistance]
#enddef

#define ABILITY_DIVINE_HEALTH
    [regenerate]
        value=3
        id=divine_health
        name= _ "divine health"
        description= _ "Divine Health: Due to this unit's relationship with its deity it is granted a magical body in which the magic is manifested as the ability to self heal. Thus this unit will be healed by 3 HP per turn, poison will not be prolonged or cured..."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_DIVINE_HEALTH_ENHANCED
    [regenerate]
        value=6
        id=divine_health_enhanced
        name= _ "divine health en"
        description= _ "Divine Health: Due to this unit's relationship with its deity it is granted a magical body in which the magic is manifested as the ability to self heal and is enhanced by this unit's blood thirsty lifestyle. Thus this unit will be healed by 6 HP per turn, poison will not be prolonged or cured..."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_SMALL_HEAL
    # Canned definition of the heal+2 ability to be included in an [abilities] clause.
    [heals]
        value=2
        id=healing
        affect_allies=yes
        name= _ "heals +2"
        description=  _ "Heals +2: Allows the unit to heal adjacent friendly units at the beginning of each turn.
A unit cared for by this healer may heal up to 2 HP per turn, or stop poison from taking effect for that turn.
A poisoned unit cannot be cured of its poison by a healer, and must seek the care of a village or a unit that can cure."
        affect_self=no
        poison=slowed
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef

#define ABILITY_SMALL_PROTECTION
    [resistance]
        id=small protection
        add=10
        max_value=60
        apply_to=blade,pierce,impact,fire,cold,arcane
        name= _ "protection"
        description= _ "Protection:
Adjacent units of this side receive a +10% bonus to all resistances (up to a maximum of 60%)."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/resistance]
#enddef

#define ABILITY_MIDDLE_PROTECTION
    [resistance]
        id=middle protection
        add=20
        max_value=60
        apply_to=blade,pierce,impact,fire,cold,arcane
        name= _ "protection"
        description= _ "Protection:
Adjacent units of this side receive a +20% bonus to all resistances (up to a maximum of 60%)."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/resistance]
#enddef

#define ABILITY_REGENERATES_VALUE VALUE
    [regenerate]
        value={VALUE}
        id=regenerates{VALUE}
        name= _ "regenerates +" + {VALUE}
        description= _ "Regenerates:
The unit will heal itself " + {VALUE} + _ " HP per turn. If it is poisoned, it will remove the poison instead of healing."
        affect_self=yes
        poison=cured
    [/regenerate]
#enddef

#define ABILITY_SUPPLIES
    [leadership]
        id=supplies
        value=25
        cumulative=no
        name=_"supplies"
        description=_"Supplies:
This unit supplies nearby allies with superior weapons, making their attacks do 25% more damage."
        affect_self=no
        affect_allies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_SWAMP_PROWL
    [hides]
        id=swamp_prowl
        name= _ "swamp prowl"
        name_inactive= _ "swamp prowl"
        description= _ "Swamp Prowl:
This unit can hide in swamps, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in a swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "Swamp Prowl:
This unit can hide in swamps, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in a swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Chs,Khs,Ss,Ss^Vhs,Ss^Vm
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

# this should reveal the user if an -enemy- is within 2 hexes, but I have no idea how to do that.
#define ABILITY_TRANSLUCENT
    [hides]
        id=translucent
        name= _ "translucent"
        description= _ "Translucent:
The unit is invisible as long as it is at least 3 hexes away from all non-translucent units.

Enemy units cannot see this unit if it is hidden.  Any enemy unit that runs directly into this unit immediately loses all its remaining movement."
        name_inactive= _ "translucent"
        description_inactive= _ "Translucent:
The unit is invisible as long as it is at least 3 hexes away from all non-translucent units.

Enemy units cannot see this unit if it is hidden.  Any enemy unit that runs directly into this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [not]
                [filter_location]
                    radius=2
                    [filter]
                        [filter_wml]
                            [abilities]
                                [hides]
                                    id=translucent
                                [/hides]
                            [/abilities]
                        [/filter_wml]
                    [/filter]
                [/filter_location]
            [/not]
        [/filter_self]
    [/hides]
#enddef