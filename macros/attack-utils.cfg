#define COLLAPSE_ATTACKS PATH
	{FOREACH_COLLAPSE {PATH}.attack i}
		[if]
			[variable]
				name={PATH}.attack[$i].number
				less_than=1
			[/variable]
			[then]
				{CLEAR_VARIABLE {PATH}.attack[$i]}
			[/then]
		[/if]
	{NEXT_COLLAPSE i}
    [if]
        [variable]
            name={PATH}.variables.status.dash
            numerical_equals=1
        [/variable]
        [then]
            {FOREACH {PATH}.attack i}
                {VARIABLE {PATH}.attack[$i].movement_used 0}
            {NEXT i}
        [/then]
    [/if]	
#enddef

#define RANGED_WEAPON_MODIFIERS ID PATH
    [set_variables]
        name={PATH}.attack[5]
        mode=replace
        to_variable={PATH}.variables.inventory.weapons.ranged[{ID}]
    [/set_variables]
    {VARIABLE temp_icon ${PATH}.attack[5].icon}
    {VARIABLE {PATH}.attack[5].icon "attacks/$temp_icon|.png"}
    {VARIABLE path "{PATH}.variables.inventory.weapons.ranged[{ID}]"}
	{VARIABLE unit_path {PATH}}
    [fire_event]
        name=weapon_modifiers
    [/fire_event]
    {VARIABLE {PATH}.attack[5].damage $display_damage}
    {VARIABLE {PATH}.attack[5].number $display_number}
#enddef

#define THROWABLE_RANGED_WEAPON_MODIFIERS ID PATH
    [set_variables]
        name={PATH}.attack[4]
        mode=replace
        to_variable={PATH}.variables.inventory.weapons.melee[{ID}].thrown
    [/set_variables]
    {VARIABLE temp_icon ${PATH}.attack[4].icon}
    {VARIABLE {PATH}.attack[4].icon "attacks/$temp_icon|.png"}
    {VARIABLE path "{PATH}.variables.inventory.weapons.melee[{ID}].thrown"}
	{VARIABLE unit_path {PATH}}
    [fire_event]
        name=weapon_modifiers
    [/fire_event]
    {VARIABLE {PATH}.attack[4].damage $display_damage}
    {VARIABLE {PATH}.attack[4].number $display_number}
#enddef

#define MELEE_WEAPON_MODIFIERS CONTAINER ID PATH
    [set_variables]
        name={PATH}.attack[{CONTAINER}]
        mode=replace
        to_variable={PATH}.variables.inventory.weapons.melee[{ID}]
    [/set_variables]
    {VARIABLE temp_icon ${PATH}.attack[{CONTAINER}].icon}
    {VARIABLE {PATH}.attack[{CONTAINER}].icon "attacks/$temp_icon|.png"}
    {VARIABLE path "{PATH}.variables.inventory.weapons.melee[{ID}]"}
	{VARIABLE unit_path {PATH}}
    [fire_event]
        name=weapon_modifiers
    [/fire_event]
    {VARIABLE {PATH}.attack[{CONTAINER}].damage $display_damage}
    {VARIABLE {PATH}.attack[{CONTAINER}].number $display_number}
	
	#throwable for first weapon only
    {VARIABLE temp_is_zero 0}
	[if]
		[variable]
			name=temp_is_zero
			numerical_equals={CONTAINER}
		[/variable]
		[then]
			[if]
				[variable]
					name={PATH}.variables.inventory.weapons.melee[{ID}].special_type.throwable
					greater_than=0
				[/variable]
				[then]
					{THROWABLE_RANGED_WEAPON_MODIFIERS {ID} {PATH}}
				[/then]
			[/if]
		[/then]
	[/if]
	{CLEAR_VARIABLE temp_is_zero}	
#enddef

#define ATTACK_SPELL_MODIFIERS PATH
    [if]
        [variable]
            name={PATH}.variables.abilities.human_magic
            numerical_equals=1
        [/variable]
        [or]
            [variable]
                name={PATH}.variables.abilities.human_magic
                numerical_equals=4
            [/variable]
        [/or]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "magic missile"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/magic-missile.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "magic missile"}
            {VARIABLE {PATH}.attack[$magic_id].damage 4}
            {VARIABLE {PATH}.attack[$magic_id].number 2}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "fire"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage add ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 25}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $human_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
    [if]
        [variable]
            name={PATH}.variables.abilities.human_magic
            numerical_equals=2
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "fireball"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/fireball.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "fireball"}
            {VARIABLE {PATH}.attack[$magic_id].damage 6}
            {VARIABLE {PATH}.attack[$magic_id].number 1}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "fire"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP damage_lvl_to_value multiply 2}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 25}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $human_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
    [if]
        [variable]
            name={PATH}.variables.abilities.human_magic
            numerical_equals=3
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "lightbeam"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/lightbeam.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "lightbeam"}
            {VARIABLE {PATH}.attack[$magic_id].damage 5}
            {VARIABLE {PATH}.attack[$magic_id].number 1}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "arcane"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP damage_lvl_to_value multiply 3}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 30}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $human_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
    [if]
        [variable]
            name={PATH}.variables.abilities.human_magic
            numerical_equals=5
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "lightning"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/lightning.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "lightning"}
            {VARIABLE {PATH}.attack[$magic_id].damage 5}
            {VARIABLE {PATH}.attack[$magic_id].number 0}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "fire"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP damage_lvl_to_value multiply 4}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 40}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $human_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
    [if]
        [variable]
            name={PATH}.variables.abilities.dark_magic
            numerical_equals=1
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "chill wave"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/iceball.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "dark wave"}
            {VARIABLE {PATH}.attack[$magic_id].damage 8}
            {VARIABLE {PATH}.attack[$magic_id].number 1}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "cold"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP damage_lvl_to_value multiply 2}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 15}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $dark_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}

            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "shadow wave"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/dark-missile.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "dark wave"}
            {VARIABLE {PATH}.attack[$magic_id].damage 5}
            {VARIABLE {PATH}.attack[$magic_id].number 1}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "arcane"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP damage_lvl_to_value multiply 2}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 15}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $dark_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
    [if]
        [variable]
            name={PATH}.variables.abilities.runic_magic
            numerical_equals=1
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "lightning"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/lightning.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "lightning"}
            {VARIABLE {PATH}.attack[$magic_id].damage 3}
            {VARIABLE {PATH}.attack[$magic_id].number 1}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "fire"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP damage_lvl_to_value multiply 2}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
			[if]
				[variable]
					name={PATH}.variables.abilities.magic_casting.focus
					greater_than=0
				[/variable]
				[and]
					[variable]
						name={PATH}.attack[0].user_name
						equals="hammer"
					[/variable]
				[/and]
				[then]
					{VARIABLE temp_focus ${PATH}.variables.abilities.magic_casting.focus}
					{VARIABLE_OP temp_focus multiply 3}
				[/then]
				[else]
					{VARIABLE temp_focus 0}
				[/else]
			[/if]
			{VARIABLE magic_adjust_armor_2 $magic_adjust_armor}
			{VARIABLE_OP magic_adjust_armor_2 add -100}
			{VARIABLE_OP magic_adjust_armor_2 divide 2}
			{VARIABLE_OP magic_adjust_armor_2 add 100}
			{VARIABLE_OP temp_focus add $magic_adjust_armor_2}
			[if]
				[variable]
					name=temp_focus
					less_than=100
				[/variable]
				[then]
		            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $temp_focus}
		            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
				[/then]
			[/if]
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 30}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $runic_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
    [if]
        [variable]
            name={PATH}.variables.abilities.faerie_magic
            numerical_equals=1
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "faerie fire"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/faerie-fire.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "faerie fire"}
            {VARIABLE {PATH}.attack[$magic_id].damage 2}
            {VARIABLE {PATH}.attack[$magic_id].number 3}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "arcane"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP damage_lvl_to_value multiply 2}
			{VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
			[if]
				[variable]
					name={PATH}.variables.abilities.magic_casting.focus
					greater_than=0
				[/variable]
				[and]
					[variable]
						name={PATH}.attack[0].name
						equals="sword"
					[/variable]
				[/and]
				[then]
					{VARIABLE temp_focus ${PATH}.variables.abilities.magic_casting.focus}
					{VARIABLE_OP temp_focus multiply 3}
				[/then]
				[else]
					{VARIABLE temp_focus 0}
				[/else]
			[/if]
			{VARIABLE_OP temp_focus add $magic_adjust_armor}
			[if]
				[variable]
					name=temp_focus
					less_than=100
				[/variable]
				[then]
		            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $temp_focus}
		            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
				[/then]
			[/if]
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 15}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $faerie_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
	[if]
		[variable]
            name={PATH}.variables.abilities.wood_magic
            numerical_equals=2
        [/variable]
		[then]
			{VARIABLE magic_id ${PATH}.attack.length}
		    {VARIABLE_OP magic_id add 1}
		    {VARIABLE {PATH}.attack[$magic_id].description "vines"}
		    {VARIABLE {PATH}.attack[$magic_id].icon "attacks/entangle.png"}
		    {VARIABLE {PATH}.attack[$magic_id].name "vines"}
		    {VARIABLE {PATH}.attack[$magic_id].damage 6}
		    {VARIABLE {PATH}.attack[$magic_id].number 1}
		    {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
		    {VARIABLE {PATH}.attack[$magic_id].type "impact"}
		    {VARIABLE {PATH}.attack[$magic_id].special_type.vine_slows 1}
			{VARIABLE {PATH}.attack[$magic_id].special_type.vine_ensnare 1}
		    {VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP damage_lvl_to_value multiply 2}
			{VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
		    {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
		    {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
		    {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 30}
		    {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
			[fire_event]
			    name=weapon_modifiers
			[/fire_event]
			{VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
		    {VARIABLE_OP dmg_abstract multiply $faerie_magic_adjust_weapon}
		    {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
		    {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
		    {CLEAR_VARIABLE magic_id}
		[/then]
		[else]
			[if]
		        [variable]
		            name={PATH}.variables.abilities.wood_magic
		            greater_than=0
		        [/variable]
		        [then]
		            {VARIABLE magic_id ${PATH}.attack.length}
		            {VARIABLE_OP magic_id add 1}
		            {VARIABLE {PATH}.attack[$magic_id].description "vines"}
		            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/entangle.png"}
		            {VARIABLE {PATH}.attack[$magic_id].name "vines"}
		            {VARIABLE {PATH}.attack[$magic_id].damage 3}
		            {VARIABLE {PATH}.attack[$magic_id].number 1}
		            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
		            {VARIABLE {PATH}.attack[$magic_id].type "impact"}
		            {VARIABLE {PATH}.attack[$magic_id].special_type.vine_slows 1}
					{VARIABLE {PATH}.attack[$magic_id].special_type.vine_ensnare 1}
		            {VARIABLE_OP {PATH}.attack[$magic_id].damage add ${PATH}.variables.abilities.magic_casting.power}
		            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
		            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
		            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 15}
		            {VARIABLE path "{PATH}.attack[$magic_id]"}
					{VARIABLE unit_path {PATH}}
				    [fire_event]
				        name=weapon_modifiers
				    [/fire_event]
				    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
					{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
		            {VARIABLE_OP dmg_abstract multiply $faerie_magic_adjust_weapon}
		            {VARIABLE_OP dmg_abstract multiply .01}
					{VARIABLE_OP dmg_abstract round 0}
					{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
		            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
		            {CLEAR_VARIABLE magic_id}
		        [/then]
		    [/if]
		[/else]
	[/if]
	
    [if]
        [variable]
            name={PATH}.variables.abilities.troll_magic
            numerical_equals=1
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "flame blast"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/fireball.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "flame blast"}
            {VARIABLE {PATH}.attack[$magic_id].damage 5}
            {VARIABLE {PATH}.attack[$magic_id].number 2}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "fire"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage add ${PATH}.variables.abilities.magic_casting.power}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 25}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $spirit_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
	[if]
        [variable]
            name={PATH}.variables.abilities.swamp_magic
            greater_than=0
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "curse"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/curse.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "curse"}
            {VARIABLE {PATH}.attack[$magic_id].damage 3}
            {VARIABLE {PATH}.attack[$magic_id].number 2}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "cold"}
            {VARIABLE {PATH}.attack[$magic_id].special_type.magical_to_hit 1}
			{VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
            [if]
				[variable]
					name={PATH}.variables.abilities.baleful
					greater_than=0
				[/variable]
				[then]
					{VARIABLE_OP damage_lvl_to_value multiply 3}
				[/then]
			[/if]
			{VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 10}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $spirit_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
	[if]
        [variable]
            name={PATH}.variables.abilities.tribal_magic
            greater_than=0
        [/variable]
        [then]
            {VARIABLE magic_id ${PATH}.attack.length}
            {VARIABLE_OP magic_id add 1}
            {VARIABLE {PATH}.attack[$magic_id].description "curse"}
            {VARIABLE {PATH}.attack[$magic_id].icon "attacks/curse.png"}
            {VARIABLE {PATH}.attack[$magic_id].name "curse"}
            {VARIABLE {PATH}.attack[$magic_id].damage 6}
            {VARIABLE {PATH}.attack[$magic_id].number 1}
            {VARIABLE {PATH}.attack[$magic_id].range "ranged"}
            {VARIABLE {PATH}.attack[$magic_id].type "pierce"}
			[set_variables]
				name={PATH}.attack[$magic_id].specials
				mode=merge
				[value]
					{WEAPON_SPECIAL_DRAIN}
				[/value]
			[/set_variables]
			{VARIABLE damage_lvl_to_value ${PATH}.variables.abilities.magic_casting.power}
			{VARIABLE_OP {PATH}.attack[$magic_id].damage add $damage_lvl_to_value}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage multiply $magic_adjust_armor}
            {VARIABLE_OP {PATH}.attack[$magic_id].damage divide 100}
            {VARIABLE {PATH}.attack[$magic_id].mind_damage_rate 10}
            {VARIABLE path "{PATH}.attack[$magic_id]"}
			{VARIABLE unit_path {PATH}}
		    [fire_event]
		        name=weapon_modifiers
		    [/fire_event]
		    {VARIABLE {PATH}.attack[$magic_id].damage $display_damage}
			{VARIABLE dmg_abstract ${PATH}.attack[$magic_id].damage}
            {VARIABLE_OP dmg_abstract multiply $spirit_magic_adjust_weapon}
            {VARIABLE_OP dmg_abstract multiply .01}
			{VARIABLE_OP dmg_abstract round 0}
			{VARIABLE {PATH}.attack[$magic_id].damage $dmg_abstract}
            {VARIABLE_OP {PATH}.attack[$magic_id].number add ${PATH}.variables.abilities.magic_casting.speed}
            {CLEAR_VARIABLE magic_id}
        [/then]
    [/if]
#enddef
