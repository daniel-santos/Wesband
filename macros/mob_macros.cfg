#what the name of the macro says
#define MAX_CLUSTER_LEVEL_POSSIBLE
4
#enddef

#define WBD_DEFINE_MOBS
	[theme]
        id="cave"
		max_cluster_level=4
		#groups
		easy0=Mudcrawler,Vampire_Bat,Troglodyte_Spawn,{X2 Giant_Ant,Rat_Swarm}
		hard0={X2 Mudcrawler,Vampire_Bat},Wolf,Rat_Swarm,Troglodyte_Spawn,Giant_Ant
		boss0={X3 Wolf},Metal_Slime,Giant_Mudcrawler,Barbarian_Cyclops,Troglodyte
		easy1={X2 Mudcrawler,Vampire_Bat,Wolf},Metal_Slime,Giant_Mudcrawler,Giant_Ant,Troglodyte
		hard1=Sporeling,Barbarian_Cyclops,Spider,Toxic_Slime
		boss1=Giant_Scorpion,Giant_Metal_Slime,Giant_Toxic_Slime,Hydra
		easy2=Sporeling,Barbarian_Cyclops,Toxic_Slime,Metal_Slime
		hard2=Blood_Bat,Huge_Mudcrawler,Fungoid,Spider,Giant_Scorpion,Hydra
		boss2=Mighty_Cyclops,Deep_Hydra,Giant_Toxic_Slime
		easy3=Huge_Mudcrawler,Blood_Bat,Fungoid,Spider,Giant_Scorpion
		hard3=Dread_Bat,Giant_Toxic_Slime,Giant_Metal_Slime,Mighty_Cyclops,Deep_Hydra,Red_Cyclops
		boss3=Tarantula,Huge_Metal_Slime,Huge_Toxic_Slime
		easy4=Dread_Bat,Giant_Toxic_Slime,Giant_Metal_Slime,Red_Cyclops
		hard4=Giantstool,Huge_Toxic_Slime,Huge_Metal_Slime,Tarantula
		boss4=Giant_Spider,Ancient_Cyclops,Chaos_Hydra,Fire_Cyclops,Mad_Cyclops
		easy5=Giantstool,Huge_Toxic_Slime,Huge_Metal_Slime,Tarantula,Giant_Toxic_Slime,Giant_Metal_Slime,Red_Cyclops
		#level 0s
		Mudcrawler=Mudcrawler
		Giant_Ant=WBD_Giant Ant
		Rat_Swarm=WBD_Rat_Swarm
		Troglodyte_Spawn=WBD_Troglodyte Spawn
        Vampire_Bat=Vampire Bat
		#level 1s
        Wolf=Wolf
        Metal_Slime=Metal Slime
        Giant_Mudcrawler=Giant Mudcrawler
		Troglodyte=WBD_Troglodyte
        Toxic_Slime=Toxic Slime
        Blood_Bat=Blood Bat
        Spider=Free Spider
        Hydra=WBD_Tharis_Hydra
        Sporeling=Sporeling
        Barbarian_Cyclops=WBD_Barbarian_Cyclop
		#level 2s
        Giant_Scorpion=Giant Scorpion
        Giant_Metal_Slime=Giant Metal Slime
        Giant_Toxic_Slime=Giant Toxic Slime
        Dread_Bat=Dread Bat
		Red_Cyclops=WBD_Barbarian_RedCyclop
		Mighty_Cyclops=WBD_Barbarian_MightyCyclop
		Huge_Mudcrawler=Huge Mudcrawler
		Deep_Hydra=WBD_Tharis_Deephydra
		Fungoid=Fungoid
		Tarantula=Free Tarantula
		#level 3s
		Huge_Metal_Slime=Huge Metal Slime
		Huge_Toxic_Slime=Huge Toxic Slime
		Mad_Cyclops=WBD_Barbarian_MadCyclop
		Fire_Cyclops=WBD_Barbarian_FireCyclop
		Giantstool=Giantstool
		Chaos_Hydra=WBD_Tharis_Chaoshydra
		Giant_Spider=Giant Spider
		Ancient_Cyclops=WBD_Barbarian_AncientCyclop
    [/theme]
	[theme]
        id="outlaws"
		max_cluster_level=4
		#groups
		easy0=Ruffian,Brute,Woodsman
		hard0={X3 Ruffian,Brute,Woodsman},Footpad,Thug,Poacher
		boss0=Footpad,Thug,Poacher,{X2 Thief},Cunning_Woman
		easy1={X2 Ruffian,Brute,Woodsman},Footpad,Thief,Thug,Poacher
		hard1=Outlaw,Rogue,Bandit,Trapper
		boss1=Cunning_Woman,Minotaur_Gore,Minotaur_Cutthroat,Minotaur_Behemoth,Minotaur_Shaman
		easy2=Outlaw,Rogue,Bandit,Trapper
		hard2=Minotaur_Gore,Minotaur_Cutthroat,Minotaur_Behemoth,Fugitive,Highwayman
		boss2=Witch,Minotaur_Shaman,Ranger,Huntsman,Assassin
		easy3=Fugitive,Highwayman
		hard3=Minotaur_Slayer,Minotaur_Savage,Minotaur_Rouser,Ancient_Behemoth,Ranger,Huntsman,Assassin
		boss3=Minotaur_Mystic,Minotaur_Warlock
		easy4=Minotaur_Slayer,Minotaur_Savage,Minotaur_Rouser,Ancient_Behemoth,Ranger,Huntsman,Assassin
		hard4=Minotaur_Slayer,Minotaur_Savage,Minotaur_Rouser,Ancient_Behemoth
		boss4=Minotaur_Overlord,Minotaur_Executioner,Minotaur_Elder,Minotaur_Mystic,Minotaur_Warlock
		easy5=Minotaur_Slayer,Minotaur_Savage,Minotaur_Rouser,Ancient_Behemoth
		#level 0s
        Ruffian=Ruffian
        Brute=WBD_Brute
        Woodsman=Woodsman
		Outlaw_Maiden=WBD_Outlaw Maiden
		#level 1s
        Footpad=Footpad
        Thief=Thief
        Thug=Thug
        Poacher=Poacher
		Cunning_Woman=WBD_Cunning Woman
		#level 2s
        Outlaw=Outlaw
        Rogue=Rogue
        Bandit=Bandit
        Trapper=Trapper
		Witch=WBD_Witch
        Minotaur_Gore=WBD_Minotaur Gore
        Minotaur_Cutthroat=WBD_Minotaur Cutthroat
        Minotaur_Behemoth=WBD_Minotaur Behemoth
        Minotaur_Shaman=WBD_Minotaur Shaman
		#level 3s
		Fugitive=Fugitive
		Highwayman=Highwayman
		Assassin=Assassin
		Huntsman=Huntsman
		Ranger=Ranger
		Ancient_Behemoth=WBD_Minotaur Ancient Behemoth
		Minotaur_Rouser=WBD_Minotaur Rouser
		Minotaur_Savage=WBD_Minotaur Savage
		Minotaur_Slayer=WBD_Minotaur Slayer
		Minotaur_Warlock=WBD_Minotaur Warlock
		Minotaur_Mystic=WBD_Minotaur Mystic
		#level 4s
		Minotaur_Overlord=WBD_Minotaur Overlord
		Minotaur_Executioner=WBD_Minotaur Executioner
		Minotaur_Elder=WBD_Minotaur Elder
    [/theme]
    [theme]
        id="orcs"
		max_cluster_level=4
		#groups
        easy0={X2 Goblin_Slave},Goblin_Tamer,Goblin_Spearman
        hard0={X2 Goblin_Tamer},{X3 Goblin_Tamer,Goblin_Spearman},Troll_Whelp
		boss0={X5 Goblin_Rouser},Orcish_Leader,Orcish_Grunt,Orcish_Archer,Young_Ogre,Orcish_Assassin
		easy1={X2 Goblin_Slave,Goblin_Tamer},{X3 Goblin_Spearman},Orcish_Grunt,Troll_Whelp,Orcish_Archer,Goblin_Impaler
		hard1={X2 Orcish_Grunt,Troll_Whelp,Orcish_Archer,Goblin_Impaler},Orcish_Assassin,Young_Ogre,Wolf_Rider,Barbarian_Berserker
		boss1={X5 Orcish_Ruler},{X2 Troll_Hero,Troll_Shaman},Orcish_Warrior,Orcish_Slayer,Ogre,Orcish_Crossbowman
		easy2=Orcish_Grunt,Troll_Whelp,Orcish_Archer,Goblin_Impaler,Orcish_Assassin,Young_Ogre
		hard2=Orcish_Grunt,Troll_Whelp,Orcish_Archer,{X2 Orcish_Assassin,Young_Ogre,Wolf_Rider},Barbarian_Berserker,Orcish_Crossbowman,Orcish_Warrior,Ogre,Troll_Rocklobber,Troll,Barbarian
		boss2=Orcish_Ruler,{X4 Orcish_Sovereign},Troll_Shaman,Great_Troll,Orcish_Slurbow
		easy3=Orcish_Assassin,Barbarian_Berserker,{X2 Orcish_Crossbowman,Orcish_Warrior},Ogre,Troll_Rocklobber,Troll,Barbarian,Orcish_Slayer
		hard3=Goblin_Knight,Goblin_Pillager,Orcish_Crossbowman,Orcish_Warrior,Ogre,Troll_Rocklobber,Troll,Barbarian,Orcish_Slayer
		boss3={X2 Orcish_Sovereign},Troll_Shaman,Great_Troll,Orcish_Slurbow,Orcish_Warlord,Orcish_Slayer
		easy4=Orcish_Crossbowman,Orcish_Warrior,Ogre,Troll_Rocklobber,Troll,Barbarian,Orcish_Slayer,Orcish_Warlord,Orcish_Slurbow
		hard4=Orcish_Slayer,Troll_Warrior,Orcish_Warlord,Great_Barbarian,Great_Troll,Orcish_Slurbow,Direwolf_Rider,Goblin_Knight,Goblin_Pillager,Siege_Troll
		boss4=Siege_Troll,Orcish_Warlord,Orcish_Sovereign,Great_Barbarian,Orcish_Slurbow
		easy5=Orcish_Warlord,Great_Barbarian,Siege_Troll,Orcish_Slurbow,Direwolf_Rider
		#level 0s
        Goblin_Slave=WBD_Goblin Slave
        Goblin_Tamer=WBD_Goblin Tamer
        Goblin_Spearman=WBD Goblin Spearman
        Goblin_Rouser=Goblin Rouser
		#level 1s
        Orcish_Grunt=Orcish Grunt
        Troll_Whelp=WBD Troll Whelp
        Orcish_Archer=Orcish Archer
        Young_Ogre=Young Ogre
		Orcish_Leader=Orcish Leader
        Wolf_Rider=Wolf Rider
        Goblin_Impaler=WBD Goblin Impaler
        Orcish_Assassin=Orcish Assassin
		Barbarian_Berserker=WBD_Barbarian_Berserker
		#level 2s
        Orcish_Warrior=Orcish Warrior
		Orcish_Ruler=Orcish Ruler
		Orcish_Slayer=Orcish Slayer
        Ogre=Ogre
        Troll_Rocklobber=Troll Rocklobber
        Troll=WBD Troll
		Troll_Hero=WBD Troll Hero
		Troll_Shaman=Troll Shaman
		Orcish_Crossbowman=Orcish Crossbowman
		Goblin_Knight=Goblin Knight
		Goblin_Pillager=Goblin Pillager
		Barbarian=WBD_Barbarian_Barbarian
		#level 3s
		Troll_Warrior=WBD Troll Warrior
		Orcish_Warlord=Orcish Warlord
		Orcish_Sovereign=Orcish Sovereign
		Great_Troll=WBD Great Troll
		Orcish_Slurbow=Orcish Slurbow
		Direwolf_Rider=Direwolf Rider
		Great_Barbarian=WBD_Barbarian_GreatBarbarian
		#level 4s
		Siege_Troll=WBD Siege Troll
    [/theme]
    [theme]
        id="undead"
		max_cluster_level=4
		#groups
		easy0=Walking_Corpse,Walking_Bones,Spirit
		hard0={X2 Walking_Corpse,Walking_Bones,Spirit,Soulless},Skeleton,Skeleton_Archer
		boss0={X5 Dark_Adept},Skeleton_Archer,Skeleton,Ghoul,Skeleton_Rider,Ghost
		easy1=Walking_Corpse,Walking_Bones,Spirit,{X2 Soulless},Skeleton_Archer,Skeleton,Skeleton_Rider,Ghost
		hard1={X4 Soulless},{X3 Skeleton_Archer,Skeleton,Ghost},{X2 Skeleton_Rider,Dark_Adept,Ghoul},Shadow,Deathblade,Dark_Adept
		boss1={X5 Dark_Sorcerer},{X3 Death_Squire},Revenant,Bone_Shooter,Wraith,Necrophage,Shadow,Dark_Adept
		easy2=Soulless,Skeleton,Skeleton_Archer,{X2 Ghoul,Skeleton_Rider,Bone_Shooter},Revenant,Wraith,Shadow,Deathblade,Chocobone
		hard2=Dark_Adept,Revenant,Wraith,Shadow,Deathblade,Chocobone,Bone_Shooter,Necrophage,Revenant,Skeleton,Skeleton_Archer,Ghoul
		boss2=Dark_Sorcerer,Death_Squire,{X3 Necromancer,Lich},{X2 Death_Knight},Spectre,Nightgaunt,Draug,Banebow,Bone_Knight
		easy3={X2 Shadow,Wraith,Bone_Shooter,Deathblade,Revenant},Chocobone,Ghoul,Skeleton_Rider,Skeleton,Skeleton_Archer,Soulless
		hard3=Dark_Sorcerer,Spectre,Nightgaunt,Draug,Banebow,Bone_Knight,Shadow,Necrophage,Wraith,Bone_Shooter,Deathblade,Revenant,Chocobone
		boss3={X3 Necromancer,Lich},{X2 Death_Knight},Ancient_Lich,Skeletal_Dragon,Bone_Knight
		easy4={X2 Spectre,Nightgaunt,Draug,Banebow},Bone_Knight,Shadow,Necrophage,Wraith,Bone_Shooter,Deathblade,Revenant,Chocobone
		hard4=Necromancer,Lich,{X2 Spectre,Nightgaunt,Draug,Banebow,Bone_Knight},Skeletal_Dragon
		boss4={X3 Ancient_Lich},Skeletal_Dragon,Death_Knight
		easy5=Skeletal_Dragon,Spectre,Nightgaunt,Draug,Banebow,Bone_Knight
		#level 0s
        Walking_Corpse=Walking Corpse
		Walking_Bones=Walking Bones
		Spirit=WBD_Spirit
		#level 1s
        Soulless=Soulless
        Skeleton_Archer=Skeleton Archer
        Skeleton=Skeleton
        Ghoul=Ghoul
        Dark_Adept=Dark Adept
        Skeleton_Rider=Skeleton Rider
        Ghost=Ghost
		#level 2s
		Dark_Sorcerer=Dark Sorcerer
        Shadow=Shadow
        Necrophage=Necrophage
        Wraith=Wraith
        Bone_Shooter=Bone Shooter
        Deathblade=Deathblade
		Revenant=Revenant
		Death_Squire=Death Squire
		Chocobone=Chocobone
		#level 3s
		Bone_Knight=Bone Knight
		Death_Knight=Death Knight
		Banebow=Banebow
		Draug=Draug
		Nightgaunt=Nightgaunt
		Spectre=Spectre
		Necromancer=Necromancer
		Lich=Lich
		#level 4s
		Ancient_Lich=Ancient Lich
		Skeletal_Dragon=Skeletal Dragon
    [/theme]
	[theme]
        id="water"
		max_cluster_level=4
		#groups
		easy0=Saurian_Husk,{X3 Spout},Saurian_Trainee,Mudcrawler
		hard0=Spout,Saurian_Lurker,{X3 Saurian_Husk},Tentacle
		boss0=Giant_Mudcrawler,Tentacle,Saurian_Lurker,Tidal
		easy1=Saurian_Husk,Spout,Saurian_Trainee,Mudcrawler,Saurian_Lurker
		hard1={X3 Tidal},{X2 Tentacle},Saurian_Lurker,Naga_Fighter,Giant_Mudcrawler
		boss1=Young_Cuttle_Fish,Saurian_Augur,Saurian_Skirmisher,Saurian_Assassin,Saurian_Sage,Saurian_Mage
		easy2=Naga_Fighter,Swamp_Guard,Saurian_Lurker,{X2 Tentacle},Saurian_Warrior
		hard2=Young_Cuttle_Fish,{X2 Saurian_Skirmisher},Saurian_Assassin,Saurian_Augur
		boss2=Saurian_Oracle,Saurian_Soothsayer,Saurian_Shockfrost,Saurian_Frosty,Saurian_Healer,Saurian_Mystic
		easy3=Young_Cuttle_Fish,{X2 Saurian_Skirmisher},{X2 Saurian_Lurker}
		hard3=Naga_Warrior,Saurian_Ambusher,Saurian_Soothsayer,Saurian_Flanker,Saurian_Healer,Saurian_Killer
		boss3=Cuttle_Fish,Saurian_Oracle,Naga_Myrmidon,Saurian_Frosty,Saurian_Shockfrost,Saurian_Mystic
		easy4=Naga_Warrior,Saurian_Ambusher,Saurian_Killer,{X2 Naga_Fighter}
		hard4=Cuttle_Fish,Naga_Myrmidon,Saurian_Flanker,Saurian_Hero,Swamp_Warrior,Swamp_Margrave
		boss4=Armored_Cuttle_Fish,Saurian_Elementalist,Saurian_Ice_Lord,Sea_Serpent
		easy5=Naga_Myrmidon,Saurian_Flanker,Saurian_Hero,Swamp_Warrior,Swamp_Margrave
		#level 0s
		Saurian_Husk=WBD_Saurian Husk
		Spout=WBD_Spout
		Saurian_Trainee=Saurian Trainee
		Mudcrawler=Mudcrawler
		#level 1s		
		Saurian_Lurker=WBD_Saurian Lurker
        Tentacle=Tentacle of the Deep
		Tidal=WBD_Tidal
        Naga_Fighter=Naga Fighter
        Saurian_Sage=Saurian Sage
        Saurian_Mage=Saurian Mage
        Swamp_Guard=Swamp Guard
        Saurian_Warrior=Saurian Warrior
        Saurian_Assassin=Saurian Assassin
        Saurian_Skirmisher=Saurian Skirmisher
        Saurian_Augur=Saurian Augur
		Young_Cuttle_Fish=TR Young Cuttle Fish
		Giant_Mudcrawler=Giant Mudcrawler
		#level 2s
        Naga_Warrior=Naga Warrior
        Saurian_Oracle=Saurian Oracle
        Saurian_Soothsayer=Saurian Soothsayer
        Saurian_Ambusher=Saurian Ambusher
        Saurian_Shockfrost=Saurian Shockfrost
		Saurian_Frosty=Saurian Frosty
		Saurian_Killer=Saurian Killer
		Saurian_Healer=Saurian Healer
		Saurian_Mystic=Saurian Mystic
		Cuttle_Fish=Cuttle Fish
		Saurian_Flanker=Saurian Flanker
		#level 3s
		Naga_Myrmidon=Naga Myrmidon
		Armored_Cuttle_Fish=TR Armored Cuttle Fish
		Saurian_Elementalist=Saurian Elementalist
		Saurian_Hero=Saurian Hero
		Swamp_Warrior=Swamp Warrior
		Swamp_Margrave=Swamp Margrave
		Saurian_Ice_Lord=Saurian Ice Lord
		Sea_Serpent=Sea Serpent
    [/theme]
	[theme]
        id="planar"
		max_cluster_level=4
		#groups
		easy0=Tharis_Darkwarrior,Devling_Flappers,Devling_Sneak
		hard0=Tharis_Disciple,Devling_Nailers,Devling_Lurker
		boss0=Tharis_Witch,Tharis_Bladedancer
		easy1={X2 Tharis_Darkwarrior,Tharis_Disciple},Tharis_Bladedancer,Devling_Nailers
		hard1=Devling_Spikers,Devling_Soldier,Devling_Warrior,Tharis_Bladedancer,Overgrown_Devling
		boss1={X2 Devling_Cursers},Tharis_Witch,Tharis_Commander
		easy2=Devling_Spikers,Devling_Soldier,Devling_Warrior,{X2 Tharis_Darkwarrior,Tharis_Disciple,Tharis_Bladedancer}
		hard2=Tharis_Slayer,Tharis_Assassin,Tharis_GreatHunter,Tharis_Sworddancer,Devling_Flyers
		boss2=Devling_Blasphemists,Tharis_Darkwizard,Tharis_Shadowwitch,Tharis_Commander
		easy3={X2 Tharis_Slayer,Tharis_Assassin,Tharis_GreatHunter,Tharis_Sworddancer},Devling_Spikers,Devling_Warrior
		hard3=Tharis_Blademaster,Devling_Staplers,Devling_Chief,Devling_Hero
		boss3=Devling_Offenders,Tharis_Darkwizard,Tharis_Shadowwitch
		easy4=Devling_Staplers,Tharis_Blademaster,Devling_Chief
		hard4=Devling_Staplers,Devling_Attackers,Devling_Chief
		boss4=Tharis_Matriarch,Tharis_Shadowmatriarch,Tharis_Greatwarlock,Tharis_General,Devling_Abusers,Tharis_Darkmaster,Tharis_Warmaster
		easy5=Devling_Staplers,Devling_Attackers
		#level 0s
		Devling_Sneak=WBD_Devling Sneak
		#level 1s
        Tharis_Darkwarrior=WBD_Tharis_Darkwarrior
        Tharis_Disciple=WBD_Tharis_Disciple
        Tharis_Witch=WBD_Tharis_Witch
        Tharis_Bladedancer=WBD_Tharis_Bladedancer
        Tharis_Hunter=WBD_Tharis_Hunter
		Devling_Flappers=WBD_Devling Flappers
		Devling_Lurker=WBD_Devling Lurker
		Devling_Nailers=WBD_Devling Nailers
        Devling_Soldier=WBD_Devling Soldier
        Devling_Warrior=WBD_Devling Warrior
		Overgrown_Devling=WBD_Overgrown Devling
		Devling_Cursers=WBD_Devling Cursers
		#level 2s
        Tharis_Commander=WBD_Tharis_Commander
        Tharis_Slayer=WBD_Tharis_Slayer
        Tharis_Assassin=WBD_Tharis_Assassin
        Tharis_GreatHunter=WBD_Tharis_GreatHunter
        Tharis_Sworddancer=WBD_Tharis_Sworddancer
        Tharis_Darkwizard=WBD_Tharis_Darkwizard
		Tharis_Shadowwitch=WBD_Tharis_Shadowwitch
		Tharis_Blademaster=WBD_Tharis_Blademaster
		Devling_Spikers=WBD_Devling Spikers
		Devling_Flyers=WBD_Devling Flyers
		Devling_Staplers=WBD_Devling Staplers
		Devling_Chief=WBD_Devling Chief
		Devling_Hero=WBD_Devling Hero
		Devling_Blasphemists=WBD_Devling Blasphemists
		#level 3s
		Tharis_Matriarch=WBD_Tharis_Matriarch
		Tharis_Shadowmatriarch=WBD_Tharis_Shadowmatriarch
		Tharis_ColdMatriarch=WBD_Tharis_ColdMatriarch
		Tharis_Greatwarlock=WBD_Tharis_Greatwarlock
		Tharis_General=WBD_Tharis_Commander_in_chief
		Devling_Attackers=WBD_Devling Attackers
		Devling_Staplers=WBD_Devling Staplers
		Devling_Offenders=WBD_Devling Offenders
		#level 4s
		Tharis_Warmaster=WBD_Tharis_Masterofwar
		Tharis_Darkmaster=WBD_Tharis_Masterofdarkness
		Devling_Abusers=WBD_Devling Abusers		
    [/theme]
#enddef

#define TEST_MOB_LISTS
	{FOREACH theme mob_theme}
		[wml_message]
			message="testing $theme[$mob_theme].id theme"
			logger=err
		[/wml_message]
		{VARIABLE mob_level 0}
		[while]
			[variable]
				name=mob_level
				less_than_equal_to=$theme[$mob_theme].max_cluster_level
			[/variable]
			[do]
				[wml_message]
					message="testing easy$mob_level"
					logger=err
				[/wml_message]
				[set_variables]
					name=type_list
					mode=replace
					[split]
						list=$theme[$mob_theme].easy$mob_level
						key=type_name
						separator=","
						remove_empty=no
					[/split]
				[/set_variables]
				{FOREACH type_list mob_type}
					[wml_message]
						message="testing $type_list[$mob_type].type_name :: $theme[$mob_theme].$type_list[$mob_type].type_name"
						logger=err
					[/wml_message]
					[unit]
						side=1
						type=$theme[$mob_theme].$type_list[$mob_type].type_name
						x=1
						y=1
						generate_name=yes
						[status]
							stoned="yes"
						[/status]
						random_traits=yes
						random_gender=yes
						generate_name=yes
					[/unit]
					[kill]
						x,y=1,1
						animate=no
						fire_event=no
					[/kill]
				{NEXT mob_type}
				[wml_message]
					message="testing hard$mob_level"
					logger=err
				[/wml_message]
				[set_variables]
					name=type_list
					mode=replace
					[split]
						list=$theme[$mob_theme].hard$mob_level
						key=type_name
						separator=","
						remove_empty=no
					[/split]
				[/set_variables]
				{FOREACH type_list mob_type}
					[wml_message]
						message="testing $type_list[$mob_type].type_name :: $theme[$mob_theme].$type_list[$mob_type].type_name"
						logger=err
					[/wml_message]
					[unit]
						side=1
						type=$theme[$mob_theme].$type_list[$mob_type].type_name
						x=1
						y=1
						generate_name=yes
						[status]
							stoned="yes"
						[/status]
						random_traits=yes
						random_gender=yes
						generate_name=yes
					[/unit]
					[kill]
						x,y=1,1
						animate=no
						fire_event=no
					[/kill]
				{NEXT mob_type}
				[wml_message]
					message="testing boss$mob_level"
					logger=err
				[/wml_message]
				[set_variables]
					name=type_list
					mode=replace
					[split]
						list=$theme[$mob_theme].boss$mob_level
						key=type_name
						separator=","
						remove_empty=no
					[/split]
				[/set_variables]
				{FOREACH type_list mob_type}
					[wml_message]
						message="testing $type_list[$mob_type].type_name :: $theme[$mob_theme].$type_list[$mob_type].type_name"
						logger=err
					[/wml_message]
					[unit]
						side=1
						type=$theme[$mob_theme].$type_list[$mob_type].type_name
						x=1
						y=1
						generate_name=yes
						[status]
							stoned="yes"
						[/status]
						random_traits=yes
						random_gender=yes
						generate_name=yes
					[/unit]
					[kill]
						x,y=1,1
						animate=no
						fire_event=no
					[/kill]
				{NEXT mob_type}
				{VARIABLE_OP mob_level add 1}
			[/do]
		[/while]
	{NEXT mob_theme}
	[wml_message]
		message="testing complete"
		logger=err
	[/wml_message]
#enddef

#macros to more easily and clearly weight probabilities of units being selected - more can be defined as needed
#define X2 COMMA_LIST
{COMMA_LIST},{COMMA_LIST}#enddef
#define X3 COMMA_LIST
{COMMA_LIST},{COMMA_LIST},{COMMA_LIST}#enddef
#define X4 COMMA_LIST
{COMMA_LIST},{COMMA_LIST},{COMMA_LIST},{COMMA_LIST}#enddef
#define X5 COMMA_LIST
{COMMA_LIST},{COMMA_LIST},{COMMA_LIST},{COMMA_LIST},{COMMA_LIST}#enddef

#define GENERATE_BOSS_ITEMS
	#50/50 chance that boss will have 1-2 items, 50/50 that it's weapon or armor
	{VARIABLE_OP boss_items_rand rand 1..2}
	[while]
		[variable]
			name=boss_items_rand
			greater_than=0
		[/variable]
		[do]
			[store_unit]
				variable=npc_temp
				[filter]
					x,y=$mob_x|,$mob_y|
				[/filter]
			[/store_unit]
			{RANDOM 0..1}
			[if]
				[variable]
					name=random
					numerical_equals=0
				[/variable]
				[then]
					#event to create random weapon, will take inputs
					#have to calculate weapon rank differently, since mob level is different now
					{VARIABLE level_minus_3 $dungeon_level.max}
					{VARIABLE_OP level_minus_3 add  -3}
					[if]
						[variable]
							name=level_minus_3
							less_than=0
						[/variable]
						[then]
							{VARIABLE level_minus_3 0}
						[/then]
					[/if]
					{VARIABLE_OP new_weapon_rank rand $level_minus_3..$dungeon_level.max}
					{RANDOM 0..4}
					{VARIABLE_OP new_weapon_rank add $random}
					{VARIABLE new_weapon_path "prob_dungeon_weapon"}
					{VARIABLE random_weapon_type 1}
					{VARIABLE random_weapon_attribute 1}
					[fire_event]
						name=create_weapon
					[/fire_event]
					#path?
					{VARIABLE path "new_weapon"}
					[fire_event]
						name=npc_eval_weapon
					[/fire_event]
				[/then]
				[else]
					#event to create random armor, will take inputs
					#have to calculate armor rank differently, since mob level is different now
					{VARIABLE level_minus_3 $dungeon_level.max}
					{VARIABLE_OP level_minus_3 add  -3}
					[if]
						[variable]
							name=level_minus_3
							less_than=0
						[/variable]
						[then]
							{VARIABLE level_minus_3 0}
						[/then]
					[/if]
					{VARIABLE_OP new_armor_rank rand $level_minus_3..$dungeon_level.max}
					{RANDOM 0..4}
					{VARIABLE_OP new_armor_rank add $random}
					{VARIABLE random_armor_attribute 1}
					{VARIABLE random_armor_type 1}
					{VARIABLE new_armor_path "prob_dungeon_armor"}
					[fire_event]
						name=create_armor
					[/fire_event]
					{VARIABLE path "new_armor"}
					[if]
						[variable]
							name=$path|.category
							equals="shield"
						[/variable]
						[then]
							[fire_event]
								name=npc_eval_shield
							[/fire_event]
						[/then]
						[else]
							[fire_event]
								name=npc_eval_armor
							[/fire_event]
						[/else]
					[/if]
				[/else]
			[/if]
			[if]
				[variable]
					name=will_carry
					numerical_equals=0
				[/variable]
				[then]
					[item]
						x=$mob_x
						y=$mob_y
						image=items/$$path|.ground_icon|.png
						visible_in_fog=no
					[/item]
					[set_variables]
						name=ground_$mob_x|_$mob_y|.items
						mode=append
						[insert_tag]
							name=literal
							variable=$path
						[/insert_tag]
					[/set_variables]
				[/then]
			[/if]
			{VARIABLE_OP boss_items_rand add -1}
		[/do]
	[/while]
	{VARIABLE_OP boss_items_rand rand 0..2}
	[while]
		[variable]
			name=boss_items_rand
			greater_than=0
		[/variable]
		[do]
			[store_unit]
				variable=npc_temp
				[filter]
					x,y=$mob_x|,$mob_y|
				[/filter]
			[/store_unit]
			{VARIABLE_OP new_potion_rank rand 0..$mob_level}
			{VARIABLE_OP new_potion_rank add $mob_level}
			{DEBUG "new_potion_rank:$new_potion_rank"}
			{VARIABLE random_potion_type 0}
			{VARIABLE new_potion_type "healing"}
			{VARIABLE new_potion_path "prob_dungeon_potion"}
			[fire_event]
				name=create_potion
			[/fire_event]
			{VARIABLE path "new_potion"}
			[fire_event]
				name=npc_eval_usable
			[/fire_event]
			[if]
				[variable]
					name=will_carry
					numerical_equals=0
				[/variable]
				[then]
					[item]
						x=$mob_x
						y=$mob_y
						image=items/$new_potion.ground_icon|.png
						visible_in_fog=no
					[/item]
					[set_variables]
						name=ground_$mob_x|_$mob_y|.items
						mode=append
						[insert_tag]
							name=literal
							variable=new_potion
						[/insert_tag]
					[/set_variables]
				[/then]
			[/if]
			{VARIABLE_OP boss_items_rand add -1}
		[/do]
	[/while]
	[store_unit]
		variable=npc_temp
		[filter]
			x,y=$mob_x|,$mob_y|
		[/filter]
	[/store_unit]
	{VARIABLE npc_temp.overlays "misc/hero-icon.png"}
	[unstore_unit]
		variable=npc_temp
		find_vacant=no
	[/unstore_unit]
#enddef

#define GENERATE_MOB ITEMS
	[unit]
		side=$place_side
		type=$theme[$mob_theme].$mob_type
		x=1
		y=1
		generate_name=yes
		[status]
			stoned="yes"
		[/status]
		random_traits=yes
		random_gender=yes
		generate_name=yes
		personal_gold=0
	[/unit]
	#give gold, if any
	{VARIABLE_OP gold_level rand 0..$mob_level}
	{VARIABLE_OP gold_level multiply 10}
	{RANDOM 0..9}
	{VARIABLE_OP gold_level add $random}
	[if]
		[variable]
			name=gold_level
			greater_than=0
		[/variable]
		[then]
			[store_unit]
				variable=npc_temp
				[filter]
					x,y=1,1
				[/filter]
			[/store_unit]
			[if]
				{LIKES_GOLD}
				[then]
					{VARIABLE npc_temp.personal_gold $gold_level}
					[unstore_unit]
						variable=npc_temp
					[/unstore_unit]
				[/then]
				[else]
					{DROP_GOLD gold_level $mob_x| $mob_y|}
				[/else]
			[/if]
		[/then]
	[/if]
	#give items, if any
	[store_unit]
		variable=npc_temp
		[filter]
			x,y=1,1
		[/filter]
		kill=yes
	[/store_unit]
	#unstone if players are near
	[if]
		[have_unit]
			side=1,2,3
			[filter_location]
				x,y=$mob_x|,$mob_y|
				radius=13
			[/filter_location]
		[/have_unit]
		[then]
			{CLEAR_VARIABLE npc_temp.status.stoned}
		[/then]
	[/if]
	#add some exp
	{RANDOM 10..$npc_temp.max_experience}
	[if]
		[variable]
			name=random
			greater_than=15
		[/variable]
		[then]
			{RANDOM 10..$npc_temp.max_experience}
		[/then]
	[/if]
	{VARIABLE_OP random add -10}
	{VARIABLE npc_temp.experience $random}
	{VARIABLE npc_temp.max_simple_action 1}
	[unstore_unit]
		variable=npc_temp
		find_vacant=yes
		x=$mob_x
		y=$mob_y
	[/unstore_unit]
	{{ITEMS}}
#enddef

#define WBD_GENERATE_MOBS
	#first, themes are selected
	{VARIABLE_OP terr_rand rand 1..10}
	{RANDOM 8..14}
	{IF_VAR random less_than $dungeon_level.current (
		[then]
			{RANDOM 11..20}
			{VARIABLE terr_rand $random}
		[/then]
	)}
	{RANDOM 1..5}
	{IF_VAR random less_than $dungeon_level.current (
		[then]
			{VARIABLE_OP creeps_theme1 rand 0..3}
			{VARIABLE_OP creeps_theme2 rand 0..3}
		[/then]
		[else]
			{VARIABLE_OP creeps_theme1 rand 0..2}
			{VARIABLE_OP creeps_theme2 rand 0..2}
		[/else]
	)}
	[if]
		[variable]
			name=terr_rand
			less_than=9
		[/variable]
		[then]
			#make crims greater chance of being dominant
			{RANDOM 0..2}
			[if]
				[variable]
					name=random
					numerical_equals=0
				[/variable]
				[then]
					{VARIABLE creeps_theme1 1}
				[/then]
			[/if]
		[/then]
	[/if]
	[if]
		[variable]
			name=dungeon_level.current
			greater_than=5
		[/variable]
		[then]
			#make planar greater chance of being dominant
			{RANDOM 0..2}
			[if]
				[variable]
					name=random
					numerical_equals=0
				[/variable]
				[then]
					{VARIABLE creeps_theme1 5}
				[/then]
			[/if]
		[/then]
	[/if]
	[if]
		[variable]
			name=terr_rand
			numerical_equals=15
		[/variable]
		[or]
			[variable]
				name=terr_rand
				numerical_equals=16
			[/variable]
		[/or]
		[then]
			[if]
				[variable]
					name=water_level_counter
					less_than=2
				[/variable]
				[then]
					#water to show up not as early and force it to be not frequently
					{VARIABLE_OP water_level_counter add 1}
					{VARIABLE terr_rand 14}
				[/then]
				[else]
					#make water definite chance of being dominant
					{VARIABLE creeps_theme1 4}
					{VARIABLE water_level_counter 0}
				[/else]
			[/if]
		[/then]
	[/if]
	[if]
		[variable]
			name=creep_theme1
			numerical_equals=$creep_theme2
		[/variable]
		[then]
			#fix collisions, and give cave creeps greater chance at being theme 2
			[if]
				[variable]
					name=creep_theme1
					numerical_equals=0
				[/variable]
				[then]
					{RANDOM 1..5}
					{IF_VAR random less_than $dungeon_level.current (
						[then]
							{VARIABLE_OP creep_theme1 rand 1..3}
						[/then]
						[else]
							{VARIABLE_OP creep_theme1 rand 1..2}
						[/else]
					)}
				[/then]
				[else]
					{VARIABLE creep_theme2 0}
				[/else]
			[/if]
		[/then]
	[/if]
	#section off opposing sides of the dungeon to put the mobs so they won't all just be attacking each other all the time
	{CLEAR_VARIABLE chamber_creeps1}
	{CLEAR_VARIABLE chamber_creeps2}
	{VARIABLE_OP divide_direction rand x,y}
	{VARIABLE_OP mob_divide_high rand 23..33}
	{VARIABLE mob_divide_low $mob_divide_high}
	{VARIABLE_OP mob_divide_low add -5}
	{VARIABLE_OP divide_order_first rand 1,2}
	[if]
		[variable]
			name=divide_order_first
			numerical_equals=1
		[/variable]
		[then]
			{VARIABLE divide_order_second 2}
		[/then]
		[else]
			{VARIABLE divide_order_second 1}
		[/else]
	[/if]
	{FOREACH chamber_terrain i}
		[if]
			[variable]
				name=chamber_terrain[$i].$divide_direction
				greater_than=$mob_divide_high
			[/variable]
			[then]
				[set_variables]
					name=chamber_creeps$divide_order_first
					mode=append
					to_variable=chamber_terrain[$i]
				[/set_variables]
			[/then]
		[/if]
		[if]
			[variable]
				name=chamber_terrain[$i].$divide_direction
				less_than=$mob_divide_low
			[/variable]
			[then]
				[set_variables]
					name=chamber_creeps$divide_order_second
					mode=append
					to_variable=chamber_terrain[$i]
				[/set_variables]
			[/then]
		[/if]
	{NEXT i}
	#then the fun begins
	#max_cluster_level 0,1,1,1,2,2,2,2,3,3,3,4...
	{VARIABLE max_cluster_level $dungeon_level.current}
	{VARIABLE_OP max_cluster_level multiply .3}
	{VARIABLE_OP max_cluster_level round 0}
	#min_cluster_level 0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4...
	{VARIABLE min_cluster_level $dungeon_level.current}
	{VARIABLE_OP min_cluster_level add -1}
	{VARIABLE_OP min_cluster_level multiply .2}
	{VARIABLE_OP min_cluster_level round floor}
	#nominal levels used to weight odds toward high or low end of difficulty scale
	{VARIABLE max_cluster_level_nominal $max_cluster_level}
	{VARIABLE min_cluster_level_nominal $min_cluster_level}
	{VARIABLE_OP min_cluster_level_nominal add -1}
	[if]
		[variable]
			name=min_cluster_level
			greater_than={MAX_CLUSTER_LEVEL_POSSIBLE}
		[/variable]
		[then]
			{VARIABLE min_cluster_level {MAX_CLUSTER_LEVEL_POSSIBLE}}
			{VARIABLE max_cluster_level_nominal {MAX_CLUSTER_LEVEL_POSSIBLE}}
			{VARIABLE min_cluster_level_nominal {MAX_CLUSTER_LEVEL_POSSIBLE}}
		[/then]
	[/if]
	[if]
		[variable]
			name=max_cluster_level
			greater_than={MAX_CLUSTER_LEVEL_POSSIBLE}
		[/variable]
		[then]
			{VARIABLE max_cluster_level {MAX_CLUSTER_LEVEL_POSSIBLE}}
		[/then]
	[/if]
	[switch]
		variable=leader_position.length
		[case]
			value=1
			#the values for mob amounts here probably need to be changed
			{VARIABLE_OP boss_cluster_count rand 1..2}
			{VARIABLE_OP mini_cluster_count rand 1..2}
			{VARIABLE_OP loner_count rand 5..7}
		[/case]
		[case]
			value=2
			{VARIABLE_OP boss_cluster_count rand 1..2}
			{VARIABLE_OP mini_cluster_count rand 2..3}
			{VARIABLE_OP loner_count rand 6..9}
		[/case]
		[case]
			value=3
			{VARIABLE_OP boss_cluster_count rand 2..3}
			{VARIABLE_OP mini_cluster_count rand 3..4}
			{VARIABLE_OP loner_count rand 7..11}
		[/case]
	[/switch]
	{REPEAT $boss_cluster_count (
		#boss clusters always floor themed, more likely to be theme 1
		{VARIABLE_OP mob_theme rand $creeps_theme1|,$creeps_theme1|,$creeps_theme2|}
		{VARIABLE place_side 4}
		{VARIABLE_OP place_side add $mob_theme}
		[if]
			[variable]
				name=mob_theme
				numerical_equals=$creeps_theme1
			[/variable]
			[then]
				{RANDOM 1..$chamber_creeps1.length}
				{VARIABLE_OP random add -1}
				{VARIABLE mob_x $chamber_creeps1[$random].x}
				{VARIABLE mob_y $chamber_creeps1[$random].y}
				[while]
					[have_unit]
						x,y=$mob_x|,$mob_y|
					[/have_unit]
					[do]
						{CLEAR_VARIABLE chamber_creeps1[$random]}
						{RANDOM 1..$chamber_creeps1.length}
						{VARIABLE_OP random add -1}
						{VARIABLE mob_x $chamber_creeps1[$random].x}
						{VARIABLE mob_y $chamber_creeps1[$random].y}
					[/do]
				[/while]
				{CLEAR_VARIABLE chamber_creeps1[$random]}
			[/then]
			[else]
				{RANDOM 1..$chamber_creeps2.length}
				{VARIABLE_OP random add -1}
				{VARIABLE mob_x $chamber_creeps2[$random].x}
				{VARIABLE mob_y $chamber_creeps2[$random].y}
				[while]
					[have_unit]
						x,y=$mob_x|,$mob_y|
					[/have_unit]
					[do]
						{CLEAR_VARIABLE chamber_creeps2[$random]}
						{RANDOM 1..$chamber_creeps2.length}
						{VARIABLE_OP random add -1}
						{VARIABLE mob_x $chamber_creeps2[$random].x}
						{VARIABLE mob_y $chamber_creeps2[$random].y}
					[/do]
				[/while]
				{CLEAR_VARIABLE chamber_creeps2[$random]}
			[/else]
		[/if]
		#generate cluster level
		{VARIABLE_OP cluster_level rand $min_cluster_level_nominal|..$max_cluster_level_nominal|}
		#weighted by nominal levels - tends slightly towards min_cluster_level, once max_cluster_level_nominal
		#exceeds max_level_possible, the weight starts shifting upwards until, when min_cluster_level reaches
		#max_level_possible, you will always have cluster_level=max_level_possible
		[if]
			[variable]
				name=cluster_level
				less_than=$min_cluster_level
			[/variable]
			[then]
				{VARIABLE cluster_level $min_cluster_level}
			[/then]
		[/if]
		[if]
			[variable]
				name=cluster_level
				greater_than=$max_cluster_level
			[/variable]
			[then]
				{VARIABLE cluster_level $min_cluster_level}
				{VARIABLE_OP cluster_level add 1}
			[/then]
		[/if]
		[if]
			[variable]
				name=cluster_level
				greater_than=$theme[$mob_theme].max_cluster_level
			[/variable]
			[then]
				{VARIABLE cluster_level $theme[$mob_theme].max_cluster_level}
			[/then]
		[/if]
		{VARIABLE mob_level $cluster_level}
		{VARIABLE mob_class boss$mob_level}
		{VARIABLE_OP mob_type rand $theme[$mob_theme].$mob_class}
		#create boss mob of type $mob_type
		{GENERATE_MOB GENERATE_BOSS_ITEMS}
		#create a few slightly tougher minions
		{VARIABLE_OP cluster_count rand 1..$leader_position.length}
		#weight towards low end
		{RANDOM 1..$cluster_count}
		{VARIABLE cluster_count $random}
		[while]
			[variable]
				name=cluster_count
				greater_than=0
			[/variable]
			[do]
				{VARIABLE mob_level $cluster_level}
				{RANDOM 0..5}
				[if]
					[variable]
						name=random
						numerical_equals=3
					[/variable]
					[then]
						{VARIABLE_OP mob_level add 1}
						{VARIABLE mob_class easy$mob_level}
					[/then]
					[else]
						{VARIABLE mob_class hard$mob_level}
					[/else]
				[/if]
				{VARIABLE_OP mob_type rand $theme[$mob_theme].$mob_class}
				#create mob of type $mob_type
				{GENERATE_MOB NULL}
				{VARIABLE_OP cluster_count add -1}
			[/do]
		[/while]
		#create a whole bunch of weak minions
		{VARIABLE cluster_count $leader_position.length}
		{VARIABLE_OP cluster_count multiply 2}
		{RANDOM $leader_position.length|..$cluster_count}
		{VARIABLE cluster_count $random}
		[while]
			[variable]
				name=cluster_count
				greater_than=0
			[/variable]
			[do]
				{VARIABLE mob_class easy$cluster_level}
				{VARIABLE_OP mob_type rand $theme[$mob_theme].$mob_class}
				#create mob of type $mob_type
				{GENERATE_MOB NULL}
				{VARIABLE_OP cluster_count add -1}
			[/do]
		[/while]
	)}
	{REPEAT $mini_cluster_count (
		#mini clusters always floor themed, more likely to be theme 2
		{VARIABLE_OP mob_theme rand $creeps_theme1|,$creeps_theme2|,$creeps_theme2|}
		{VARIABLE place_side 4}
		{VARIABLE_OP place_side add $mob_theme}
		[if]
			[variable]
				name=mob_theme
				numerical_equals=$creeps_theme1
			[/variable]
			[then]
				{RANDOM 1..$chamber_creeps1.length}
				{VARIABLE_OP random add -1}
				{VARIABLE mob_x $chamber_creeps1[$random].x}
				{VARIABLE mob_y $chamber_creeps1[$random].y}
				[while]
					[have_unit]
						x,y=$mob_x|,$mob_y|
					[/have_unit]
					[do]
						{CLEAR_VARIABLE chamber_creeps1[$random]}
						{RANDOM 1..$chamber_creeps1.length}
						{VARIABLE_OP random add -1}
						{VARIABLE mob_x $chamber_creeps1[$random].x}
						{VARIABLE mob_y $chamber_creeps1[$random].y}
					[/do]
				[/while]
				{CLEAR_VARIABLE chamber_creeps1[$random]}
			[/then]
			[else]
				{RANDOM 1..$chamber_creeps2.length}
				{VARIABLE_OP random add -1}
				{VARIABLE mob_x $chamber_creeps2[$random].x}
				{VARIABLE mob_y $chamber_creeps2[$random].y}
				[while]
					[have_unit]
						x,y=$mob_x|,$mob_y|
					[/have_unit]
					[do]
						{CLEAR_VARIABLE chamber_creeps2[$random]}
						{RANDOM 1..$chamber_creeps2.length}
						{VARIABLE_OP random add -1}
						{VARIABLE mob_x $chamber_creeps2[$random].x}
						{VARIABLE mob_y $chamber_creeps2[$random].y}
					[/do]
				[/while]
				{CLEAR_VARIABLE chamber_creeps2[$random]}
			[/else]
		[/if]
		#generate cluster level
		{VARIABLE_OP cluster_level rand $min_cluster_level_nominal|..$max_cluster_level_nominal|}
		[if]
			[variable]
				name=cluster_level
				less_than=$min_cluster_level
			[/variable]
			[then]
				{VARIABLE cluster_level $min_cluster_level}
			[/then]
		[/if]
		[if]
			[variable]
				name=cluster_level
				greater_than=$max_cluster_level
			[/variable]
			[then]
				{VARIABLE cluster_level $min_cluster_level}
				{VARIABLE_OP cluster_level add 1}
			[/then]
		[/if]
		[if]
			[variable]
				name=cluster_level
				greater_than=$theme[$mob_theme].max_cluster_level
			[/variable]
			[then]
				{VARIABLE cluster_level $theme[$mob_theme].max_cluster_level}
			[/then]
		[/if]
		#create a few slightly tougher mobs
		{VARIABLE_OP cluster_count rand 1..$leader_position.length}
		#weight towards low end
		{RANDOM 1..$cluster_count}
		{VARIABLE cluster_count $random}
		[while]
			[variable]
				name=cluster_count
				greater_than=0
			[/variable]
			[do]
				{VARIABLE mob_level $cluster_level}
				{RANDOM 0..4}
				[if]
					[variable]
						name=random
						numerical_equals=3
					[/variable]
					[then]
						{VARIABLE_OP mob_level add 1}
						{VARIABLE mob_class easy$mob_level}
					[/then]
					[else]
						{VARIABLE mob_class hard$mob_level}
					[/else]
				[/if]
				{VARIABLE_OP mob_type rand $theme[$mob_theme].$mob_class}
				#create mob of type $mob_type
				#maybe give these a chance (1 in 5?) of having a single item each?
				{GENERATE_MOB NULL}
				{VARIABLE_OP cluster_count add -1}
			[/do]
		[/while]
		#create a whole bunch of weak mobs
		{VARIABLE cluster_count $leader_position.length}
		{VARIABLE_OP cluster_count multiply 2}
		{RANDOM $leader_position.length|..$cluster_count}
		#weight towards low end
		{VARIABLE_OP cluster_count rand $leader_position.length|..$random}
		[while]
			[variable]
				name=cluster_count
				greater_than=0
			[/variable]
			[do]
				{VARIABLE mob_class easy$cluster_level}
				{VARIABLE_OP mob_type rand $theme[$mob_theme].$mob_class}
				#create mob of type $mob_type
				{GENERATE_MOB NULL}
				{VARIABLE_OP cluster_count add -1}
			[/do]
		[/while]
	)}
	{REPEAT $loner_count (
		#loners could be any of the 'common' themes
		{VARIABLE_OP mob_theme rand 0..3}
		{RANDOM 1..10}
		#give planar a shot - 1 in 50 on dungeon level 2, by dungeon level 11 has even chances with common themes
		[if]
			[variable]
				name=random
				less_than=$dungeon_level_current
			[/variable]
			[then]
				{RANDOM 0..4}
				[if]
					[variable]
						name=random
						numerical_equals=4
					[/variable]
					[then]
						{VARIABLE mob_theme 5}
					[/then]
				[/if]
			[/then]
		[/if]
		{VARIABLE place_side 4}
		{VARIABLE_OP place_side add $mob_theme}
		[switch]
			variable=mob_theme
			[case]
				value=$creeps_theme1
				{RANDOM 1..$chamber_creeps1.length}
				{VARIABLE_OP random add -1}
				{VARIABLE mob_x $chamber_creeps1[$random].x}
				{VARIABLE mob_y $chamber_creeps1[$random].y}
				[while]
					[have_unit]
						x,y=$mob_x|,$mob_y|
					[/have_unit]
					[do]
						{CLEAR_VARIABLE chamber_creeps1[$random]}
						{RANDOM 1..$chamber_creeps1.length}
						{VARIABLE_OP random add -1}
						{VARIABLE mob_x $chamber_creeps1[$random].x}
						{VARIABLE mob_y $chamber_creeps1[$random].y}
					[/do]
				[/while]
				{CLEAR_VARIABLE chamber_creeps1[$random]}
			[/case]
			[case]
				value=$creeps_theme2
				{RANDOM 1..$chamber_creeps2.length}
				{VARIABLE_OP random add -1}
				{VARIABLE mob_x $chamber_creeps2[$random].x}
				{VARIABLE mob_y $chamber_creeps2[$random].y}
				[while]
					[have_unit]
						x,y=$mob_x|,$mob_y|
					[/have_unit]
					[do]
						{CLEAR_VARIABLE chamber_creeps2[$random]}
						{RANDOM 1..$chamber_creeps2.length}
						{VARIABLE_OP random add -1}
						{VARIABLE mob_x $chamber_creeps2[$random].x}
						{VARIABLE mob_y $chamber_creeps2[$random].y}
					[/do]
				[/while]
				{CLEAR_VARIABLE chamber_creeps2[$random]}
			[/case]
			[else]
				{RANDOM 1..$chamber_terrain.length}
				{VARIABLE_OP random add -1}
				{VARIABLE mob_x $chamber_terrain[$random].x}
				{VARIABLE mob_y $chamber_terrain[$random].y}
				[while]
					[have_unit]
						x,y=$mob_x|,$mob_y|
					[/have_unit]
					[do]
						{CLEAR_VARIABLE chamber_terrain[$random]}
						{RANDOM 1..$chamber_terrain.length}
						{VARIABLE_OP random add -1}
						{VARIABLE mob_x $chamber_terrain[$random].x}
						{VARIABLE mob_y $chamber_terrain[$random].y}
					[/do]
				[/while]
				{CLEAR_VARIABLE chamber_terrain[$random]}
			[/else]
		[/switch]
		#generate mob level - loners weighted towards top of level range instead of bottom
		{VARIABLE_OP mob_level rand $min_cluster_level|..$max_cluster_level_nominal|}
		[if]
			[variable]
				name=mob_level
				greater_than=$max_cluster_level
			[/variable]
			[then]
				{VARIABLE mob_level $max_cluster_level}
			[/then]
		[/if]
		[if]
			[variable]
				name=mob_level
				greater_than=$theme[$mob_theme].max_cluster_level
			[/variable]
			[then]
				{VARIABLE mob_level $theme[$mob_theme].max_cluster_level}
			[/then]
		[/if]
		{RANDOM 0..5}
		[switch]
			variable=random
			[case]
				value=0
				{VARIABLE mob_class easy$mob_level}
			[/case]
			[case]
				value=4
				{VARIABLE_OP mob_level add 1}
				{VARIABLE mob_class easy$mob_level}
			[/case]
			[case]
				value=5
				{VARIABLE_OP mob_level add 1}
				{VARIABLE mob_class easy$mob_level}
			[/case]
			[else]
				{VARIABLE mob_class hard$mob_level}
			[/else]
		[/switch]
		{VARIABLE_OP mob_type rand $theme[$mob_theme].$mob_class}
		#create mob of type $mob_type
		{GENERATE_MOB NULL}
	)}
#enddef

#define ADD_POOL_LONER
[if]
	[variable]
		name=pool_flavor 
		equals="Ww"
	[/variable]
	[or]
		[variable]
			name=pool_flavor 
			equals="Ss"
		[/variable]
	[/or]
	[and]
		[variable]
			name=pool_fill.length
			greater_than=0
		[/variable]
	[/and]
	[and]
		[have_location]
			terrain=Ww,Ss
			[not]
				[filter]
				[/filter]
			[/not]
		[/have_location]
	[/and]
	[then]
		{VARIABLE_OP water_random rand 1..$pool_fill.length}
		{VARIABLE_OP water_random add -1}
		{VARIABLE mob_x $pool_fill[$water_random].x}
		{VARIABLE mob_y $pool_fill[$water_random].y}
		[while]
			[have_unit]
				x,y=$mob_x|,$mob_y|
			[/have_unit]
			[do]
				{CLEAR_VARIABLE pool_fill[$water_random]}
				{VARIABLE_OP water_random rand 1..$pool_fill.length}
				{VARIABLE_OP water_random add -1}
				{VARIABLE mob_x $pool_fill[$water_random].x}
				{VARIABLE mob_y $pool_fill[$water_random].y}
			[/do]
		[/while]
		{VARIABLE mob_theme 4}
		{VARIABLE place_side 8}
		[if]
			[variable]
				name=mob_level
				greater_than=$max_cluster_level
			[/variable]
			[then]
				{VARIABLE mob_level $max_cluster_level}
			[/then]
		[/if]
		[if]
			[variable]
				name=mob_level
				greater_than=$theme[$mob_theme].max_cluster_level
			[/variable]
			[then]
				{VARIABLE mob_level $theme[$mob_theme].max_cluster_level}
			[/then]
		[/if]
		{RANDOM 0..5}
		[switch]
			variable=random
			[case]
				value=0
				{VARIABLE mob_class easy$mob_level}
			[/case]
			[case]
				value=4
				{VARIABLE_OP mob_level add 1}
				{VARIABLE mob_class easy$mob_level}
			[/case]
			[case]
				value=5
				{VARIABLE_OP mob_level add 1}
				{VARIABLE mob_class easy$mob_level}
			[/case]
			[else]
				{VARIABLE mob_class hard$mob_level}
			[/else]
		[/switch]
		{VARIABLE_OP mob_type rand $theme[$mob_theme].$mob_class}
		#create mob of type $mob_type
		{GENERATE_MOB NULL}
	[/then]
[/if]
#enddef